<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="el9cCEj2qHYnt1dyXvxDxI6Gq6dyKxxOSHSlIbKwrm4" />
<meta name="theme-color" content="#1a5fdb">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Y√ºkleGit">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Y√ºkleGit ‚Äî Lojistik ƒ∞lan Takip</title>
<script>if(localStorage.getItem('yg_tema')==='dark')document.documentElement.classList.add('dark');</script>
  <meta name="description" content="Y√ºkleGit ile T√ºrkiye genelindeki g√ºncel nakliye ve y√ºk ilanlarƒ±nƒ± anlƒ±k takip edin. ≈ûehir bazlƒ± arama yapƒ±n, lojistik fƒ±rsatlarƒ± ka√ßƒ±rmayƒ±n.">
  <meta name="keywords" content="lojistik ilanlarƒ±, nakliye ilanlarƒ±, y√ºk ilanlarƒ±, kamyon ilanlarƒ±, T√ºrkiye lojistik, ta≈üƒ±macƒ±lƒ±k ilanlarƒ±, y√ºklegit">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Y√ºkleGit">
  <link rel="canonical" href="https://yuklegit.tr">

  <!-- Open Graph (Facebook, WhatsApp payla≈üƒ±m) -->
  <meta property="og:title" content="Y√ºkleGit ‚Äî Lojistik ƒ∞lan Takip">
  <meta property="og:description" content="T√ºrkiye genelindeki g√ºncel nakliye ve y√ºk ilanlarƒ±nƒ± anlƒ±k takip edin.">
  <meta property="og:url" content="https://yuklegit.tr">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://yuklegit.tr/icon-512.png">
  <meta property="og:locale" content="tr_TR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Y√ºkleGit ‚Äî Lojistik ƒ∞lan Takip">
  <meta name="twitter:description" content="T√ºrkiye genelindeki g√ºncel nakliye ve y√ºk ilanlarƒ±nƒ± anlƒ±k takip edin.">
  <meta name="twitter:image" content="https://yuklegit.tr/icon-512.png">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#eef2f7;--surface:#f8fafc;--border:#dde4f0;--text:#1e2d4a;--muted:#64748b;
  --accent:#2563eb;--accent-h:#1d4ed8;--success:#059669;--danger:#dc2626;
  --sidebar:#0f1d3a;--sidebar-t:#7b92c4;
  --radius:10px;--shadow:0 1px 8px rgba(15,29,58,.07);--shadow-md:0 4px 20px rgba(15,29,58,.10);
  --sidebar-w:220px;
}
html.dark{
  --bg:#0d1117;--surface:#161b27;--border:#252e45;--text:#dde6f5;--muted:#6b7fa3;
  --accent:#3b82f6;--accent-h:#2563eb;--success:#10b981;--danger:#ef4444;
  --sidebar:#0a0e18;
  --shadow:0 1px 8px rgba(0,0,0,.35);--shadow-md:0 4px 20px rgba(0,0,0,.45);
}
html.dark .btnGoogle{background:var(--surface)!important;color:var(--text)!important}
html.dark .btnGoogle:hover{background:#1e2538!important}
html.dark .liveBtn.active{background:rgba(16,185,129,.12)!important}
html.dark .ilanText .hl{background:#1e3a5f!important;color:#93c5fd!important}
html.dark .sehirTag{background:#1a2d50!important;border-color:#2d4a7a!important;color:#93c5fd!important}
html.dark .sehirChip.aktif{background:#1a2d50!important;border-color:var(--accent)!important;color:#93c5fd!important}
html.dark .roleBadge.admin{background:#1a2d50!important;color:#93c5fd!important}
html.dark .roleBadge.user{background:#064e3b!important;color:#34d399!important}
html.dark .profileMsg.ok{background:#064e3b!important;color:#34d399!important;border-color:#065f46!important}
html.dark .telLink,html.dark .satirSoluk .telLink,html.dark .satirTers .telLink{background:#064e3b!important;border-color:#065f46!important;color:#34d399!important}
html.dark .actionBadge.search{background:#1a2d50!important;color:#93c5fd!important}
html.dark .phoneNote{background:#064e3b!important;border-color:#065f46!important;color:#34d399!important}
html.dark #pwaCard{background:linear-gradient(135deg,#1a2d50,#1e3a8a)!important;border-color:#3b82f6!important}
html.dark #pwaCard .statValue{color:#93c5fd!important}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{height:100%}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
.authWrap{min-height:100vh;display:flex;background:linear-gradient(135deg,#0f1d3a 0%,#1a3a6e 50%,#1a5fdb 100%)}
.authLeft{flex:1;display:flex;flex-direction:column;justify-content:center;padding:60px;color:white}
.authBrand{font-family:'Outfit',sans-serif;font-size:36px;font-weight:800;margin-bottom:16px;display:flex;align-items:center;gap:12px}
.logoIcon{background:var(--accent);width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.authTagline{font-size:16px;opacity:.7;line-height:1.7;max-width:360px}
.authFeatures{margin-top:40px;display:flex;flex-direction:column;gap:14px}
.authFeature{display:flex;align-items:center;gap:12px;font-size:14px;opacity:.8}
.authFeature .dot{width:8px;height:8px;background:#0ea5e9;border-radius:50%;flex-shrink:0}
.authRight{width:480px;background:var(--surface);display:flex;flex-direction:column;justify-content:center;padding:60px 48px;overflow-y:auto}
.authTitle{font-family:'Outfit',sans-serif;font-size:26px;font-weight:700;margin-bottom:6px}
.authSubtitle{font-size:14px;color:var(--muted);margin-bottom:28px}
.formGroup{margin-bottom:14px}
.formGroup label{display:block;font-size:11.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:5px}
.formGroup input,.formGroup select{width:100%;padding:11px 14px;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);background:var(--bg);outline:none;transition:border-color .2s,box-shadow .2s}
.formGroup input:focus,.formGroup select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.12)}
.btnPrimary{width:100%;padding:12px;background:var(--accent);color:white;border:none;border-radius:var(--radius);font-family:'Outfit',sans-serif;font-size:15px;font-weight:600;cursor:pointer;margin-top:4px;transition:background .2s;-webkit-appearance:none}
.btnPrimary:hover{background:var(--accent-h)}
.authSwitch{margin-top:16px;text-align:center;font-size:13px;color:var(--muted)}
.authSwitch a{color:var(--accent);font-weight:600;cursor:pointer}
.authError{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px;display:none}
.divider{display:flex;align-items:center;gap:12px;margin:16px 0;color:var(--muted);font-size:12px}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.btnGoogle{width:100%;padding:11px;background:white;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:background .15s,border-color .15s;color:var(--text);-webkit-appearance:none}
.btnGoogle:hover{background:#f8faff;border-color:var(--accent)}
.googleIcon{width:20px;height:20px;flex-shrink:0}

/* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
#app{display:none;min-height:100vh}

/* Sidebar */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);background:var(--sidebar);display:flex;flex-direction:column;z-index:200;transition:transform .25s ease}
.sidebarLogo{padding:20px 18px 16px;font-family:'Outfit',sans-serif;font-size:19px;font-weight:800;color:white;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.08);margin-bottom:10px}
.navSection{padding:4px 18px;font-size:10px;font-weight:700;color:rgba(255,255,255,.3);text-transform:uppercase;letter-spacing:1px;margin:6px 0 3px}
.navItem{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:1px 8px;border-radius:8px;cursor:pointer;font-size:13.5px;font-weight:500;color:var(--sidebar-t);transition:all .15s;border:none;background:none;width:calc(100% - 16px);text-align:left}
.navItem:hover,.navItem:active{background:rgba(255,255,255,.06);color:white}
.navItem.active{background:var(--accent);color:white}
.navItem .icon{width:18px;text-align:center;font-size:15px;flex-shrink:0}
.sidebarBottom{margin-top:auto;padding:12px;border-top:1px solid rgba(255,255,255,.08)}
.userBadge{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,.06);margin-bottom:8px;cursor:pointer;transition:background .15s}
.userBadge:hover{background:rgba(255,255,255,.10)}
.userAvatar{width:34px;height:34px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-family:'Outfit',sans-serif;font-size:14px;font-weight:700;flex-shrink:0}
.userName{font-size:13px;font-weight:600;color:white;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:120px}
.userRole{font-size:11px;color:var(--sidebar-t)}
.btnLogout{width:100%;padding:8px;background:rgba(255,255,255,.06);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--sidebar-t);cursor:pointer;transition:all .15s}
.btnLogout:hover{background:rgba(220,38,38,.2);color:#fca5a5}

/* Overlay (mobil) */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:150}
.overlay.show{display:block}

/* Hamburger */
.hamburger{display:none;position:fixed;top:14px;left:14px;z-index:300;background:var(--sidebar);border:none;border-radius:8px;padding:8px 10px;cursor:pointer;flex-direction:column;gap:4px;align-items:center;justify-content:center;transition:left .25s ease}
.hamburger span{display:block;width:20px;height:2px;background:white;border-radius:2px;transition:transform .28s ease,opacity .2s ease}

/* Main */
.main{margin-left:var(--sidebar-w);padding:28px 28px;min-height:100vh;transition:margin-left .25s}
.pageHeader{margin-bottom:22px}
.pageTitle{font-family:'Outfit',sans-serif;font-size:22px;font-weight:700}
.pageSubtitle{color:var(--muted);font-size:13px;margin-top:3px}

/* Stats */
.statsGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.statCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;box-shadow:var(--shadow)}
.statLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:6px}
.statValue{font-family:'Outfit',sans-serif;font-size:28px;font-weight:700}
.statValue.blue{color:var(--accent)}.statValue.green{color:var(--success)}

/* Search */
.searchCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:16px;box-shadow:var(--shadow)}
.searchRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.searchInput{flex:1;min-width:120px;border:1.5px solid var(--border);border-radius:8px;padding:9px 13px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;background:var(--bg);outline:none;transition:border-color .2s,box-shadow .2s;color:var(--text);-webkit-appearance:none}
.searchInput:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.btnSearch{padding:9px 18px;background:var(--accent);color:white;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:background .2s;white-space:nowrap;flex-shrink:0;-webkit-appearance:none}
.btnSearch:hover,.btnSearch:active{background:var(--accent-h)}
.btnReset{padding:9px 12px;background:var(--bg);color:var(--muted);border:1.5px solid var(--border);border-radius:8px;font-size:13px;cursor:pointer;transition:all .15s;white-space:nowrap;flex-shrink:0}
.btnReset:hover{border-color:var(--text);color:var(--text)}
.liveBtn{display:flex;align-items:center;gap:5px;padding:7px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:20px;font-size:12px;font-weight:500;color:var(--muted);cursor:pointer;transition:all .15s;white-space:nowrap;flex-shrink:0}
.liveBtn.active{border-color:var(--success);color:var(--success);background:#f0fdf4}
.liveDot{width:7px;height:7px;border-radius:50%;background:var(--muted);flex-shrink:0}
.liveBtn.active .liveDot{background:var(--success);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ƒ∞lanlar */
.ilanlarBar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.ilanCount{font-size:13px;color:var(--muted)}
.ilanCount span{font-weight:600;color:var(--text)}
.ilanList{display:flex;flex-direction:column;gap:10px}
.ilanCard{background:var(--surface);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:var(--radius);padding:16px 18px;box-shadow:var(--shadow);animation:fadeUp .25s ease;transition:box-shadow .2s}
.ilanCard:hover{box-shadow:var(--shadow-md)}
.paylasBtn{display:inline-flex;align-items:center;gap:5px;margin-left:auto;background:none;border:1.5px solid var(--border);border-radius:20px;padding:3px 10px;font-size:11.5px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .15s}
.paylasBtn:hover{border-color:var(--accent);color:var(--accent);background:var(--bg)}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ilanMeta{display:flex;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.ilanNum{font-family:'Outfit',sans-serif;font-size:11px;font-weight:700;color:white;background:var(--accent);padding:2px 8px;border-radius:4px;flex-shrink:0}
.ilanGrup{font-size:13px;font-weight:600;color:var(--accent);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px}
.ilanTime{font-size:11px;color:var(--muted);background:var(--bg);padding:3px 9px;border-radius:20px;border:1px solid var(--border);white-space:nowrap;flex-shrink:0}
.ilanText{font-size:13.5px;line-height:1.75;color:var(--text);white-space:pre-wrap;word-break:break-word}
.ilanText .hl{background:#dbeafe;color:#1e40af;font-weight:700;padding:0 3px;border-radius:3px}
/* Kƒ±smi e≈üle≈üme kartlarƒ±nda hi√ßbir vurgu g√∂r√ºnmesin ‚Äî n√ºkleer kural */
div.ilanCardKismi span.hl{background:transparent!important;color:inherit!important;font-weight:inherit!important;padding:0!important;border-radius:0!important;box-shadow:none!important;border:none!important}
div.ilanCardKismi .hl{background:transparent!important;color:inherit!important;font-weight:inherit!important;padding:0!important;border-radius:0!important;box-shadow:none!important;border:none!important}
/* Satƒ±r bazlƒ± render stilleri */
.ilanTextSatir{white-space:pre-wrap;word-break:break-word}
.satirEsles{display:block;color:var(--text);font-size:13.5px;line-height:1.75}
.satirSoluk{display:block;color:rgba(107,127,163,0.45);font-size:12px;line-height:1.6}
.satirSoluk .telLink{color:#16a34a;font-weight:700;background:#f0fdf4;border-color:#bbf7d0;opacity:1}
.satirTers{display:block;color:rgba(107,127,163,0.5);font-size:13px;line-height:1.75;text-decoration:line-through;text-decoration-color:rgba(239,68,68,.4)}
.satirTers .telLink{color:#16a34a;font-weight:700;background:#f0fdf4;border-color:#bbf7d0;text-decoration:none;opacity:1}
.tersIkon{font-size:11px;color:#ef4444;margin-left:4px;text-decoration:none;display:inline}
.ilanSehirler{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px}
.sehirTag{font-size:11px;color:var(--accent);background:#eff6ff;padding:2px 8px;border-radius:20px;border:1px solid #bfdbfe}
.emptyState{text-align:center;padding:50px 20px;color:var(--muted)}
.emptyIcon{font-size:44px;margin-bottom:12px}

/* Card/Table */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin-bottom:18px}
.cardHeader{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.cardTitle{font-family:'Outfit',sans-serif;font-size:15px;font-weight:700}
.tableWrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;min-width:500px}
thead{background:var(--bg)}
th{padding:10px 16px;text-align:left;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--muted);border-bottom:1px solid var(--border);white-space:nowrap}
td{padding:12px 16px;font-size:13.5px;border-bottom:1px solid var(--border)}
tr:last-child td{border-bottom:none}
tr:hover td{background:#f8faff}
.roleBadge{font-size:11px;font-weight:700;padding:3px 10px;border-radius:20px;white-space:nowrap}
.roleBadge.admin{background:#eff6ff;color:var(--accent)}.roleBadge.user{background:#f0fdf4;color:var(--success)}
.btnSm{padding:5px 12px;border-radius:6px;font-size:12px;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap}
.btnDanger{background:none;border:1.5px solid #fecaca;color:var(--danger)}
.btnDanger:hover{background:#fef2f2}

/* Add form */
.addForm{padding:16px 18px;border-bottom:1px solid var(--border);background:#f8faff}
.addForm h4{font-size:12px;font-weight:700;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}
.formRow{display:grid;grid-template-columns:1fr 1fr 1fr 110px auto;gap:8px;align-items:end}
.formRow .formGroup{margin-bottom:0}
.btnAdd{padding:11px 16px;background:var(--success);color:white;border:none;border-radius:var(--radius);font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;white-space:nowrap;-webkit-appearance:none}
.btnAdd:hover{opacity:.88}

/* Kara liste */
.blGrid{display:flex;flex-wrap:wrap;gap:8px;padding:16px 18px;min-height:50px}
.blTag{display:flex;align-items:center;gap:8px;background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:500}
.blTag button{background:none;border:none;color:var(--danger);cursor:pointer;font-size:17px;line-height:1;opacity:.6}
.blTag button:hover{opacity:1}
.blAdd{display:flex;gap:10px;padding:14px 18px;border-top:1px solid var(--border)}

/* Profil */
.profileGrid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.profileCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.profileHeader{padding:16px 20px;border-bottom:1px solid var(--border);background:#f8faff}
.profileTitle{font-family:'Outfit',sans-serif;font-size:15px;font-weight:700}
.profileBody{padding:20px}
.infoRow{display:flex;flex-direction:column;gap:4px;margin-bottom:14px}
.infoRow:last-child{margin-bottom:0}
.infoLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px}
.infoValue{font-size:14px;font-weight:500}
.profileMsg{font-size:13px;margin-top:10px;padding:8px 12px;border-radius:6px;display:none}
.profileMsg.ok{background:#f0fdf4;color:var(--success);border:1px solid #bbf7d0}
.profileMsg.err{background:#fef2f2;color:var(--danger);border:1px solid #fecaca}

/* Token-input arama */
.tokenInput{display:flex;flex-wrap:wrap;align-items:center;gap:6px;padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;cursor:text;transition:border-color .2s,box-shadow .2s;min-height:44px}
.tokenInput:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.searchTag{display:inline-flex;align-items:center;gap:4px;background:var(--accent);color:white;border-radius:6px;padding:3px 8px 3px 10px;font-size:13px;font-weight:600;animation:fadeUp .15s ease;white-space:nowrap}
.searchTag button{background:rgba(255,255,255,.25);border:none;color:white;border-radius:4px;width:16px;height:16px;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;padding:0;line-height:1;flex-shrink:0}
.searchTag button:hover{background:rgba(255,255,255,.45)}
.tokenRealInput{border:none;outline:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);min-width:180px;flex:1;padding:2px 0}
.sehirOneriBox{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--surface);border:1.5px solid var(--accent);border-radius:10px;box-shadow:var(--shadow-md);z-index:100;max-height:220px;overflow-y:auto}
.sehirOneriItem{padding:10px 14px;cursor:pointer;font-size:14px;transition:background .1s}
.sehirOneriItem:hover,.sehirOneriItem.aktif{background:var(--accent);color:white}
.sehirOneriItem.eklenmis{opacity:.5;cursor:default}
.searchInputWrap{position:relative;flex:1}

/* √áift Arama Kutusu */
.searchDual{display:flex;flex-direction:column;gap:8px;flex:1}
.searchDualRow{display:flex;align-items:center;gap:8px}
.searchDualLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;width:52px;flex-shrink:0}
.searchDualInput{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;cursor:text;transition:border-color .2s,box-shadow .2s;min-height:42px;flex:1;position:relative}
.searchDualInput:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.searchDualInput.has-tag{border-color:var(--accent);background:rgba(26,95,219,.04)}
.dualRealInput{border:none;outline:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);min-width:120px;flex:1;padding:2px 0}
.dualTag{display:inline-flex;align-items:center;gap:5px;background:var(--accent);color:white;border-radius:6px;padding:3px 9px;font-size:13px;font-weight:600;white-space:nowrap}
.dualTag button{background:none;border:none;color:rgba(255,255,255,.8);cursor:pointer;font-size:13px;padding:0;line-height:1;display:flex;align-items:center}
.dualTag button:hover{color:white}
.searchDivider{display:flex;align-items:center;padding-left:60px;gap:8px}
.searchDividerLine{flex:1;height:1px;background:var(--border)}
.swapBtn{flex-shrink:0;background:var(--bg);border:1.5px solid var(--border);border-radius:8px;width:32px;height:32px;cursor:pointer;font-size:16px;color:var(--muted);display:flex;align-items:center;justify-content:center;transition:all .15s;line-height:1}
.swapBtn:hover{border-color:var(--accent);color:var(--accent);background:#eff6ff;transform:rotate(180deg)}
.dualOneriBox{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--surface);border:1.5px solid var(--accent);border-radius:10px;box-shadow:var(--shadow-md);z-index:200;max-height:220px;overflow-y:auto}
.dualOneriItem{padding:10px 14px;cursor:pointer;font-size:14px;transition:background .1s}
.dualOneriItem:hover,.dualOneriItem.aktif{background:var(--accent);color:white}
.dualOneriItem.eklenmis{opacity:.5;cursor:default}
.btnAI{padding:9px 16px;background:linear-gradient(135deg,#7c3aed,#4f46e5);color:white;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;flex-shrink:0;display:flex;align-items:center;gap:6px}
.btnAI:hover{background:linear-gradient(135deg,#6d28d9,#4338ca);transform:translateY(-1px);box-shadow:0 4px 12px rgba(124,58,237,.35)}
.btnAI:disabled{opacity:.6;cursor:wait;transform:none}
.aiSpinner{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:spin .7s linear infinite;display:none}
.btnAI.loading .aiSpinner{display:block}
.btnAI.loading .aiIcon{display:none}
@keyframes spin{to{transform:rotate(360deg)}}
.aiSonucBanner{background:linear-gradient(135deg,#f5f3ff,#ede9fe);border:1.5px solid #c4b5fd;border-radius:12px;padding:14px 18px;margin-bottom:14px;display:none}
.aiSonucBaslik{font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;color:#7c3aed;margin-bottom:4px;display:flex;align-items:center;gap:6px}
.aiSonucOzet{font-size:13px;color:#4c1d95;line-height:1.5}
.aiTag{display:inline-flex;align-items:center;gap:4px;background:#7c3aed;color:white;border-radius:5px;padding:2px 8px;font-size:11px;font-weight:700;margin-right:5px}
.ilanCard.ai-oneri{border-left-color:#7c3aed;background:linear-gradient(to right,#faf5ff,var(--surface))}
.ilanCard.ai-oneri .ilanNum{background:#7c3aed}
.ilanAiOzet{margin-top:8px;padding:8px 12px;background:rgba(124,58,237,.07);border-radius:8px;font-size:12.5px;color:#6d28d9;display:flex;flex-wrap:wrap;gap:8px}
.ilanAiOzetItem{display:flex;align-items:center;gap:4px;font-weight:600}
/* PWA Install Banner */
.pwaBanner{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a5fdb,#1048b8);color:white;border-radius:16px;padding:14px 20px;display:flex;align-items:center;gap:14px;box-shadow:0 8px 32px rgba(26,95,219,.35);z-index:9998;max-width:380px;width:calc(100% - 40px);animation:slideDown .4s ease}
@keyframes slideDown{from{transform:translateX(-50%) translateY(-80px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
.pwaBanner .pwaIcon{font-size:28px;flex-shrink:0}
.pwaBanner .pwaText{flex:1}
.pwaBanner .pwaTitle{font-weight:700;font-size:14px}
.pwaBanner .pwaSub{font-size:12px;opacity:.85;margin-top:2px}
.pwaBanner .pwaBtn{background:white;color:#1a5fdb;border:none;border-radius:10px;padding:8px 16px;font-weight:700;font-size:13px;cursor:pointer;white-space:nowrap;flex-shrink:0}
.pwaBanner .pwaClose{background:none;border:none;color:white;font-size:18px;cursor:pointer;opacity:.7;padding:0 0 0 8px;flex-shrink:0}

/* Bildirim ayarlarƒ± */
.sehirSecici{display:flex;flex-wrap:wrap;gap:8px;padding:16px 0}
.sehirChip{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:500;border:1.5px solid var(--border);background:var(--bg);color:var(--muted);cursor:pointer;transition:all .15s;user-select:none}
.sehirChip:hover{border-color:var(--accent);color:var(--accent)}
.sehirChip.aktif{background:#eff6ff;border-color:var(--accent);color:var(--accent);font-weight:700}
.sehirChip.aktif::before{content:'‚úì '}
.bildirimArama{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;background:var(--bg);outline:none;margin-bottom:12px;transition:border-color .2s}
.bildirimArama:focus{border-color:var(--accent)}
.bildirimToggle{display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);margin-bottom:16px}
.toggle{position:relative;width:46px;height:26px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.toggleSlider{position:absolute;cursor:pointer;inset:0;background:#cbd5e1;border-radius:20px;transition:.3s}
.toggleSlider:before{content:'';position:absolute;width:20px;height:20px;left:3px;bottom:3px;background:white;border-radius:50%;transition:.3s}
.toggle input:checked + .toggleSlider{background:var(--accent)}
.toggle input:checked + .toggleSlider:before{transform:translateX(20px)}
.toggleLabel{font-size:14px;font-weight:600}
.toggleSub{font-size:12px;color:var(--muted)}

/* Hareketler tablosu */
.dataTable{width:100%;border-collapse:collapse;font-size:13px}
.dataTable th{background:var(--sidebar);color:var(--muted);font-weight:600;padding:10px 12px;text-align:left;border-bottom:1px solid var(--border);white-space:nowrap}
.dataTable td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.dataTable tr:hover td{background:#f8faff}
.actionBadge{display:inline-block;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:700}
.actionBadge.login{background:#dcfce7;color:#16a34a}
.actionBadge.logout{background:#fee2e2;color:#dc2626}
.actionBadge.search{background:#eff6ff;color:#1a5fdb}

/* Tel linki */
.telLink{color:#16a34a;font-weight:700;text-decoration:none;white-space:nowrap;background:#f0fdf4;padding:1px 6px;border-radius:4px;border:1px solid #bbf7d0}
.telLink:hover{background:#dcfce7;text-decoration:underline}
.telGrup{display:inline-block;margin:2px 0;width:100%}
.telMasked{display:block;color:#16a34a;font-weight:700;font-size:14px;margin-bottom:6px;letter-spacing:.3px}
.telBtnRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.telBtn{display:inline-flex;align-items:center;gap:5px;padding:8px 16px;border-radius:8px;font-weight:700;font-size:13px;text-decoration:none;min-height:42px;transition:opacity .15s;white-space:nowrap}
.telBtnAra{background:var(--accent);color:#fff}
.telBtnAra:hover{opacity:.85}
.telBtnWa{background:#25D366;color:#fff}
.telBtnWa:hover{opacity:.85}

/* ƒ∞lan olu≈ütur */
.ilanForm{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:20px}
.ilanFormTitle{font-family:'Outfit',sans-serif;font-size:16px;font-weight:700;margin-bottom:4px}
.ilanFormSub{font-size:12px;color:var(--muted);margin-bottom:14px}
.ilanTextarea{width:100%;min-height:120px;border:1.5px solid var(--border);border-radius:var(--radius);padding:12px 14px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);background:var(--bg);outline:none;resize:vertical;transition:border-color .2s;line-height:1.6}
.ilanTextarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.ilanFormBottom{display:flex;align-items:center;justify-content:space-between;margin-top:10px;flex-wrap:wrap;gap:8px}
.charCount{font-size:12px;color:var(--muted)}
.charCount.warn{color:var(--danger)}
.phoneNote{font-size:12px;color:var(--success);background:#f0fdf4;border:1px solid #bbf7d0;padding:4px 10px;border-radius:6px}

/* ‚îÄ‚îÄ RIZA MODALI ‚îÄ‚îÄ */
.rizaOverlay{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:10000;display:flex;align-items:center;justify-content:center;padding:16px}
.rizaBox{background:var(--surface);border-radius:16px;padding:32px 28px;max-width:520px;width:100%;max-height:92vh;overflow-y:auto;box-shadow:0 12px 48px rgba(0,0,0,.35);animation:fadeUp .3s ease}
.rizaTitle{font-family:'Outfit',sans-serif;font-size:22px;font-weight:800;color:var(--text);margin-bottom:6px}
.rizaSubtitle{font-size:13px;color:var(--muted);margin-bottom:22px;line-height:1.6}
.rizaItem{display:flex;align-items:flex-start;gap:14px;padding:14px 16px;border:1.5px solid var(--border);border-radius:10px;margin-bottom:12px;cursor:pointer;transition:border-color .15s,background .15s}
.rizaItem:hover{border-color:var(--accent);background:#f5f8ff}
.rizaItem.checked{border-color:var(--accent);background:#eff6ff}
.rizaCheckbox{width:20px;height:20px;border:2px solid #9ca3af;border-radius:5px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;transition:all .15s;background:white}
.rizaItem.checked .rizaCheckbox{background:var(--accent);border-color:var(--accent)}
.rizaItem.checked .rizaCheckbox::after{content:'‚úì';color:white;font-size:13px;font-weight:700}
.rizaText{font-size:13.5px;color:var(--text);line-height:1.65}
.rizaText a{color:var(--accent);font-weight:600}
.rizaNote{font-size:12px;color:var(--muted);margin:16px 0 20px;line-height:1.6;background:var(--bg);padding:10px 14px;border-radius:8px;border:1px solid var(--border)}
.rizaDevamBtn{width:100%;padding:13px;background:#94a3b8;color:white;border:none;border-radius:10px;font-family:'Outfit',sans-serif;font-size:15px;font-weight:700;cursor:not-allowed;transition:all .2s}
.rizaDevamBtn.aktif{background:var(--accent);cursor:pointer}
.rizaDevamBtn.aktif:hover{background:var(--accent-h)}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.appFooter{text-align:center;padding:28px 20px 18px;font-size:12.5px;color:var(--muted);border-top:1px solid var(--border);margin-top:40px}
.appFooter a{color:var(--muted);text-decoration:none;padding:4px 8px;border-radius:6px;transition:color .15s,background .15s}
.appFooter a:hover{color:var(--accent);background:#eff6ff}
.appFooter span{margin:0 4px;opacity:.4}

/* Loader */
.loader{display:flex;justify-content:center;padding:40px}
.spinner{width:28px;height:28px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ MOBƒ∞L ‚îÄ‚îÄ */
@media(max-width:768px){
  .authLeft{display:none}
  .authRight{width:100%;padding:40px 24px;min-height:100vh;justify-content:flex-start;padding-top:60px}

  /* Hamburger: sidebar kapalƒ±yken sol √ºstte sabit */
  .hamburger{display:flex}
  /* Hamburger a√ßƒ±kken sidebar i√ßine kayƒ±yor gibi g√∂r√ºns√ºn */
  .hamburger.is-open{left:calc(var(--sidebar-w) - 56px)}
  /* X animasyonu */
  .hamburger.is-open span:nth-child(1){transform:translateY(6px) rotate(45deg)}
  .hamburger.is-open span:nth-child(2){opacity:0;transform:scaleX(0)}
  .hamburger.is-open span:nth-child(3){transform:translateY(-6px) rotate(-45deg)}

  .sidebar{transform:translateX(-100%)}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0;padding:14px 12px;padding-top:60px}

  /* √áoklu ≈üehir etiketleri: yatayda ta≈üma yerine dikeyde b√ºy√ºs√ºn */
  .searchDualInput{flex-wrap:wrap;align-items:flex-start}
  .dualRealInput{flex:1;min-width:70px}

  .statsGrid{grid-template-columns:1fr 1fr;gap:10px}
  .statValue{font-size:24px}

  /* Arama kutusu mobil */
  .searchRow{flex-direction:column;align-items:stretch;gap:8px}
  .searchDual{flex:none;width:100%}
  .searchDualRow{gap:6px}
  .searchDualLabel{width:62px;font-size:10px}
  .dualRealInput{font-size:16px} /* iOS zoom engelle */
  .searchBtnGroup{display:flex;flex-direction:row;flex-wrap:wrap;gap:6px;width:100%}
  .searchBtnGroup .btnSearch,
  .searchBtnGroup .btnAI,
  .searchBtnGroup .btnReset,
  .searchBtnGroup .liveBtn{flex:1;min-width:calc(50% - 3px);justify-content:center}

  .ilanCard{padding:14px}
  .ilanGrup{max-width:140px}

  .profileGrid{grid-template-columns:1fr}
  .formRow{grid-template-columns:1fr;gap:8px}

  .pageTitle{font-size:20px}
}

@media(max-width:480px){
  .statsGrid{grid-template-columns:1fr 1fr}
  .searchDualLabel{display:none} /* √ßok dar ekranda label gizle */
  .searchBtnGroup .btnSearch,
  .searchBtnGroup .btnAI{flex:1}
  .searchBtnGroup .btnReset,
  .searchBtnGroup .liveBtn{flex:1}
}
</style>
</head>
<body>

<!-- AUTH -->
<div id="authWrap" class="authWrap">
  <div class="authLeft">
    <div class="authBrand"><div class="logoIcon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13" rx="1"/><path d="M16 8h4l3 5v4h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div> Y√ºkleGit</div>
    <div class="authTagline">T√ºrkiye genelindeki lojistik ilanlarƒ±nƒ± ger√ßek zamanlƒ± takip edin, ≈üehir bazlƒ± arama yapƒ±n.</div>
    <div class="authFeatures">
      <div class="authFeature"><div class="dot"></div> 870+ ≈üehir ve il√ße desteƒüi</div>
      <div class="authFeature"><div class="dot"></div> Anlƒ±k ilan takibi</div>
      <div class="authFeature"><div class="dot"></div> G√ºzergah bazlƒ± akƒ±llƒ± arama</div>
    </div>
  </div>
  <div class="authRight">
    <div id="loginForm">
      <div class="authTitle">Giri≈ü Yap</div>
      <div class="authSubtitle">Hesabƒ±nƒ±za giri≈ü yapƒ±n</div>
      <div class="formGroup"><label>Kullanƒ±cƒ± Adƒ± veya E-posta</label>
        <input type="text" id="loginUser" placeholder="kullanici veya mail@ornek.com" autocomplete="username"></div>
      <div class="formGroup"><label>≈ûifre</label>
        <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"></div>
      <button class="btnPrimary" onclick="login()">Giri≈ü Yap</button>
      <div class="authError" id="loginError"></div>
      <div id="verifyWarn" style="display:none;margin-top:10px;background:#fff7ed;border:1px solid #fed7aa;color:#c2410c;padding:10px 14px;border-radius:8px;font-size:13px">
        E-postanƒ±z doƒürulanmamƒ±≈ü. <a onclick="resendVerify()" style="color:#c2410c;font-weight:700;cursor:pointer;text-decoration:underline">Tekrar g√∂nder</a>
      </div>
      <div style="text-align:right;margin-top:8px"><a onclick="showForgot()" style="font-size:13px;color:var(--accent);cursor:pointer">≈ûifremi unuttum</a></div>
      <div class="divider">veya</div>
      <button class="btnGoogle" onclick="googleLogin()">
        <svg class="googleIcon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Google ile Giri≈ü Yap
      </button>
      <div class="authSwitch" style="margin-top:14px">Hesabƒ±nƒ±z yok mu? <a onclick="showReg()">Kayƒ±t olun</a></div>
    </div>

    <div id="forgotForm" style="display:none">
      <div class="authTitle">≈ûifremi Unuttum</div>
      <div class="authSubtitle">E-postanƒ±za sƒ±fƒ±rlama linki g√∂nderelim</div>
      <div class="formGroup"><label>E-posta</label>
        <input type="email" id="forgotEmail" placeholder="mail@ornek.com"></div>
      <button class="btnPrimary" onclick="forgotPassword()">Sƒ±fƒ±rlama Linki G√∂nder</button>
      <div class="authError" id="forgotError"></div>
      <div id="forgotSuccess" style="display:none;background:#f0fdf4;border:1px solid #bbf7d0;color:#059669;padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px"></div>
      <div class="authSwitch" style="margin-top:14px"><a onclick="showLogin()">‚Üê Giri≈ü sayfasƒ±na d√∂n</a></div>
    </div>

    <div id="regForm" style="display:none">
      <div class="authTitle">Kayƒ±t Ol</div>
      <div class="authSubtitle">Yeni hesap olu≈üturun</div>
      <div class="formGroup"><label>Kullanƒ±cƒ± Adƒ±</label>
        <input type="text" id="regUser" placeholder="kullanici_adi" autocomplete="username"></div>
      <div class="formGroup"><label>E-posta</label>
        <input type="email" id="regEmail" placeholder="mail@ornek.com" autocomplete="email"></div>
      <div class="formGroup"><label>Telefon Numarasƒ±</label>
        <input type="tel" id="regPhone" placeholder="05XX XXX XX XX" autocomplete="tel"></div>
      <div class="formGroup"><label>≈ûifre</label>
        <input type="password" id="regPass" placeholder="En az 6 karakter" autocomplete="new-password"></div>
      <button class="btnPrimary" onclick="register()">Kayƒ±t Ol</button>
      <div class="authError" id="regError"></div>
      <div id="regSuccess" style="display:none;background:#f0fdf4;border:1px solid #bbf7d0;color:#059669;padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px"></div>
      <div class="divider">veya</div>
      <button class="btnGoogle" onclick="googleLogin()">
        <svg class="googleIcon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Google ile Kayƒ±t Ol
      </button>
      <div class="authSwitch" style="margin-top:12px">Zaten hesabƒ±nƒ±z var mƒ±? <a onclick="showLogin()">Giri≈ü yapƒ±n</a></div>
    </div>
  </div>
</div>

<!-- APP -->
<button class="hamburger" id="hamburger" onclick="toggleSidebar()" style="display:none">
  <span></span><span></span><span></span>
</button>
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<div id="app">
  <div id="telefonBanner" style="display:none;background:#fffbeb;border-bottom:2px solid #fde68a;padding:10px 20px;font-size:13px;color:#92400e;text-align:center;position:sticky;top:0;z-index:100">
    ‚ö†Ô∏è ƒ∞lan verebilmek ve diƒüer kullanƒ±cƒ±larla ileti≈üime ge√ßebilmek i√ßin
    <a href="#" onclick="showPage('profil');document.getElementById('telefonBanner').style.display='none';return false"
       style="color:#b45309;font-weight:700;text-decoration:underline;margin-left:4px">profilinizden telefon numaranƒ±zƒ± ekleyin ‚Üí</a>
  </div>
  <div class="sidebar" id="sidebar">
    <div class="sidebarLogo"><img src="/icon-192.png" style="width:32px;height:32px;border-radius:8px;object-fit:cover;flex-shrink:0"> Y√ºkleGit</div>
    <div class="navSection">Men√º</div>
    <button class="navItem active" onclick="showPage('ilanlar')" id="nav-ilanlar"><span class="icon">üìã</span> ƒ∞lanlar</button>
    <button class="navItem" onclick="showPage('profil')" id="nav-profil"><span class="icon">üë§</span> Profilim</button>
    <button class="navItem" onclick="showPage('ilanver')" id="nav-ilanver"><span class="icon">‚úèÔ∏è</span> ƒ∞lan Ver</button>
    <button class="navItem" onclick="showPage('iletisim')" id="nav-iletisim"><span class="icon">üí¨</span> ƒ∞leti≈üim</button>
    <div id="adminNav" style="display:none">
      <div class="navSection">Y√∂netim</div>
      <button class="navItem" onclick="showPage('kullanicilar')" id="nav-kullanicilar"><span class="icon">üë•</span> Kullanƒ±cƒ±lar</button>
      <button class="navItem" onclick="showPage('blacklist')" id="nav-blacklist"><span class="icon">üö´</span> Kara Liste</button>
      <button class="navItem" onclick="showPage('hareketler')" id="nav-hareketler"><span class="icon">üìä</span> Hareketler</button>
      <button class="navItem" onclick="showPage('botlar')" id="nav-botlar"><span class="icon">ü§ñ</span> Botlar</button>
    </div>
    <div class="sidebarBottom">
      <div class="userBadge" onclick="showPage('profil');closeSidebar()">
        <div class="userAvatar" id="userAvatar">?</div>
        <div style="overflow:hidden">
          <div class="userName" id="userNameDisplay">‚Äî</div>
          <div class="userRole" id="userRoleDisplay">‚Äî</div>
        </div>
      </div>
      <button class="btnLogout" onclick="logout()">‚¨Ö √áƒ±kƒ±≈ü</button>
    </div>
  </div>

  <div class="main">
    <!-- ƒ∞lanlar -->
    <div id="page-ilanlar">
      <div class="pageHeader"><div class="pageTitle">ƒ∞lanlar</div><div class="pageSubtitle">Son 1 saat i√ßindeki aktif lojistik ilanlarƒ±</div></div>
      <div class="statsGrid">
        <div class="statCard"><div class="statLabel">Toplam ƒ∞lan</div><div class="statValue blue" id="statTotal">‚Äî</div></div>
        <div class="statCard" style="cursor:pointer;border:2px dashed var(--primary);background:linear-gradient(135deg,#eff6ff,#dbeafe)" onclick="pwaInstallOrGuide()" id="pwaCard">
          <div class="statLabel">üì≤ Mobil Uygulama</div>
          <div class="statValue" style="font-size:15px;color:var(--primary)" id="pwaCardText">Ana Ekrana Ekle</div>
        </div>
        <div class="statCard" style="cursor:pointer" onclick="document.getElementById('bildirimToggle').click()" id="bildirimKart">
          <div class="statLabel">üîî Bildirimler</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" id="bildirimToggle" onchange="bildirimToggleChange()">
              <span class="toggleSlider"></span>
            </label>
            <span style="font-size:13px;font-weight:600;color:var(--text)" id="bildirimKartText">Kapalƒ±</span>
          </div>
        </div>
        <div class="statCard" style="cursor:pointer" onclick="document.getElementById('temaToggleCheck').click()" id="temaKart">
          <div class="statLabel" id="temaKartLabel">‚òÄÔ∏è Tema</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" id="temaToggleCheck" onchange="toggleTema()">
              <span class="toggleSlider"></span>
            </label>
            <span style="font-size:13px;font-weight:600;color:var(--text)" id="temaKartText">A√ßƒ±k</span>
          </div>
        </div>
      </div>
      <div class="searchCard">
        <div class="searchRow" style="align-items:flex-start;gap:10px">
          <div class="searchDual">
            <!-- Nereden (√ßoklu) -->
            <div class="searchDualRow">
              <span class="searchDualLabel">üìç Nereden</span>
              <div class="searchDualInput" id="neredenWrap" onclick="focusDualInput('nereden')">
                <div id="neredenTags" style="display:contents"></div>
                <input type="text" class="dualRealInput" id="neredenInput" placeholder="Kalkƒ±≈ü ≈üehri ekleyin..." autocomplete="off"
                  oninput="dualOneri('nereden')" onkeydown="dualKeydown(event,'nereden')">
                <div class="dualOneriBox" id="neredenOneriBox" style="display:none"></div>
              </div>
            </div>
            <!-- Ayƒ±rƒ±cƒ± + Swap -->
            <div class="searchDivider">
              <button class="swapBtn" onclick="swapDual()" title="Nereden ‚Üî Nereye deƒüi≈ütir">‚áÖ</button>
              <div class="searchDividerLine"></div>
            </div>
            <!-- Nereye (√ßoklu) -->
            <div class="searchDualRow">
              <span class="searchDualLabel">üèÅ Nereye</span>
              <div class="searchDualInput" id="nereyeWrap" onclick="focusDualInput('nereye')">
                <div id="nereyeTags" style="display:contents"></div>
                <input type="text" class="dualRealInput" id="nereyeInput" placeholder="Varƒ±≈ü ≈üehri ekleyin (opsiyonel)..." autocomplete="off"
                  oninput="dualOneri('nereye')" onkeydown="dualKeydown(event,'nereye')">
                <div class="dualOneriBox" id="nereyeOneriBox" style="display:none"></div>
              </div>
            </div>
          </div>
          <div class="searchBtnGroup" style="flex-shrink:0;padding-top:2px;display:flex;flex-direction:column;gap:6px">
            <button class="btnSearch" onclick="araIlanlar()">üîç Ara</button>
            <button class="btnReset" onclick="resetArama()">Temizle</button>
            <button class="liveBtn" id="liveBtn" onclick="toggleLive()"><div class="liveDot"></div> Canlƒ±</button>
          </div>
        </div>
      </div>
      <div class="aiSonucBanner" id="aiSonucBanner" style="display:none">
        <div class="aiSonucBaslik">‚ú® AI Analizi <span id="aiSonucSayac" style="font-weight:400;color:#6d28d9;font-size:12px"></span></div>
        <div class="aiSonucOzet" id="aiSonucOzet"></div>
      </div>
      <div class="ilanlarBar"><div class="ilanCount">G√∂sterilen: <span id="ilanCountNum">0</span> ilan</div></div>
      <div id="ilanList" class="ilanList"><div class="loader"><div class="spinner"></div></div></div>
    </div>

    <!-- Profil -->
    <div id="page-profil" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Profilim</div><div class="pageSubtitle">Hesap bilgilerinizi y√∂netin</div></div>
      <div class="profileGrid">
        <div class="profileCard">
          <div class="profileHeader"><div class="profileTitle">Hesap Bilgileri</div></div>
          <div class="profileBody">
            <div class="infoRow"><div class="infoLabel">Kullanƒ±cƒ± Adƒ±</div><div class="infoValue" id="profileUsername">‚Äî</div></div>
            <div class="infoRow"><div class="infoLabel">E-posta</div><div class="infoValue" id="profileEmail">‚Äî</div></div>
            <div class="infoRow"><div class="infoLabel">Telefon</div><div class="infoValue" id="profilePhone">‚Äî</div></div>
            <div class="infoRow"><div class="infoLabel">Rol</div><div class="infoValue" id="profileRole">‚Äî</div></div>
          </div>
        </div>
        <div class="profileCard">
          <div class="profileHeader"><div class="profileTitle">E-posta G√ºncelle</div></div>
          <div class="profileBody">
            <div class="formGroup"><label>Yeni E-posta</label><input type="email" id="newEmail" placeholder="yeni@mail.com"></div>
            <button class="btnPrimary" onclick="updateEmail()">G√ºncelle</button>
            <div class="profileMsg" id="emailMsg"></div>
          </div>
        </div>
        <div class="profileCard">
          <div class="profileHeader"><div class="profileTitle">üìû Telefon G√ºncelle</div></div>
          <div class="profileBody">
            <div class="formGroup"><label>Telefon Numarasƒ±</label><input type="tel" id="newPhone" placeholder="05321234567"></div>
            <button class="btnPrimary" onclick="updatePhone()">G√ºncelle</button>
            <div class="profileMsg" id="phoneMsg"></div>
          </div>
        </div>
        <div class="profileCard" style="grid-column:1/-1">
          <div class="profileHeader"><div class="profileTitle">üîî Bildirim Ayarlarƒ±</div></div>
          <div class="profileBody">
            <div class="bildirimToggle">
              <label class="toggle">
                <input type="checkbox" id="bildirimToggle" onchange="bildirimToggleChange()">
                <span class="toggleSlider"></span>
              </label>
              <div>
                <div class="toggleLabel">Tarayƒ±cƒ± Bildirimleri</div>
                <div class="toggleSub" id="bildirimDurum">Takip ettiƒüiniz illerde ilan gelince bildirim alƒ±n (il se√ßince t√ºm il√ßeleri kapsar)</div>
              </div>
            </div>
            <div id="bildirimAyarlar" style="display:none">
              <div style="font-size:13px;font-weight:600;margin-bottom:8px;color:var(--muted)">TAKƒ∞P EDƒ∞LECEK ≈ûEHƒ∞RLER</div>
              <input class="bildirimArama" id="bildirimSehirAra" placeholder="≈ûehir veya il√ße ara..." oninput="sehirFiltrele()">
              <div class="sehirSecici" id="sehirChipler"></div>
              <div style="font-size:12px;color:var(--muted);margin-top:8px">Se√ßili: <strong id="seciliSayisi">0</strong> ≈üehir/il√ße</div>
            </div>
          </div>
        </div>

      <div class="profileCard" style="grid-column:1/-1">
          <div class="profileHeader"><div class="profileTitle">≈ûifre Deƒüi≈ütir</div></div>
          <div class="profileBody" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;align-items:end">
            <div class="formGroup" style="margin:0"><label>Mevcut ≈ûifre</label><input type="password" id="curPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
            <div class="formGroup" style="margin:0"><label>Yeni ≈ûifre</label><input type="password" id="newPass" placeholder="En az 6 karakter"></div>
            <button class="btnPrimary" onclick="updatePassword()" style="margin:0">≈ûifreyi Deƒüi≈ütir</button>
            <div class="profileMsg" id="passMsg" style="grid-column:1/-1"></div>
          </div>
        </div>

        <div class="profileCard" style="grid-column:1/-1;border:1.5px solid #fecaca">
          <div class="profileHeader" style="border-bottom-color:#fecaca"><div class="profileTitle" style="color:var(--danger)">Tehlikeli B√∂lge</div></div>
          <div class="profileBody">
            <p style="font-size:13.5px;color:var(--muted);margin-bottom:20px;line-height:1.7">
              Hesabƒ±nƒ±zƒ± sildiƒüinizde profiliniz, arama ge√ßmi≈üiniz ve sistemde kayƒ±tlƒ± t√ºm ki≈üisel verileriniz kalƒ±cƒ± olarak silinir.
              Bu i≈ülem <strong style="color:var(--danger)">geri alƒ±namaz</strong>.
            </p>
            <button onclick="hesapSilOnay()" style="background:var(--danger);color:white;border:none;border-radius:var(--radius);padding:11px 24px;font-family:'Outfit',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:opacity .15s" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">
              Hesabƒ±mƒ± Kalƒ±cƒ± Olarak Sil
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ƒ∞lan Ver -->
    <div id="page-ilanver" style="display:none">
      <div class="pageHeader"><div class="pageTitle">ƒ∞lan Ver</div><div class="pageSubtitle">Lojistik ilanƒ±nƒ±zƒ± yayƒ±nlayƒ±n</div></div>
      <div class="ilanForm">
        <div class="ilanFormTitle">üöõ Yeni ƒ∞lan Olu≈ütur</div>
        <div class="ilanFormSub">ƒ∞lan metninizi yazƒ±n. Telefon numaranƒ±z otomatik eklenecektir.</div>
        <textarea class="ilanTextarea" id="ilanMetin" placeholder="√ñrnek:&#10;ƒ∞STANBUL - ANKARA&#10;Y√ºk cinsi: Tekstil&#10;Tonaj: 10 ton&#10;Tarih: Yarƒ±n sabah" maxlength="1000" oninput="updateCharCount()"></textarea>
        <div class="ilanFormBottom">
          <div>
            <span class="charCount" id="charCount">0 / 1000</span>
            <span class="phoneNote" id="phoneNote" style="margin-left:8px">üìû Numaranƒ±z otomatik eklenecek</span>
          </div>
          <button class="btnSearch" onclick="ilanGonder()" id="ilanGonderBtn">üì¢ ƒ∞lanƒ± Yayƒ±nla</button>
        </div>
        <div id="ilanMsg" style="display:none;margin-top:12px;padding:10px 14px;border-radius:8px;font-size:13px"></div>
      </div>
      <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:var(--radius);padding:14px 18px;font-size:13px;color:#92400e">
        ‚ö†Ô∏è <strong>Hatƒ±rlatma:</strong> Yanƒ±ltƒ±cƒ± veya sahte ilan payla≈ümak hesabƒ±nƒ±zƒ±n askƒ±ya alƒ±nmasƒ±na neden olabilir.
      </div>
    </div>

    <!-- Kullanƒ±cƒ±lar -->
    <div id="page-kullanicilar" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Kullanƒ±cƒ± Y√∂netimi <span id="userCountBadge" style="font-size:12px;background:var(--accent);color:#fff;padding:2px 10px;border-radius:20px;margin-left:8px;vertical-align:middle"></span></div><div class="pageSubtitle">Sisteme eri≈üen kullanƒ±cƒ±larƒ± y√∂netin</div></div>
      <div class="card">
        <div class="addForm">
          <h4>Yeni Kullanƒ±cƒ± Ekle</h4>
          <div class="formRow">
            <div class="formGroup"><label>Kullanƒ±cƒ± Adƒ±</label><input type="text" id="newUsername" class="searchInput" placeholder="kullanici"></div>
            <div class="formGroup"><label>E-posta</label><input type="email" id="newUserEmail" class="searchInput" placeholder="mail@ornek.com"></div>
            <div class="formGroup"><label>≈ûifre</label><input type="password" id="newPassword" class="searchInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
            <div class="formGroup"><label>Rol</label><select id="newRole" class="searchInput"><option value="user">Kullanƒ±cƒ±</option><option value="admin">Admin</option></select></div>
            <button class="btnAdd" onclick="addUser()">+ Ekle</button>
          </div>
        </div>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Kullanƒ±cƒ±</th><th>E-posta</th><th>Telefon</th><th>Rol</th><th>Tarih</th><th>ƒ∞≈ülem</th></tr></thead>
            <tbody id="userTableBody"><tr><td colspan="6" style="text-align:center;color:var(--muted);padding:28px">Y√ºkleniyor...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Kara Liste -->
    <div id="page-blacklist" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Kara Liste</div><div class="pageSubtitle">Bu kelimeleri i√ßeren ilanlar g√∂sterilmez</div></div>
      <div class="card">
        <div id="blacklistTags" class="blGrid"><div class="loader"><div class="spinner"></div></div></div>
        <div class="blAdd">
          <input type="text" class="searchInput" id="newBlackword" placeholder="Engellenecek kelime...">
          <button class="btnAdd" onclick="addBlacklist()">+ Ekle</button>
        </div>
      </div>
    </div>

    <div id="page-hareketler" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">üìä Kullanƒ±cƒ± Hareketleri</div><div class="pageSubtitle">Giri≈ü, √ßƒ±kƒ±≈ü ve arama ge√ßmi≈üi</div></div>
        <button class="btn" onclick="loadHareketler()">üîÑ Yenile</button>
      </div>
      <div class="card" style="overflow-x:auto">
        <table class="dataTable">
          <thead>
            <tr>
              <th>Kullanƒ±cƒ±</th>
              <th>E-posta</th>
              <th>Telefon</th>
              <th>ƒ∞≈ülem</th>
              <th>Detay</th>
              <th>IP</th>
              <th>Zaman</th>
            </tr>
          </thead>
          <tbody id="hareketlerBody">
            <tr><td colspan="7" style="text-align:center;padding:32px;color:var(--muted)">Y√ºkleniyor...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Botlar -->
    <div id="page-botlar" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">ü§ñ WhatsApp Botlarƒ±</div><div class="pageSubtitle">Baƒülƒ± botlarƒ± y√∂netin, yeni bot ekleyin</div></div>
        <button class="btn" onclick="botEkleModal()">‚ûï Yeni Bot</button>
      </div>
      <div id="botlarGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px"></div>
    </div>

    <!-- ƒ∞leti≈üim -->
    <div id="page-iletisim" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">üí¨ Destek & ƒ∞leti≈üim</div><div class="pageSubtitle">Sorularƒ±nƒ±z i√ßin WhatsApp √ºzerinden bize ula≈üƒ±n</div></div>
      </div>

      <!-- WhatsApp Destek Kartƒ± -->
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:20px">
        <div class="card" style="padding:28px;text-align:center;border:2px solid #25D36622">
          <div style="font-size:52px;margin-bottom:12px">üí¨</div>
          <div style="font-size:18px;font-weight:700;margin-bottom:6px">WhatsApp Destek</div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:20px;line-height:1.6">
            Lojistik ilanlarƒ±, √ºyelik ve teknik konularda<br>7/24 destek alƒ±n.
          </div>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20Y√ºkleGit%20hakkƒ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:8px;background:#25D366;color:white;border-radius:10px;padding:12px 24px;text-decoration:none;font-weight:700;font-size:14px;transition:opacity .2s"
             onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">
            <svg width="20" height="20" viewBox="0 0 32 32" fill="white"><path d="M16 2C8.268 2 2 8.268 2 16c0 2.478.675 4.797 1.85 6.787L2 30l7.43-1.826A13.94 13.94 0 0016 30c7.732 0 14-6.268 14-14S23.732 2 16 2zm6.29 19.076c-.344-.172-2.036-1.004-2.352-1.118-.316-.115-.547-.172-.777.172-.23.344-.892 1.118-1.093 1.348-.2.23-.402.258-.747.086-.344-.172-1.454-.536-2.77-1.71-1.023-.913-1.714-2.04-1.915-2.385-.2-.344-.021-.53.15-.702.155-.155.344-.402.516-.603.172-.2.23-.344.344-.573.115-.23.058-.43-.029-.603-.086-.172-.777-1.876-1.064-2.566-.28-.672-.564-.58-.777-.59l-.661-.011c-.23 0-.603.086-.918.43s-1.207 1.176-1.207 2.867 1.236 3.326 1.408 3.555c.172.23 2.432 3.71 5.893 5.205.823.355 1.466.567 1.967.726.826.263 1.579.226 2.173.137.663-.1 2.036-.832 2.323-1.634.287-.803.287-1.49.2-1.634-.086-.143-.315-.23-.66-.402z"/></svg>
            WhatsApp'tan Yaz
          </a>
          <div style="margin-top:14px;font-size:12px;color:var(--muted)">+90 501 530 30 28</div>
        </div>

        <div class="card" style="padding:28px">
          <div style="font-size:18px;font-weight:700;margin-bottom:16px">üìã Sƒ±k Sorulan Sorular</div>
          <div style="display:flex;flex-direction:column;gap:12px">
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                ƒ∞lanlar ne kadar s√ºre g√∂r√ºn√ºr? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">ƒ∞lanlar yayƒ±nlandƒ±ktan itibaren 1 saat boyunca sistemde g√∂r√ºn√ºr kalƒ±r.</p>
            </details>
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                ƒ∞lan vermek i√ßin ne yapmalƒ±yƒ±m? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">"ƒ∞lan Ver" sayfasƒ±ndan kalkƒ±≈ü ve varƒ±≈ü noktasƒ±nƒ±, ara√ß t√ºr√ºn√º ve ileti≈üim bilgilerinizi girerek ilan olu≈üturabilirsiniz.</p>
            </details>
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                √úyelik √ºcretli mi? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">≈ûu an i√ßin √ºyelik tamamen √ºcretsizdir.</p>
            </details>
          </div>
        </div>
      </div>

      <!-- Hƒ±zlƒ± Mesaj ≈ûablonlarƒ± -->
      <div class="card" style="padding:24px">
        <div style="font-size:16px;font-weight:700;margin-bottom:14px">‚ö° Hƒ±zlƒ± Mesaj G√∂nder</div>
        <div style="display:flex;flex-wrap:wrap;gap:8px">
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20√ºyelik%20hakkƒ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            üë§ √úyelik bilgisi
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20ilan%20vermek%20istiyorum%2C%20yardƒ±mcƒ±%20olabilir%20misiniz%3F" target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            üì¶ ƒ∞lan vermek istiyorum
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20teknik%20bir%20sorun%20ya≈üƒ±yorum%2C%20yardƒ±mcƒ±%20olabilir%20misiniz%3F" target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            üîß Teknik sorun
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20bir%20≈üikayet%20iletmek%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            üì£ ≈ûikayet
          </a>
        </div>
      </div>
    </div>

    <!-- QR Modal -->
    <div id="qrModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center">
      <div style="background:var(--surface);border-radius:16px;padding:32px;max-width:380px;width:90%;text-align:center;position:relative">
        <button onclick="qrModalKapat()" style="position:absolute;top:12px;right:16px;background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)">‚úï</button>
        <div style="font-size:22px;font-weight:700;margin-bottom:6px" id="qrModalBaslik">QR Kod</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:20px" id="qrModalAlt">WhatsApp'ta Baƒülƒ± Cihazlar ‚Üí Cihaz Ekle ‚Üí QR'ƒ± tarat</div>
        <div id="qrModalIcerik" style="min-height:260px;display:flex;align-items:center;justify-content:center">
          <div class="spinner"></div>
        </div>
        <div id="qrModalDurum" style="margin-top:16px;font-size:13px;color:var(--muted)"></div>
        <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px">
          <button onclick="window.open('https://web.whatsapp.com/','_blank','noopener')"
            style="display:inline-flex;align-items:center;gap:8px;background:#25D366;color:white;border:none;border-radius:10px;padding:10px 20px;font-family:'Outfit',sans-serif;font-weight:700;font-size:13px;cursor:pointer;transition:opacity .2s"
            onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">
            <svg width="18" height="18" viewBox="0 0 32 32" fill="white"><path d="M16 2C8.268 2 2 8.268 2 16c0 2.478.675 4.797 1.85 6.787L2 30l7.43-1.826A13.94 13.94 0 0016 30c7.732 0 14-6.268 14-14S23.732 2 16 2zm6.29 19.076c-.344-.172-2.036-1.004-2.352-1.118-.316-.115-.547-.172-.777.172-.23.344-.892 1.118-1.093 1.348-.2.23-.402.258-.747.086-.344-.172-1.454-.536-2.77-1.71-1.023-.913-1.714-2.04-1.915-2.385-.2-.344-.021-.53.15-.702.155-.155.344-.402.516-.603.172-.2.23-.344.344-.573.115-.23.058-.43-.029-.603-.086-.172-.777-1.876-1.064-2.566-.28-.672-.564-.58-.777-.59l-.661-.011c-.23 0-.603.086-.918.43s-1.207 1.176-1.207 2.867 1.236 3.326 1.408 3.555c.172.23 2.432 3.71 5.893 5.205.823.355 1.466.567 1.967.726.826.263 1.579.226 2.173.137.663-.1 2.036-.832 2.323-1.634.287-.803.287-1.49.2-1.634-.086-.143-.315-.23-.66-.402z"/></svg>
            WhatsApp Web'i A√ß
          </button>
          <div style="margin-top:8px;font-size:11px;color:var(--muted);line-height:1.5">Telefonunuzdaki WhatsApp ile QR'ƒ± taratmak i√ßin<br>WhatsApp Web ‚Üí Baƒülƒ± Cihazlar ‚Üí Cihaz Ekle</div>
        </div>
      </div>
    </div>

    <!-- Bot Ekle Modal -->
    <div id="botEkleModalEl" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center">
      <div style="background:var(--surface);border-radius:16px;padding:32px;max-width:360px;width:90%">
        <div style="font-size:18px;font-weight:700;margin-bottom:20px">‚ûï Yeni Bot Ekle</div>
        <label style="font-size:13px;font-weight:600;color:var(--muted)">Bot ƒ∞smi</label>
        <input id="yeniBotIsim" type="text" class="searchInput" style="width:100%;margin-top:6px;margin-bottom:20px;box-sizing:border-box" placeholder="√ñrn: Ana Bot, Grup Bot 2...">
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btnReset" onclick="document.getElementById('botEkleModalEl').style.display='none'">ƒ∞ptal</button>
          <button class="btnSearch" onclick="botEkleKaydet()">Ekle ve QR G√∂ster</button>
        </div>
      </div>
    </div>
    <div id="telefonModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1001;align-items:center;justify-content:center">
      <div style="background:var(--surface);border-radius:16px;padding:32px;max-width:340px;width:90%;text-align:center">
        <div style="font-size:40px;margin-bottom:12px">üìû</div>
        <div style="font-size:17px;font-weight:700;margin-bottom:8px">Telefon Numarasƒ± Gerekli</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:24px;line-height:1.6">ƒ∞lan vermek i√ßin profilinizde kayƒ±tlƒ± bir telefon numarasƒ± olmasƒ± gerekiyor.</div>
        <div style="display:flex;gap:10px;justify-content:center">
          <button onclick="document.getElementById('telefonModal').style.display='none'"
            style="padding:10px 18px;border:1.5px solid var(--border);border-radius:8px;background:none;cursor:pointer;font-family:'Outfit',sans-serif;font-size:13px">Kapat</button>
          <button onclick="document.getElementById('telefonModal').style.display='none';showPage('profil')"
            style="padding:10px 18px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-family:'Outfit',sans-serif;font-size:13px;font-weight:700">Profili G√ºncelle</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="appFooter">
      <a href="/gizlilik" target="_blank" rel="noopener">Gizlilik Politikasƒ±</a>
      <span>¬∑</span>
      <a href="mailto:yuklegit.iletisim@gmail.com?subject=Veri%20Silme%20Talebi">Veri Silme Talebi</a>
    </div>
  </div>
</div>

<script>
let token=localStorage.getItem('yg_token');
let currentUser=JSON.parse(localStorage.getItem('yg_user')||'null');
let liveInterval=null,isLive=false,lastSearch={s1:'',s2:''};

// Google OAuth token yakalama
(function(){
  const p=new URLSearchParams(window.location.search);
  const gt=p.get('google_token'),gu=p.get('user');
  if(gt&&gu){try{token=gt;currentUser=JSON.parse(decodeURIComponent(gu));localStorage.setItem('yg_token',token);localStorage.setItem('yg_user',JSON.stringify(currentUser));}catch(e){}window.history.replaceState({},'','/');}
  if(p.get('error')==='google'){window.history.replaceState({},'','/');setTimeout(()=>{const el=document.getElementById('loginError');if(el){el.textContent='Google ile giri≈ü ba≈üarƒ±sƒ±z.';el.style.display='block';}},100);}
})();

// ‚îÄ‚îÄ KVKK Rƒ±za Modalƒ± ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _riza1=false,_riza2=false;
function toggleRiza(n){
  if(n===1){_riza1=!_riza1;document.getElementById('riza1Item').classList.toggle('checked',_riza1);document.getElementById('riza1Box').textContent=_riza1?'':'';}
  if(n===2){_riza2=!_riza2;document.getElementById('riza2Item').classList.toggle('checked',_riza2);document.getElementById('riza2Box').textContent=_riza2?'':'';}
  const btn=document.getElementById('rizaDevamBtn');
  if(_riza1&&_riza2){btn.classList.add('aktif');}else{btn.classList.remove('aktif');}
}
async function rizaOnayla(){
  if(!_riza1||!_riza2)return;
  try{
    await api('/api/consent/save',{method:'POST'});
    if(currentUser) localStorage.setItem('yg_consented_'+currentUser.id,'1');
  }catch(e){console.warn('Rƒ±za kaydedilemedi',e);}
  document.getElementById('rizaModal').style.display='none';
  _baslatApp();
}
async function checkConsent(){
  // Kullanƒ±cƒ±ya √∂zel key ‚Äî API √ßaƒürƒ±sƒ± yapmadan anƒ±nda kontrol
  if(currentUser && localStorage.getItem('yg_consented_'+currentUser.id)==='1') return true;
  try{
    const d=await api('/api/consent/check');
    if(d&&d.hasConsent && currentUser) localStorage.setItem('yg_consented_'+currentUser.id,'1');
    return !!(d&&d.hasConsent);
  }catch(e){return false;}
}
function gosterRizaModali(){
  _riza1=false;_riza2=false;
  document.getElementById('riza1Item').classList.remove('checked');
  document.getElementById('riza2Item').classList.remove('checked');
  document.getElementById('rizaDevamBtn').classList.remove('aktif');
  document.getElementById('rizaModal').style.display='flex';
}
// ‚îÄ‚îÄ Rƒ±za sonu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// Hamburger
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('show');
  document.getElementById('hamburger').classList.toggle('is-open');
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.remove('show');
  document.getElementById('hamburger').classList.remove('is-open');
}

// Auth sayfalarƒ±
function showReg(){['loginForm','forgotForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('regForm').style.display='block';}
function showLogin(){['regForm','forgotForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('loginForm').style.display='block';}
function showForgot(){['loginForm','regForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('forgotForm').style.display='block';}
function googleLogin(){window.location.href='/auth/google';}

async function login(){
  const username=document.getElementById('loginUser').value.trim();
  const password=document.getElementById('loginPass').value;
  const errEl=document.getElementById('loginError');
  errEl.style.display='none';document.getElementById('verifyWarn').style.display='none';
  try{
    const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
    const data=await res.json();
    if(!res.ok){if(data.needsVerification){document.getElementById('verifyWarn').style.display='block';window._unverifiedEmail=username;}throw new Error(data.error);}
    saveSession(data);initApp();
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

async function register(){
  const username=document.getElementById('regUser').value.trim();
  const email=document.getElementById('regEmail').value.trim();
  const phone=document.getElementById('regPhone').value.trim();
  const password=document.getElementById('regPass').value;
  const errEl=document.getElementById('regError');const okEl=document.getElementById('regSuccess');
  errEl.style.display='none';okEl.style.display='none';
  try{
    const res=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,email,phone,password})});
    const data=await res.json();
    if(!res.ok)throw new Error(data.error);
    if(data.needsVerification){okEl.textContent=data.message;okEl.style.display='block';return;}
    saveSession(data);initApp();
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

async function resendVerify(){
  const email=window._unverifiedEmail||document.getElementById('loginUser').value.trim();
  if(!email)return;
  await fetch('/api/resend-verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
  document.getElementById('verifyWarn').textContent='Doƒürulama maili g√∂nderildi, gelen kutunuzu kontrol edin.';
}

async function forgotPassword(){
  const email=document.getElementById('forgotEmail').value.trim();
  const errEl=document.getElementById('forgotError');const okEl=document.getElementById('forgotSuccess');
  errEl.style.display='none';okEl.style.display='none';
  try{
    const res=await fetch('/api/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
    const data=await res.json();
    okEl.textContent=data.message;okEl.style.display='block';
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

function saveSession(data){token=data.token;currentUser={...data.user};localStorage.setItem('yg_token',token);localStorage.setItem('yg_user',JSON.stringify(currentUser));}

function logout(){
  if(token) api('/api/logout',{method:'POST'}).catch(()=>{});localStorage.removeItem('yg_token');localStorage.removeItem('yg_user');token=null;currentUser=null;document.getElementById('app').style.display='none';document.getElementById('authWrap').style.display='flex';document.getElementById('hamburger').style.display='none';showLogin();}

async function initApp(){
  document.getElementById('authWrap').style.display='none';
  // Rƒ±za daha √∂nce verilmi≈üse (localStorage'da var) anƒ±nda ba≈ülat ‚Äî API bekleme yok
  if(currentUser && localStorage.getItem('yg_consented_'+currentUser.id)==='1'){
    _baslatApp(); return;
  }
  // ƒ∞lk kez veya yeni cihaz: DB'yi kontrol et
  const consented=await checkConsent();
  if(!consented){gosterRizaModali();return;}
  _baslatApp();
}
function _baslatApp(){
  document.getElementById('app').style.display='block';
  if(window.innerWidth <= 768) document.getElementById('hamburger').style.display='flex';
  document.getElementById('userNameDisplay').textContent=currentUser.username;
  document.getElementById('userRoleDisplay').textContent=currentUser.role==='admin'?'Admin':'Kullanƒ±cƒ±';
  document.getElementById('userAvatar').textContent=currentUser.username[0].toUpperCase();
  if(currentUser.role==='admin'){document.getElementById('adminNav').style.display='block';}
  loadStats();
  // Kaydedilmi≈ü filtreleri √∂nce uygula, ardƒ±ndan tek seferde ilan y√ºkle
  try{
    const _raw=localStorage.getItem('yg_filters');
    if(_raw){const _f=JSON.parse(_raw);if(Array.isArray(_f.nereden))dualState.nereden=_f.nereden;if(Array.isArray(_f.nereye))dualState.nereye=_f.nereye;renderDualTags('nereden');renderDualTags('nereye');}
  }catch(e){}
  if(dualState.nereden.length||dualState.nereye.length) araIlanlar(); else loadIlanlar();
  if(bildirimAktif && seciliSehirler.length>0) baslatBildirimKontrol();
  // Bildirim kart durumunu g√ºncelle
  setTimeout(loadProfilBildirim, 300);
  // ≈ûehir √∂nerileri i√ßin listeyi y√ºkle (artƒ±k loadSearchFilters tetiklenmiyor ‚Äî filtreler yukarƒ±da uygulandƒ±)
  api('/api/sehirler').then(d=>{ if(d&&d.sehirler){ window._tumSehirler=d.sehirler; } });
  if (!currentUser.phone || !currentUser.phone.trim()) {
    document.getElementById('telefonBanner').style.display = 'block';
  }
}

function showPage(page){
  ['ilanlar','profil','ilanver','iletisim','kullanicilar','blacklist','hareketler','botlar'].forEach(p=>{
    const el=document.getElementById('page-'+p);if(el)el.style.display=p===page?'block':'none';
    const nav=document.getElementById('nav-'+p);if(nav)nav.classList.toggle('active',p===page);
  });
  closeSidebar();
  if(page === 'ilanver'){
    if(!currentUser.phone || !currentUser.phone.trim()){
      document.getElementById('telefonModal').style.display='flex';
      return;
    }
  }
  if(page==='profil')loadProfil();
  if(page==='kullanicilar')loadUsers();
  if(page==='blacklist')loadBlacklist();
  if(page==='hareketler')loadHareketler();
  if(page==='botlar')loadBotlar();
  if(page==='iletisim'){ /* statik sayfa, y√ºkleme gerekmez */ }
}

async function api(url,opts={}){
  const res=await fetch(url,{...opts,headers:{'Content-Type':'application/json','Authorization':'Bearer '+token,...(opts.headers||{})}});
  if(res.status===401){logout();return null;}
  return res.json();
}

async function loadStats(){
  const d=await api('/api/stats');if(!d)return;
  const el=document.getElementById('statTotal');
  if(el) el.textContent=d.total;
}

async function loadIlanlar(s1,s2){
  document.getElementById('ilanList').innerHTML='<div class="loader"><div class="spinner"></div></div>';
  let url='/api/ilanlar';
  if(s1){url+='?sehir1='+encodeURIComponent(s1);if(s2)url+='&sehir2='+encodeURIComponent(s2);}
  const data=await api(url);if(!data)return;
  const ilanlar=data.ilanlar||data;
  if(data.hata){document.getElementById('ilanCountNum').textContent='0';document.getElementById('ilanList').innerHTML='<div class="emptyState"><div class="emptyIcon">üîç</div><p>'+esc(data.hata)+'</p></div>';return;}
  const allTerms = new Set([...(data.matchedTerms||[]),...getSearchTags()].map(t=>t.toLowerCase()).filter(Boolean));
  renderIlanlar(ilanlar,[...allTerms], data.ilceler1||[], data.ilceler2||[]);
  loadStats();
}

// √áoklu nereden √ó nereye aramasƒ±
async function loadIlanlarCoklu(neredenList, nereyeList){
  document.getElementById('ilanList').innerHTML='<div class="loader"><div class="spinner"></div></div>';

  if(!neredenList.length && !nereyeList.length){ loadIlanlar(); return; }

  const ikiyonMod = neredenList.length > 0 && nereyeList.length > 0;

  // Kombinasyonlarƒ± olu≈ütur ‚Äî ikiyon modda hem tam (s1√ós2) hem kƒ±smi (s1-only) istekler
  const kombinasyonlar = [];
  if(ikiyonMod){
    for(const s1 of neredenList)
      for(const s2 of nereyeList)
        kombinasyonlar.push({s1, s2, kismi: false});
    // Kƒ±smi e≈üle≈üme: sadece nereden ‚Äî sonu√ßta tam e≈üle≈üme yoksa opacity ile g√∂sterilecek
    for(const s1 of neredenList)
      kombinasyonlar.push({s1, s2: null, kismi: true});
  } else if(neredenList.length){
    for(const s1 of neredenList) kombinasyonlar.push({s1, s2:null, kismi:false});
  } else {
    for(const s1 of nereyeList) kombinasyonlar.push({s1, s2:null, kismi:false});
  }

  try {
    // T√ºm istekler paralel
    const sonuclar = await Promise.all(kombinasyonlar.map(({s1,s2})=>{
      let url='/api/ilanlar?sehir1='+encodeURIComponent(s1);
      if(s2) url+='&sehir2='+encodeURIComponent(s2);
      return api(url);
    }));

    const ilanMap = new Map();
    const tamHashes = new Set();
    const allMatchedTerms = new Set(getSearchTags().map(t=>t.toLowerCase()));
    let mergedIlceler1 = [], mergedIlceler2 = [];

    // 1. Ge√ßi≈ü: tam e≈üle≈ümeleri i≈üle (kismi:false)
    sonuclar.forEach((data, idx)=>{
      if(!data||data.hata||kombinasyonlar[idx].kismi) return;
      (data.matchedTerms||[]).forEach(t=>allMatchedTerms.add(t.toLowerCase()));
      if(data.ilceler1) mergedIlceler1=[...new Set([...mergedIlceler1,...data.ilceler1])];
      if(data.ilceler2) mergedIlceler2=[...new Set([...mergedIlceler2,...data.ilceler2])];
      (data.ilanlar||[]).forEach(ilan=>{
        const key=ilan.hash||String(ilan.id||ilan.timestamp);
        if(!ilanMap.has(key)){ ilanMap.set(key, ilan); tamHashes.add(key); }
      });
    });

    // 2. Ge√ßi≈ü: kƒ±smi e≈üle≈ümeleri i≈üle ‚Äî tam e≈üle≈ümede yoksa _kismi:true ile ekle
    sonuclar.forEach((data, idx)=>{
      if(!data||data.hata||!kombinasyonlar[idx].kismi) return;
      if(data.ilceler1) mergedIlceler1=[...new Set([...mergedIlceler1,...data.ilceler1])];
      (data.ilanlar||[]).forEach(ilan=>{
        const key=ilan.hash||String(ilan.id||ilan.timestamp);
        if(!ilanMap.has(key)) ilanMap.set(key, {...ilan, _kismi:true});
      });
    });

    const ilanlar = [...ilanMap.values()].sort((a,b)=>b.timestamp-a.timestamp);

    if(!ilanlar.length){
      document.getElementById('ilanCountNum').textContent='0';
      document.getElementById('ilanList').innerHTML='<div class="emptyState"><div class="emptyIcon">üì≠</div><p>Aradƒ±ƒüƒ±nƒ±z kriterlere uygun ilan bulunamadƒ±.</p></div>';
      return;
    }
    renderIlanlar(ilanlar,[...allMatchedTerms], mergedIlceler1, mergedIlceler2);
    loadStats();
  } catch(e){
    console.error('√áoklu arama hata:',e);
    loadIlanlar(neredenList[0],nereyeList[0]);
  }
}

function renderIlanlar(ilanlar, matchedTerms=[], ilceler1=[], ilceler2=[]){
  if(!ilanlar.length){
    document.getElementById('ilanCountNum').textContent = '0';
    document.getElementById('ilanList').innerHTML = '<div class="emptyState"><div class="emptyIcon">üì≠</div><p>Aradƒ±ƒüƒ±nƒ±z kriterlere uygun ilan bulunamadƒ±.</p></div>';
    return;
  }

  const aramaVar = dualState.nereden.length > 0 || dualState.nereye.length > 0;
  const ikiyonMod = ilceler1.length > 0 && ilceler2.length > 0;

  // ƒ∞ki y√∂n modunda tam ve kƒ±smi e≈üle≈ümeleri ayƒ±r, tam olanlar √∂nce
  let sirali = ilanlar;
  if(ikiyonMod){
    const tam   = ilanlar.filter(i => !i._kismi).sort((a,b)=>b.timestamp-a.timestamp);
    const kismi = ilanlar.filter(i =>  i._kismi).sort((a,b)=>b.timestamp-a.timestamp);
    sirali = [...tam, ...kismi];
    document.getElementById('ilanCountNum').textContent = tam.length;
  } else {
    document.getElementById('ilanCountNum').textContent = ilanlar.length;
  }

  document.getElementById('ilanList').innerHTML = sirali.map((ilan, i) => {
    const text = ilan.text || '';
    const isKismi = !!ilan._kismi;

    let ilanHTML = '';
    if(isKismi){
      // Kƒ±smi e≈üle≈üme: ham metin ‚Äî hi√ßbir fonksiyon √ßaƒürƒ±lmaz, span/hl √ºretilmez
      ilanHTML = `<div class="ilanText">${esc(text)}</div>`;
    } else if(aramaVar){
      ilanHTML = renderSatirlar(text, matchedTerms, ilceler1, ilceler2);
    } else {
      ilanHTML = `<div class="ilanText">${hlText(text, matchedTerms)}</div>`;
    }

    // Sadece e≈üle≈üen ≈üehir etiketlerini g√∂ster
    const etiketSehirler = (ilan.cities || []).filter(c => {
      if(!aramaVar) return true;
      const nc = normTR(c);
      return matchedTerms.some(t => normTR(t) === nc);
    });

    const opacityStyle = isKismi ? 'opacity:0.4;transition:opacity .2s' : '';
    const kismiClass = isKismi ? ' ilanCardKismi' : '';

    return `
    <div class="ilanCard${kismiClass}" style="${opacityStyle}">
      <div class="ilanMeta">
        <span class="ilanNum">ƒ∞lan ${i+1}</span>
        <span class="ilanTime">‚è± ${timeAgo(ilan.timestamp)}</span>
        <button class="paylasBtn" onclick="ilanPaylas(this)" data-text="${esc(ilan.text||'').replace(/"/g,'&quot;')}" data-chat="${esc(ilan.chatName||'')}">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          Payla≈ü
        </button>
      </div>
      ${ilanHTML}
      ${etiketSehirler.length ? `<div class="ilanSehirler">${etiketSehirler.map(c=>`<span class="sehirTag">${esc(formatSehir(c))}</span>`).join('')}</div>` : ''}
    </div>`;
  }).join('');
}

// Satƒ±r bazlƒ± akƒ±llƒ± render:
// Senaryo 1 ‚Äî Sadece nereden: satƒ±rda nereden ≈üehri ge√ßiyorsa vurgula
// Senaryo 2 ‚Äî Sadece nereye:  satƒ±rda nereye ≈üehri ge√ßiyorsa vurgula
// Senaryo 3 ‚Äî ƒ∞kisi de dolu:  SADECE ikisi birden ge√ßen VE nereden √∂nde olan satƒ±rlarƒ± vurgula
//   ‚Üí Biri eksikse ‚Üí soluk  |  ters sƒ±radaysa ‚Üí √ºst√º √ßizili soluk
function renderSatirlar(text, matchedTerms, ilceler1, ilceler2){
  const norm = s => String(s||'')
    .replace(/ƒ∞/g,'i').replace(/I/g,'i').replace(/ƒ±/g,'i')
    .replace(/ƒû/g,'g').replace(/ƒü/g,'g')
    .replace(/√ú/g,'u').replace(/√º/g,'u')
    .replace(/≈û/g,'s').replace(/≈ü/g,'s')
    .replace(/√ñ/g,'o').replace(/√∂/g,'o')
    .replace(/√á/g,'c').replace(/√ß/g,'c')
    .toLowerCase().replace(/[^a-z0-9]/g,' ').replace(/\s+/g,' ').trim();

  const nList1 = (ilceler1||[]).map(norm).filter(Boolean);
  const nList2 = (ilceler2||[]).map(norm).filter(Boolean);
  const normTerms = matchedTerms.map(norm).filter(Boolean);

  const telRegex = /(?<!\d)((?:\+\s*90\s*|0\s*)\(?\s*[2-9]\d{2}\s*\)?(?:[ .\-]?\d){7})(?!\d)/;
  const aramaIkiYon = nList1.length > 0 && nList2.length > 0;

  const satirlar = text.split(/\n/);

  const parcalar = satirlar.map(satir => {
    const ns = norm(satir);

    // Telefon satƒ±rƒ± ‚Äî HER ZAMAN tam g√∂r√ºn√ºr
    if(telRegex.test(satir)){
      return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
    }

    if(aramaIkiYon){
      // Her iki ≈üehrin satƒ±rdaki ilk pozisyonunu bul
      let p1 = Infinity;
      for(const n of nList1){ const idx=ns.indexOf(n); if(idx!==-1&&idx<p1) p1=idx; }
      let p2 = Infinity;
      for(const n of nList2){ const idx=ns.indexOf(n); if(idx!==-1&&idx<p2) p2=idx; }

      const var1 = p1 !== Infinity;
      const var2 = p2 !== Infinity;

      if(var1 && var2){
        // Her ikisi de var ‚Äî y√∂n kontrol√º
        if(p1 < p2) return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
        // Ters sƒ±ra ‚Üí sadece soluk, √ßizgi yok
        return `<span class="satirSoluk">${esc(satir)}</span>`;
      }
      // Sadece biri var veya ikisi de yok ‚Üí solukla≈ütƒ±r
      return `<span class="satirSoluk">${esc(satir)}</span>`;
    }

    // Tek ≈üehir aramasƒ± (senaryo 1 veya 2)
    const satirdeEslesme = normTerms.some(t => t && ns.includes(t));
    if(!satirdeEslesme) return `<span class="satirSoluk">${esc(satir)}</span>`;
    return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
  });

  return `<div class="ilanText ilanTextSatir">${parcalar.join('\n')}</div>`;
}

function maskeTelefon(numStr) {
  const digits = String(numStr).replace(/\D/g, '');
  const local = '0' + digits.slice(-10); // "05321234567"
  return local.slice(0, 4) + ' *** ** ' + local.slice(-2);
}

function hlText(text, terms){
  // 1. Metni par√ßalara b√∂l: tel numaralarƒ± ayrƒ±, gerisi ayrƒ±
  // Desteklenen formatlar:
  //   05321234567        ‚Üí biti≈üik
  //   0546 521 09 29     ‚Üí bo≈üluklu gruplar
  //   *0507 448 43 40*   ‚Üí WhatsApp kalƒ±n (yƒ±ldƒ±z) formatƒ±
  //   0532-123-45-67     ‚Üí tireli
  //   +90 532 123 45 67  ‚Üí √ºlke kodu + bo≈üluklu
  const TEL_RE = /(?<!\d)[*_~]?((?:\+\s*90\s*|0\s*)\(?\s*[2-9]\d{2}\s*\)?(?:[ .\-]?\d){7})[*_~]?(?!\d)/g;
  const parcalar = []; // {type:'text'|'tel', val}
  let son = 0, m;
  TEL_RE.lastIndex = 0;
  while ((m = TEL_RE.exec(text)) !== null) {
    if (m.index > son) parcalar.push({ type: 'text', val: text.slice(son, m.index) });
    parcalar.push({ type: 'tel', val: m[1] }); // m[1] = sadece rakamlar+bo≈üluk, yƒ±ldƒ±zsƒ±z
    son = m.index + m[0].length;
  }
  if (son < text.length) parcalar.push({ type: 'text', val: text.slice(son) });

  // 2. T√ºrk√ße karakter varyantƒ±
  function trVaryant(s){
    return s.replace(/i/g,'[iƒ∞]').replace(/ƒ±/g,'[ƒ±I]')
            .replace(/g/g,'[gƒüG]').replace(/u/g,'[u√ºU]')
            .replace(/s/g,'[s≈üS]').replace(/o/g,'[o√∂O]')
            .replace(/c/g,'[c√ßC]');
  }

  // 3. Metin par√ßalarƒ±na ≈üehir highlight uygula
  const sorted = (terms||[]).filter(Boolean).sort((a,b)=>b.length-a.length);
  function highlightText(str) {
    let r = esc(str);
    sorted.forEach(term => {
      try {
        const pat = trVaryant(term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));
        const re = new RegExp('(?<![a-zA-Zƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á])('+pat+')(?![a-zA-Zƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á])','gi');
        r = r.replace(re, (_,p1) => '<span class="hl">'+p1+'</span>');
      } catch(e){}
    });
    return r;
  }

  // 4. Birle≈ütir
  return parcalar.map(p => {
    if (p.type === 'tel') {
      const digits = p.val.replace(/\D/g, '');
      const intl = '+90' + digits.slice(-10);
      const wa = '90' + digits.slice(-10);
      const masked = maskeTelefon(p.val);
      return '<span class="telGrup">' +
        '<span class="telMasked">üìû ' + esc(masked) + '</span>' +
        '<span class="telBtnRow">' +
        '<a href="tel:' + intl + '" class="telBtn telBtnAra">üìû Hemen Ara</a>' +
        '<a href="https://wa.me/' + wa + '" class="telBtn telBtnWa" target="_blank" rel="noopener">üü¢ WhatsApp\'tan Yaz</a>' +
        '</span></span>';
    }
    return highlightText(p.val);
  }).join('');
}

function updateCharCount(){
  const ta=document.getElementById('ilanMetin');
  const cc=document.getElementById('charCount');
  if(!ta||!cc)return;
  const n=ta.value.length;
  cc.textContent=n+' / 1000';
  cc.className='charCount'+(n>900?' warn':'');
}

async function ilanGonder(){
  const metin=document.getElementById('ilanMetin').value.trim();
  const msgEl=document.getElementById('ilanMsg');
  const btn=document.getElementById('ilanGonderBtn');
  if(!metin){msgEl.textContent='ƒ∞lan metni bo≈ü olamaz.';msgEl.style.background='#fef2f2';msgEl.style.color='var(--danger)';msgEl.style.border='1px solid #fecaca';msgEl.style.display='block';return;}
  btn.disabled=true;btn.textContent='Yayƒ±nlanƒ±yor...';
  try{
    const res=await api('/api/ilan-olustur',{method:'POST',body:JSON.stringify({metin})});
    if(res&&res.ok){
      msgEl.textContent='‚úÖ '+res.message;msgEl.style.background='#f0fdf4';msgEl.style.color='var(--success)';msgEl.style.border='1px solid #bbf7d0';msgEl.style.display='block';
      document.getElementById('ilanMetin').value='';updateCharCount();
      setTimeout(()=>msgEl.style.display='none',4000);
    }else if(res){
      msgEl.textContent=res.error;msgEl.style.background='#fef2f2';msgEl.style.color='var(--danger)';msgEl.style.border='1px solid #fecaca';msgEl.style.display='block';
    }
  }catch(e){msgEl.textContent='Bir hata olu≈ütu.';msgEl.style.display='block';}
  btn.disabled=false;btn.textContent='üì¢ ƒ∞lanƒ± Yayƒ±nla';
}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

async function ilanPaylas(btn) {
  const text = btn.getAttribute('data-text') || '';
  const sep = '------------------------------------';
  const paylasMetin =
    'üì¶ Y√ºkleGit - Yeni ƒ∞lan Bildirimi\n' + sep + '\n' +
    text + '\n' + sep + '\n' +
    'üöÄ Bunun gibi onlarca g√ºncel ilanƒ± anlƒ±k takip etmek ve √ºcretsiz ilan vermek i√ßin sitemize g√∂z atƒ±n:\n' +
    'üëâ ' + window.location.origin;

  // Web Share API varsa kullan (mobil)
  if (navigator.share) {
    try {
      await navigator.share({ text: paylasMetin });
      return;
    } catch(e) {
      if (e.name === 'AbortError') return; // kullanƒ±cƒ± iptal etti
    }
  }
  // Yoksa panoya kopyala
  try {
    await navigator.clipboard.writeText(paylasMetin);
    const orig = btn.innerHTML;
    btn.innerHTML = '‚úÖ Kopyalandƒ±';
    btn.style.borderColor = '#16a34a';
    btn.style.color = '#16a34a';
    setTimeout(() => { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 2000);
  } catch {
    // Eski tarayƒ±cƒ± fallback
    const ta = document.createElement('textarea');
    ta.value = paylasMetin;
    ta.style.position = 'fixed'; ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    const orig = btn.innerHTML;
    btn.innerHTML = '‚úÖ Kopyalandƒ±';
    setTimeout(() => { btn.innerHTML = orig; }, 2000);
  }
}
function timeAgo(ts){
  const d=Math.floor((Date.now()-ts)/1000);
  if(d<60)return d+' sn √∂nce';if(d<3600)return Math.floor(d/60)+' dk √∂nce';
  const h=Math.floor(d/3600),m=Math.floor((d%3600)/60);return m>0?h+' sa '+m+' dk √∂nce':h+' sa √∂nce';
}

// ‚îÄ‚îÄ √áoklu Arama Kutusu (Nereden / Nereye) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Her iki tarafta da birden fazla ≈üehir se√ßilebilir
// "ƒ∞stanbul veya Ankara'dan ‚Üí Samsun veya Trabzon'a" gibi
const dualState = { nereden: [], nereye: [] };
const dualOneriIdx = { nereden: -1, nereye: -1 };

// ‚îÄ‚îÄ Filtre localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveSearchFilters(){
  localStorage.setItem('yg_filters', JSON.stringify({ nereden: dualState.nereden, nereye: dualState.nereye }));
}
function loadSearchFilters(){
  try{
    const raw = localStorage.getItem('yg_filters');
    if(!raw) return;
    const f = JSON.parse(raw);
    if(Array.isArray(f.nereden)) dualState.nereden = f.nereden;
    if(Array.isArray(f.nereye))  dualState.nereye  = f.nereye;
    renderDualTags('nereden');
    renderDualTags('nereye');
    if(dualState.nereden.length || dualState.nereye.length) araIlanlar();
  }catch(e){}
}
function swapDual(){
  const tmp = [...dualState.nereden];
  dualState.nereden = [...dualState.nereye];
  dualState.nereye  = tmp;
  renderDualTags('nereden');
  renderDualTags('nereye');
  saveSearchFilters();
  araIlanlar();
}
// ‚îÄ‚îÄ Filtre sonu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function normTR(s){
  return String(s||'')
    .replace(/ƒ∞/g,'i').replace(/I/g,'i').replace(/ƒ±/g,'i')
    .replace(/ƒû/g,'g').replace(/ƒü/g,'g')
    .replace(/√ú/g,'u').replace(/√º/g,'u')
    .replace(/≈û/g,'s').replace(/≈ü/g,'s')
    .replace(/√ñ/g,'o').replace(/√∂/g,'o')
    .replace(/√á/g,'c').replace(/√ß/g,'c')
    .toLowerCase().trim();
}

// Geriye d√∂n√ºk uyumluluk ‚Äî aiAra ve hlText i√ßin
function getSearchTags(){
  return [...dualState.nereden, ...dualState.nereye];
}

function formatSehir(s){
  return String(s||'').split(' ').map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(' ');
}

function focusDualInput(hangi){
  const inp = document.getElementById(hangi+'Input');
  if(inp && inp.style.display !== 'none') inp.focus();
}

function renderDualTags(hangi){
  const tagsEl = document.getElementById(hangi+'Tags');
  const inp    = document.getElementById(hangi+'Input');
  const wrap   = document.getElementById(hangi+'Wrap');
  if(!tagsEl) return;
  const list = dualState[hangi];

  tagsEl.innerHTML = list.map((s,i) => `<span class="dualTag">${esc(formatSehir(s))}<button onmousedown="event.preventDefault();removeDualTag('${hangi}',${i})" title="Kaldƒ±r">‚úï</button></span>`).join('');

  // Placeholder g√ºncelle
  if(inp){
    inp.style.display = '';
    if(list.length === 0){
      inp.placeholder = hangi==='nereden' ? 'Kalkƒ±≈ü ≈üehri ekleyin...' : 'Varƒ±≈ü ≈üehri ekleyin (opsiyonel)...';
    } else {
      inp.placeholder = '+ ≈üehir ekle...';
    }
  }
  if(wrap) wrap.classList.toggle('has-tag', list.length > 0);
}

function removeDualTag(hangi, idx){
  dualState[hangi].splice(idx, 1);
  renderDualTags(hangi);
  saveSearchFilters();
  araIlanlar();
}

function dualEkle(hangi, sehir){
  if(!sehir) return;
  const temiz = sehir.trim();
  if(!temiz) return;
  // Aynƒ± ≈üehir zaten ekliyse atla
  if(dualState[hangi].some(s => normTR(s) === normTR(temiz))) {
    const inp = document.getElementById(hangi+'Input');
    if(inp){ inp.value=''; }
    const box = document.getElementById(hangi+'OneriBox');
    if(box) box.style.display='none';
    return;
  }
  dualState[hangi].push(temiz);
  renderDualTags(hangi);
  const box = document.getElementById(hangi+'OneriBox');
  if(box) box.style.display='none';
  dualOneriIdx[hangi] = -1;
  const inp = document.getElementById(hangi+'Input');
  if(inp){ inp.value=''; inp.focus(); }
  saveSearchFilters();
  araIlanlar();
}

function dualOneri(hangi){
  const inp = document.getElementById(hangi+'Input');
  const box = document.getElementById(hangi+'OneriBox');
  if(!inp||!box) return;
  const val = inp.value.trim();
  if(!val||val.length<1){ box.style.display='none'; return; }
  const nval = normTR(val);
  const tumSehirler = window._tumSehirler||[];
  const baslayan = tumSehirler.filter(s=>normTR(s).startsWith(nval));
  const iceren   = tumSehirler.filter(s=>!normTR(s).startsWith(nval)&&normTR(s).includes(nval));
  const eslesme  = [...baslayan,...iceren].slice(0,10);
  if(!eslesme.length){ box.style.display='none'; return; }
  dualOneriIdx[hangi] = -1;
  // Zaten se√ßili olanlarƒ± i≈üaretle
  const seciliSet = new Set([...dualState.nereden,...dualState.nereye].map(normTR));
  box.innerHTML = eslesme.map(s=>{
    const secili = seciliSet.has(normTR(s));
    return `<div class="dualOneriItem${secili?' eklenmis':''}" data-val="${esc(s)}"
      onmousedown="event.preventDefault();dualEkle('${hangi}','${esc(s)}')">${esc(formatSehir(s))}${secili?' <small style=\'opacity:.5\'>(eklendi)</small>':''}</div>`;
  }).join('');
  box.style.display='block';
}

function dualKeydown(e, hangi){
  const box   = document.getElementById(hangi+'OneriBox');
  const items = box ? box.querySelectorAll('.dualOneriItem:not(.eklenmis)') : [];
  const boxAcik = box && box.style.display!=='none' && items.length>0;
  const inp   = document.getElementById(hangi+'Input');

  if(e.key==='ArrowDown'){
    e.preventDefault();
    if(!boxAcik) return;
    dualOneriIdx[hangi] = Math.min(dualOneriIdx[hangi]+1, items.length-1);
    items.forEach((el,i)=>el.classList.toggle('aktif',i===dualOneriIdx[hangi]));
    if(items[dualOneriIdx[hangi]]) items[dualOneriIdx[hangi]].scrollIntoView({block:'nearest'});
  } else if(e.key==='ArrowUp'){
    e.preventDefault();
    if(!boxAcik) return;
    dualOneriIdx[hangi] = Math.max(dualOneriIdx[hangi]-1, 0);
    items.forEach((el,i)=>el.classList.toggle('aktif',i===dualOneriIdx[hangi]));
    if(items[dualOneriIdx[hangi]]) items[dualOneriIdx[hangi]].scrollIntoView({block:'nearest'});
  } else if(e.key==='Enter'){
    e.preventDefault();
    if(boxAcik && dualOneriIdx[hangi]>=0 && items[dualOneriIdx[hangi]]){
      dualEkle(hangi, items[dualOneriIdx[hangi]].dataset.val);
    } else if(inp && inp.value.trim()){
      const match=(window._tumSehirler||[]).find(s=>normTR(s)===normTR(inp.value.trim()));
      dualEkle(hangi, match||inp.value.trim());
    } else {
      araIlanlar();
    }
  } else if(e.key==='Backspace'){
    if(inp && inp.value==='' && dualState[hangi].length>0){
      dualState[hangi].pop();
      renderDualTags(hangi);
      saveSearchFilters();
      araIlanlar();
    }
  } else if(e.key==='Escape'){
    if(box) box.style.display='none';
    dualOneriIdx[hangi]=-1;
  }
}

// Dƒ±≈üarƒ± tƒ±klayƒ±nca kapat
document.addEventListener('click', e=>{
  ['nereden','nereye'].forEach(hangi=>{
    const box = document.getElementById(hangi+'OneriBox');
    if(box && !e.target.closest('#'+hangi+'Wrap')){
      box.style.display='none';
      dualOneriIdx[hangi]=-1;
    }
  });
});

function araIlanlar(){
  // √áoklu se√ßimde: her nereden √ó nereye kombinasyonunu ara, birle≈ütir
  const neredenList = dualState.nereden;
  const nereyeList  = dualState.nereye;
  lastSearch = {
    s1: neredenList[0]||'',
    s2: nereyeList[0]||''
  };
  loadIlanlarCoklu(neredenList, nereyeList);
}

function resetArama(){
  dualState.nereden = [];
  dualState.nereye  = [];
  renderDualTags('nereden');
  renderDualTags('nereye');
  lastSearch = {s1:'',s2:''};
  localStorage.removeItem('yg_filters');
  ['nereden','nereye'].forEach(h=>{
    const inp=document.getElementById(h+'Input');
    const box=document.getElementById(h+'OneriBox');
    if(inp){inp.value='';inp.style.display='';}
    if(box) box.style.display='none';
  });
  loadIlanlar();
}

function toggleLive(){
  isLive=!isLive;
  document.getElementById('liveBtn').classList.toggle('active',isLive);
  if(isLive) liveInterval=setInterval(()=>araIlanlar(),15000);
  else clearInterval(liveInterval);
}



window.addEventListener('resize',()=>{
  const hb=document.getElementById('hamburger');
  if(!hb||!token)return;
  hb.style.display=window.innerWidth<=768?'flex':'none';
  if(window.innerWidth>768)closeSidebar();
});

// Profil
function loadProfil(){loadProfilBildirim();
  document.getElementById('profileUsername').textContent=currentUser.username;
  document.getElementById('profileEmail').textContent=currentUser.email||'‚Äî';
  document.getElementById('profilePhone').textContent=currentUser.phone||'‚Äî';
  const isA=currentUser.role==='admin';
  document.getElementById('profileRole').innerHTML=`<span style="display:inline-block;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700;background:${isA?'#eff6ff':'#f0fdf4'};color:${isA?'var(--accent)':'var(--success)'}">${isA?'Admin':'Kullanƒ±cƒ±'}</span>`;
  document.getElementById('newEmail').value=currentUser.email||'';
  document.getElementById('newPhone').value=currentUser.phone||'';
}
async function updateEmail(){
  const email=document.getElementById('newEmail').value.trim();
  const data=await api('/api/profile',{method:'PUT',body:JSON.stringify({email})});if(!data)return;
  if(data.ok){currentUser.email=email;localStorage.setItem('yg_user',JSON.stringify(currentUser));showMsg('emailMsg','E-posta g√ºncellendi!','ok');loadProfil();}
  else showMsg('emailMsg',data.error,'err');
}
async function updatePassword(){
  const currentPassword=document.getElementById('curPass').value,newPassword=document.getElementById('newPass').value;
  const data=await api('/api/profile',{method:'PUT',body:JSON.stringify({currentPassword,newPassword})});if(!data)return;
  if(data.ok){document.getElementById('curPass').value='';document.getElementById('newPass').value='';showMsg('passMsg','≈ûifre ba≈üarƒ±yla deƒüi≈ütirildi!','ok');}
  else showMsg('passMsg',data.error,'err');
}
async function updatePhone(){
  const phone=document.getElementById('newPhone').value.trim();
  if(!phone){showMsg('phoneMsg','Telefon numarasƒ± bo≈ü olamaz','err');return;}
  const data=await api('/api/profile',{method:'PUT',body:JSON.stringify({phone})});if(!data)return;
  if(data.ok){
    currentUser.phone=data.user?.phone||phone;
    localStorage.setItem('yg_user',JSON.stringify(currentUser));
    document.getElementById('telefonBanner').style.display='none';
    showMsg('phoneMsg','Telefon numarasƒ± g√ºncellendi!','ok');
    loadProfil();
  }else showMsg('phoneMsg',data.error,'err');
}
function showMsg(id,msg,type){const el=document.getElementById(id);el.textContent=msg;el.className='profileMsg '+type;el.style.display='block';setTimeout(()=>el.style.display='none',4000);}

// Kullanƒ±cƒ±lar
async function loadUsers(){
  const users=await api('/api/users');if(!users)return;
  const badge=document.getElementById('userCountBadge');
  if(badge)badge.textContent=users.length+' kullanƒ±cƒ±';
  document.getElementById('userTableBody').innerHTML=users.map(u=>`
    <tr>
      <td><strong>${esc(u.username)}</strong></td>
      <td style="color:var(--muted)">${u.email?esc(u.email):'‚Äî'}</td>
      <td style="color:var(--muted)">${u.phone?esc(u.phone):'‚Äî'}</td>
      <td><span class="roleBadge ${u.role}">${u.role==='admin'?'Admin':'Kullanƒ±cƒ±'}</span></td>
      <td style="color:var(--muted);font-size:12px">${new Date(u.createdAt).toLocaleDateString('tr-TR')}</td>
      <td>${u.username!==currentUser.username?`<button class="btnSm btnDanger" onclick="deleteUser(${u.id})">Sil</button>`:'<span style="color:var(--muted);font-size:12px">Sen</span>'}</td>
    </tr>`).join('');
}
async function addUser(){
  const username=document.getElementById('newUsername').value.trim(),email=document.getElementById('newUserEmail').value.trim();
  const password=document.getElementById('newPassword').value,role=document.getElementById('newRole').value;
  if(!username||!password)return alert('Kullanƒ±cƒ± adƒ± ve ≈üifre gerekli');
  const res=await api('/api/users',{method:'POST',body:JSON.stringify({username,email,password,role})});
  if(res&&!res.error){document.getElementById('newUsername').value='';document.getElementById('newUserEmail').value='';document.getElementById('newPassword').value='';loadUsers();}
  else if(res)alert(res.error);
}
async function deleteUser(id){
  if(!confirm('Bu kullanƒ±cƒ±yƒ± silmek istiyor musunuz?')) return;
  const res = await api('/api/users/'+id, {method:'DELETE'});
  if(!res) return;
  if(res.error){ alert('Hata: '+res.error); return; }
  loadUsers();
}

async function hesapSilOnay(){
  const onay = confirm('‚ö†Ô∏è Dƒ∞KKAT\n\nHesabƒ±nƒ±z ve sistemdeki t√ºm ki≈üisel verileriniz kalƒ±cƒ± olarak silinecektir.\n\nBu i≈ülem GERƒ∞ ALINAMAZ.\n\nDevam etmek istiyor musunuz?');
  if(!onay) return;
  const res = await api('/api/account', {method:'DELETE'});
  if(!res) return;
  if(res.error){ alert('Hata: '+res.error); return; }
  // T√ºm local verileri temizle ve √ßƒ±kƒ±≈ü yap
  if(currentUser) localStorage.removeItem('yg_consented_'+currentUser.id);
  localStorage.removeItem('yg_token');
  localStorage.removeItem('yg_user');
  localStorage.removeItem('yg_filters');
  token=null; currentUser=null;
  document.getElementById('app').style.display='none';
  document.getElementById('authWrap').style.display='flex';
  document.getElementById('hamburger').style.display='none';
  showLogin();
  alert('Hesabƒ±nƒ±z ba≈üarƒ±yla silindi. G√∂r√º≈ümek √ºzere!');
}

// Kara liste
async function loadBlacklist(){
  const list=await api('/api/blacklist');if(!list)return;
  document.getElementById('blacklistTags').innerHTML=list.length
    ?list.map(k=>`<div class="blTag">üö´ ${esc(k)}<button onclick="removeBlacklist('${esc(k)}')">√ó</button></div>`).join('')
    :'<span style="color:var(--muted);font-size:14px">Kara listede kelime yok</span>';
}
async function addBlacklist(){const k=document.getElementById('newBlackword').value.trim();if(!k)return;await api('/api/blacklist',{method:'POST',body:JSON.stringify({kelime:k})});document.getElementById('newBlackword').value='';loadBlacklist();}
async function removeBlacklist(k){await api('/api/blacklist/'+encodeURIComponent(k),{method:'DELETE'});loadBlacklist();}

// ‚îÄ‚îÄ Bildirim Sistemi ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const tumIller = [
  'adana','adƒ±yaman','afyon','aƒürƒ±','aksaray','amasya','ankara','antalya',
  'ardahan','artvin','aydƒ±n','balƒ±kesir','bartƒ±n','batman','bayburt','bilecik',
  'bing√∂l','bitlis','bolu','burdur','bursa','√ßanakkale','√ßankƒ±rƒ±','√ßorum',
  'denizli','diyarbakƒ±r','d√ºzce','edirne','elazƒ±ƒü','erzincan','erzurum',
  'eski≈üehir','gaziantep','giresun','g√ºm√º≈ühane','hakkari','hatay','ƒ±sparta',
  'iƒüdƒ±r','istanbul','izmir','kahramanmara≈ü','karab√ºk','karaman','kars',
  'kastamonu','kayseri','kilis','kƒ±rƒ±kkale','kƒ±rklareli','kƒ±r≈üehir','kocaeli',
  'konya','k√ºtahya','malatya','manisa','mardin','mersin','muƒüla','mu≈ü',
  'nev≈üehir','niƒüde','ordu','osmaniye','rize','sakarya','samsun','siirt',
  'sinop','sivas','≈üanlƒ±urfa','≈üƒ±rnak','tekirdaƒü','tokat','trabzon','tunceli',
  'u≈üak','van','yalova','yozgat','zonguldak'
];
let seciliSehirler = JSON.parse(localStorage.getItem('yg_bildirim_sehirler')||'[]');
let bildirimAktif = localStorage.getItem('yg_bildirim_aktif') === 'true';
let sonIlanTimestamp = 0;
let bildirimInterval = null;

function bildirimToggleChange(){
  const chk = document.getElementById('bildirimToggle');
  const kartText = document.getElementById('bildirimKartText');
  if(chk.checked){
    if(!('Notification' in window)){
      alert('Tarayƒ±cƒ±nƒ±z bildirimleri desteklemiyor.');
      chk.checked = false; return;
    }
    Notification.requestPermission().then(p => {
      if(p === 'granted'){
        bildirimAktif = true;
        localStorage.setItem('yg_bildirim_aktif','true');
        if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'block';
        if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = '‚úÖ Bildirimler aktif';
        if(kartText){ kartText.textContent = '‚úÖ A√ßƒ±k'; kartText.style.color = '#16a34a'; }
        renderSehirChipler();
        baslatBildirimKontrol();
      } else {
        chk.checked = false;
        if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = '‚ö†Ô∏è Tarayƒ±cƒ±dan izin vermeniz gerekiyor';
        if(kartText){ kartText.textContent = 'ƒ∞zin Gerekli'; kartText.style.color = '#f59e0b'; }
      }
    });
  } else {
    bildirimAktif = false;
    localStorage.setItem('yg_bildirim_aktif','false');
    if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'none';
    if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = 'Takip ettiƒüiniz illerde ilan gelince bildirim alƒ±n (il se√ßince t√ºm il√ßeleri kapsar)';
    if(kartText){ kartText.textContent = 'Kapalƒ±'; kartText.style.color = 'var(--text)'; }
    durdurBildirimKontrol();
  }
}

function renderSehirChipler(filtre=''){
  const container = document.getElementById('sehirChipler');
  if(!container) return;
  const normFiltre = filtre.toLowerCase().replace(/ƒü/g,'g').replace(/√º/g,'u').replace(/≈ü/g,'s').replace(/ƒ±/g,'i').replace(/√∂/g,'o').replace(/√ß/g,'c');
  const liste = filtre ? tumIller.filter(s => {
    const ns = s.toLowerCase().replace(/ƒü/g,'g').replace(/√º/g,'u').replace(/≈ü/g,'s').replace(/ƒ±/g,'i').replace(/√∂/g,'o').replace(/√ß/g,'c');
    return ns.includes(normFiltre);
  }) : tumIller;

  container.innerHTML = liste.map(s => {
    const aktif = seciliSehirler.includes(s);
    return `<div class="sehirChip${aktif?' aktif':''}" onclick="sehirToggle('${s}')">${s.charAt(0).toUpperCase()+s.slice(1)}</div>`;
  }).join('');
  document.getElementById('seciliSayisi').textContent = seciliSehirler.length;
}

function sehirToggle(sehir){
  const idx = seciliSehirler.indexOf(sehir);
  if(idx>=0) seciliSehirler.splice(idx,1);
  else seciliSehirler.push(sehir);
  localStorage.setItem('yg_bildirim_sehirler', JSON.stringify(seciliSehirler));
  const filtre = document.getElementById('bildirimSehirAra')?.value || '';
  renderSehirChipler(filtre);
}

function sehirFiltrele(){
  const filtre = document.getElementById('bildirimSehirAra')?.value || '';
  renderSehirChipler(filtre);
}

function baslatBildirimKontrol(){
  if(bildirimInterval) return;
  bildirimInterval = setInterval(async ()=>{
    if(!bildirimAktif || seciliSehirler.length===0) return;
    try{
      const data = await api('/api/ilanlar');
      if(!data) return;
      const ilanlar = data.ilanlar || data;
      // Yeni ilanlarƒ± bul (son kontrolden sonra gelenler)
      const yeniIlanlar = ilanlar.filter(i => i.timestamp > sonIlanTimestamp);
      if(yeniIlanlar.length > 0) sonIlanTimestamp = Math.max(...ilanlar.map(i=>i.timestamp));
      else if(sonIlanTimestamp === 0){ sonIlanTimestamp = Math.max(...ilanlar.map(i=>i.timestamp),0); return; }

      // ƒ∞l ‚Üí il√ße haritasƒ± (frontend'de k√º√ß√ºk √∂zet)
      const IL_ILCE_OZET = {
        'istanbul':['adalar','arnavutk√∂y','ata≈üehir','avcƒ±lar','baƒücƒ±lar','bah√ßelievler','bakƒ±rk√∂y','ba≈üak≈üehir','bayrampa≈üa','be≈üikta≈ü','beykoz','beylikd√ºz√º','beyoƒülu','b√ºy√ºk√ßekmece','√ßatalca','√ßekmek√∂y','esenler','esenyurt','ey√ºpsultan','fatih','gaziosmanpa≈üa','g√ºng√∂ren','kadƒ±k√∂y','kaƒüƒ±thane','kartal','k√º√ß√ºk√ßekmece','maltepe','pendik','sancaktepe','sarƒ±yer','silivri','sultanbeyli','sultangazi','≈üile','≈üi≈üli','tuzla','√ºmraniye','√ºsk√ºdar','zeytinburnu'],
        'ankara':['altƒ±ndaƒü','√ßankaya','etimesgut','ke√ßi√∂ren','mamak','sincan','yenimahalle','pursaklar','g√∂lba≈üƒ±','polatlƒ±'],
        'izmir':['bal√ßova','bayƒ±ndƒ±r','bayraklƒ±','bergama','bornova','buca','√ße≈üme','√ßiƒüli','dikili','fo√ßa','gaziemir','g√ºzelbah√ße','karabaƒülar','kar≈üƒ±yaka','kemalpa≈üa','konak','menemen','narlƒ±dere','torbalƒ±','urla'],
        'bursa':['nil√ºfer','osmangazi','yƒ±ldƒ±rƒ±m','gemlik','ineg√∂l','mudanya','orhangazi'],
        'antalya':['kepez','konyaaltƒ±','muratpa≈üa','alanya','manavgat','serik'],
        'samsun':['atakum','canik','ilkadƒ±m','tekkek√∂y','bafra','√ßar≈üamba','terme','ala√ßam','havza','kavak','ondokuzmayƒ±s'],
        'kocaeli':['ba≈üiskele','√ßayƒ±rova','darƒ±ca','derince','gebze','g√∂lc√ºk','izmit','kandƒ±ra','kartepe','k√∂rfez'],
        'sakarya':['adapazarƒ±','akyazƒ±','erenler','hendek','sapanca','serdivan'],
      };

      const normIl = s => s.toLowerCase().replace(/ƒü/g,'g').replace(/√º/g,'u').replace(/≈ü/g,'s').replace(/ƒ±/g,'i').replace(/√∂/g,'o').replace(/√ß/g,'c').replace(/ƒ∞/g,'i');

      for(const ilan of yeniIlanlar){
        const normMetin = ' ' + normIl(ilan.text) + ' ';
        const eslesme = seciliSehirler.find(il => {
          const ns = normIl(il);
          // ƒ∞lin kendisi ge√ßiyor mu?
          if(normMetin.includes(' '+ns+' ')) return true;
          // ƒ∞lin il√ßelerinden biri ge√ßiyor mu?
          const ilceler = IL_ILCE_OZET[il] || [];
          return ilceler.some(ilce => normMetin.includes(' '+normIl(ilce)+' '));
        });
        if(eslesme){
          new Notification('üöõ Y√ºkleGit ‚Äî Yeni ƒ∞lan', {
            body: eslesme.charAt(0).toUpperCase()+eslesme.slice(1)+' ilanƒ±: '+ilan.text.slice(0,80)+'...',
            icon: '/favicon.ico',
            tag: 'ilan_'+ilan.timestamp,
          });
        }
      }
    }catch(e){}
  }, 20000); // 20 saniyede bir kontrol
}

function durdurBildirimKontrol(){
  clearInterval(bildirimInterval);
  bildirimInterval = null;
}

function loadProfilBildirim(){
  const chk = document.getElementById('bildirimToggle');
  if(!chk) return;
  const izin = Notification.permission === 'granted';
  chk.checked = bildirimAktif && izin;
  const kartText = document.getElementById('bildirimKartText');
  if(chk.checked){
    if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'block';
    if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = '‚úÖ Bildirimler aktif';
    if(kartText){ kartText.textContent = '‚úÖ A√ßƒ±k'; kartText.style.color = '#16a34a'; }
    renderSehirChipler();
  } else {
    if(kartText){ kartText.textContent = 'Kapalƒ±'; kartText.style.color = 'var(--text)'; }
  }
}

// ‚îÄ‚îÄ Hareketler ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadHareketler(){
  const data = await api('/api/logs?limit=300');
  if(!data) return;
  const tbody = document.getElementById('hareketlerBody');
  if(!tbody) return;
  if(!data.length){ tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:32px;color:var(--muted)">Hen√ºz kayƒ±t yok</td></tr>'; return; }
  const actionLabel = a => {
    if(a==='login')  return '<span class="actionBadge login">üîë Giri≈ü</span>';
    if(a==='logout') return '<span class="actionBadge logout">üö™ √áƒ±kƒ±≈ü</span>';
    if(a==='search') return '<span class="actionBadge search">üîç Arama</span>';
    return `<span class="actionBadge">${esc(a)}</span>`;
  };
  tbody.innerHTML = data.map(l=>`<tr>
    <td><strong>${esc(l.username||'#'+l.userId)}</strong></td>
    <td>${esc(l.email||'-')}</td>
    <td>${esc(l.phone||'-')}</td>
    <td>${actionLabel(l.action)}</td>
    <td>${esc(l.detail||'-')}</td>
    <td style="font-family:monospace;font-size:12px">${esc(l.ipAddress||'-')}</td>
    <td style="white-space:nowrap;color:var(--muted)">${new Date(l.timestamp).toLocaleString('tr-TR')}</td>
  </tr>`).join('');
}

// ‚îÄ‚îÄ Bot Y√∂netimi ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _qrEventSource = null;

const durumLabel = {
  'bekliyor':         { cls:'#f59e0b', icon:'‚è≥', text:'Bekliyor' },
  'baslatiliyor':     { cls:'#3b82f6', icon:'üîÑ', text:'Ba≈ülatƒ±lƒ±yor' },
  'qr_bekleniyor':    { cls:'#8b5cf6', icon:'üì±', text:'QR Bekleniyor' },
  'dogrulandi':       { cls:'#3b82f6', icon:'‚úÖ', text:'Doƒürulandƒ±' },
  'hazir':            { cls:'#10b981', icon:'üü¢', text:'Hazƒ±r' },
  'baglanti_kesildi': { cls:'#ef4444', icon:'üî¥', text:'Baƒülantƒ± Kesildi' },
  'hata':             { cls:'#ef4444', icon:'‚ùå', text:'Hata' },
};

async function loadBotlar(){
  const data = await api('/api/bots');
  if(!data) return;
  const grid = document.getElementById('botlarGrid');
  if(!grid) return;
  if(!data.length){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:60px 20px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">ü§ñ</div>
      <div style="font-size:16px;font-weight:600">Hen√ºz bot eklenmedi</div>
      <div style="font-size:13px;margin-top:6px">Saƒü √ºstteki "Yeni Bot" butonuna tƒ±klayƒ±n</div>
    </div>`;
    return;
  }
  grid.innerHTML = data.map(bot => {
    const d = durumLabel[bot.durum] || durumLabel['bekliyor'];
    return `
    <div class="card" style="padding:20px">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px">
        <div>
          <div style="font-size:16px;font-weight:700">${esc(bot.isim)}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px;font-family:monospace">${esc(bot.clientId)}</div>
        </div>
        <span style="font-size:12px;font-weight:600;padding:4px 10px;border-radius:20px;background:${d.cls}20;color:${d.cls}">${d.icon} ${d.text}</span>
      </div>
      ${bot.telefon ? `<div style="font-size:13px;color:var(--muted);margin-bottom:12px">üìû +${esc(bot.telefon)}</div>` : ''}
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        ${bot.durum !== 'hazir' ? `<button class="btnSearch" style="font-size:12px;padding:7px 12px" onclick="qrGoster('${esc(bot.clientId)}','${esc(bot.isim)}')">üì± QR G√∂ster</button>` : ''}
        <button class="btn" style="font-size:12px;padding:7px 12px" onclick="botRestart('${esc(bot.clientId)}')">üîÑ Yeniden Ba≈ülat</button>
        <button class="btnReset" style="font-size:12px;padding:7px 12px;background:#fee2e2;color:#dc2626;border:none" onclick="botSilOnay('${esc(bot.clientId)}','${esc(bot.isim)}')">üóëÔ∏è Sil</button>
      </div>
    </div>`;
  }).join('');
}

function botEkleModal(){
  document.getElementById('yeniBotIsim').value = '';
  document.getElementById('botEkleModalEl').style.display = 'flex';
  setTimeout(() => document.getElementById('yeniBotIsim').focus(), 100);
}

async function botEkleKaydet(){
  const isim = document.getElementById('yeniBotIsim').value.trim();
  if(!isim){ alert('Bot ismi girin'); return; }
  document.getElementById('botEkleModalEl').style.display = 'none';
  const data = await api('/api/bots', { method:'POST', body: JSON.stringify({ isim }) });
  if(!data?.ok) return;
  loadBotlar();
  // QR modal'ƒ± hemen a√ß
  setTimeout(() => qrGoster(data.clientId, isim), 500);
}

function qrGoster(clientId, isim){
  document.getElementById('qrModalBaslik').textContent = 'ü§ñ ' + isim;
  document.getElementById('qrModalAlt').textContent = 'Bot ba≈ülatƒ±lƒ±yor, QR bekleniyor...';
  document.getElementById('qrModalIcerik').innerHTML = '<div class="spinner"></div>';
  document.getElementById('qrModalDurum').textContent = '';
  document.getElementById('qrModal').style.display = 'flex';

  // Eski SSE kapat
  if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }

  // QR PNG'yi retry ile y√ºkle
  async function qrImgYukle(deneme){
    const imgUrl = '/api/bots/' + encodeURIComponent(clientId) + '/qr-image?token=' + encodeURIComponent(token) + '&t=' + Date.now();
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => {
        img.style.cssText = 'width:256px;height:256px;border-radius:10px;display:block;margin:auto';
        document.getElementById('qrModalIcerik').innerHTML = '';
        document.getElementById('qrModalIcerik').appendChild(img);
        document.getElementById('qrModalAlt').textContent = 'WhatsApp ‚Üí Baƒülƒ± Cihazlar ‚Üí Cihaz Ekle ‚Üí QR\'ƒ± tarat';
        document.getElementById('qrModalDurum').textContent = '';
        resolve(true);
      };
      img.onerror = () => {
        if(deneme < 4){
          // 1.5s sonra tekrar dene
          document.getElementById('qrModalDurum').textContent = 'QR y√ºkleniyor... (' + deneme + '/4)';
          setTimeout(() => qrImgYukle(deneme + 1).then(resolve), 1500);
        } else {
          document.getElementById('qrModalIcerik').innerHTML = '<div style="color:#ef4444;font-size:14px;text-align:center;padding:20px">‚ö†Ô∏è QR g√∂r√ºnt√ºs√º y√ºklenemedi.<br><br><button class="btn" onclick="qrImgYukle(1)" style="font-size:13px">üîÑ Tekrar Dene</button></div>';
          resolve(false);
        }
      };
      img.src = imgUrl;
    });
  }

  // SSE baƒülantƒ±sƒ± a√ß
  _qrEventSource = new EventSource('/api/bots/' + encodeURIComponent(clientId) + '/qr?token=' + encodeURIComponent(token));

  _qrEventSource.onmessage = async e => {
    try {
      const msg = JSON.parse(e.data);
      if(msg.tip === 'qr_hazir'){
        document.getElementById('qrModalAlt').textContent = 'QR hazƒ±rlanƒ±yor...';
        document.getElementById('qrModalIcerik').innerHTML = '<div class="spinner"></div>';
        await qrImgYukle(1);
      } else if(msg.tip === 'dogrulandi'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">‚úÖ</div>';
        document.getElementById('qrModalAlt').textContent = 'Doƒürulandƒ±!';
        document.getElementById('qrModalDurum').textContent = 'Baƒülantƒ± kuruluyor...';
      } else if(msg.tip === 'hazir'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">üü¢</div>';
        document.getElementById('qrModalAlt').textContent = 'Bot hazƒ±r!';
        document.getElementById('qrModalDurum').textContent = '‚úÖ WhatsApp\'a ba≈üarƒ±yla baƒülandƒ±';
        if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }
        setTimeout(() => { qrModalKapat(); loadBotlar(); }, 2500);
      } else if(msg.tip === 'baglanti_kesildi'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">üî¥</div>';
        document.getElementById('qrModalAlt').textContent = 'Baƒülantƒ± kesildi';
        document.getElementById('qrModalDurum').textContent = 'Bot yeniden ba≈ülatƒ±lƒ±yor...';
      }
    } catch {}
  };

  _qrEventSource.onerror = () => {
    // SSE hata ‚Äî polling ile kontrol et
    document.getElementById('qrModalDurum').textContent = '‚ö†Ô∏è Sunucu baƒülantƒ±sƒ± kesildi, yeniden deneniyor...';
  };
}

function qrModalKapat(){
  document.getElementById('qrModal').style.display = 'none';
  if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }
}

async function botRestart(clientId){
  if(!confirm('Bot yeniden ba≈ülatƒ±lsƒ±n mƒ±?')) return;
  await api('/api/bots/' + encodeURIComponent(clientId) + '/restart', { method:'POST' });
  setTimeout(loadBotlar, 2000);
}

async function botSilOnay(clientId, isim){
  if(!confirm('"' + isim + '" botu silinsin mi? WhatsApp oturumu da silinecek.')) return;
  await api('/api/bots/' + encodeURIComponent(clientId), { method:'DELETE' });
  loadBotlar();
}

// Ba≈ülat
function toggleTema(){
  const isDark = document.documentElement.classList.toggle('dark');
  localStorage.setItem('yg_tema', isDark ? 'dark' : 'light');
  document.getElementById('temaToggleCheck').checked = isDark;
  document.getElementById('temaKartText').textContent = isDark ? 'Koyu' : 'A√ßƒ±k';
  document.getElementById('temaKartLabel').textContent = isDark ? 'üåô Tema' : '‚òÄÔ∏è Tema';
}
// Tema kartƒ±nƒ± sayfa y√ºklenince senkronize et
(function initTema(){
  const isDark = document.documentElement.classList.contains('dark');
  const chk = document.getElementById('temaToggleCheck');
  const txt = document.getElementById('temaKartText');
  const lbl = document.getElementById('temaKartLabel');
  if(chk) chk.checked = isDark;
  if(txt) txt.textContent = isDark ? 'Koyu' : 'A√ßƒ±k';
  if(lbl) lbl.textContent = isDark ? 'üåô Tema' : '‚òÄÔ∏è Tema';
})();

if(token&&currentUser){initApp();}
</script>
  <!-- PWA Install Banner -->
  <div id="pwaBanner" style="display:none" class="pwaBanner">
    <div class="pwaIcon">üöõ</div>
    <div class="pwaText">
      <div class="pwaTitle">Y√ºkleGit Uygulamasƒ±</div>
      <div class="pwaSub">Ana ekrana ekle, uygulama gibi kullan</div>
    </div>
    <button class="pwaBtn" onclick="pwaInstall()">Y√ºkle</button>
    <button class="pwaClose" onclick="pwaDismiss()">‚úï</button>
  </div>

  <script>
    // PWA Service Worker
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    }

    // Zaten kuruluysa kartƒ± g√ºncelle
    if(window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone){
      setTimeout(()=>{
        const c = document.getElementById('pwaCard');
        const t = document.getElementById('pwaCardText');
        if(c){c.style.background='linear-gradient(135deg,#dcfce7,#bbf7d0)';c.style.cursor='default';}
        if(t){t.textContent='‚úÖ Kurulu';t.style.color='#16a34a';}
      }, 500);
    }

    // Install prompt
    let _pwaPrompt = null;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      _pwaPrompt = e;
      if(localStorage.getItem('yg_pwa_dismissed')) return;
      if(localStorage.getItem('yg_token')){
        document.getElementById('pwaBanner').style.display = 'flex';
      } else {
        window._showPwaBanner = true;
      }
    });

    function pwaInstall(){
      if(!_pwaPrompt) return;
      _pwaPrompt.prompt();
      _pwaPrompt.userChoice.then(r => {
        document.getElementById('pwaBanner').style.display = 'none';
        if(r.outcome==='accepted'){
          const t=document.getElementById('pwaCardText');
          if(t){t.textContent='‚úÖ Kuruldu!';}
        }
        _pwaPrompt = null;
      });
    }

    function pwaInstallOrGuide(){
      const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
      const installed = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
      if(installed) return;
      if(_pwaPrompt){
        pwaInstall();
      } else if(isIOS){
        alert('üì≤ iPhone/iPad\'e kurmak i√ßin:\n\nSafari\'de alttaki "Payla≈ü" butonuna (‚ñ°‚Üë) tƒ±klayƒ±n\n‚Üí "Ana Ekrana Ekle" se√ßin\n‚Üí "Ekle" ye basƒ±n');
      } else {
        alert('üì≤ Telefona kurmak i√ßin:\n\nTarayƒ±cƒ± men√ºs√ºnden (‚ãÆ)\n"Ana ekrana ekle" veya\n"Uygulamayƒ± y√ºkle" se√ßeneƒüini tƒ±klayƒ±n');
      }
    }

    function pwaDismiss(){
      document.getElementById('pwaBanner').style.display = 'none';
      localStorage.setItem('yg_pwa_dismissed', '1');
    }

    // iOS banner
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isStandalone = window.navigator.standalone;
    if(isIOS && !isStandalone && !localStorage.getItem('yg_pwa_dismissed')){
      setTimeout(() => {
        if(!localStorage.getItem('yg_token')) return;
        const b = document.getElementById('pwaBanner');
        b.querySelector('.pwaSub').textContent = 'Safari\'de "Payla≈ü" ‚Üí "Ana Ekrana Ekle"';
        b.querySelector('.pwaBtn').style.display = 'none';
        b.style.display = 'flex';
      }, 2000);
    }
  </script>

<!-- ‚îÄ‚îÄ KVKK Rƒ±za Modalƒ± ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="rizaModal" class="rizaOverlay" style="display:none">
  <div class="rizaBox">
    <div class="rizaTitle">üöõ Y√ºkleGit'e Ho≈ü Geldiniz</div>
    <div class="rizaSubtitle">Platformu kullanmaya devam etmeden √∂nce l√ºtfen a≈üaƒüƒ±daki bilgileri okuyun ve onaylayƒ±n.</div>

    <div class="rizaItem" id="riza1Item" onclick="toggleRiza(1)">
      <div class="rizaCheckbox" id="riza1Box"></div>
      <div class="rizaText">
        Y√ºkleGit platformunun kamuya a√ßƒ±k i≈ü ilanƒ± gruplarƒ±ndan i√ßerik topladƒ±ƒüƒ±nƒ± ve bu i√ßerikleri uygulama kullanƒ±cƒ±larƒ±na sunduƒüunu okudum, anladƒ±m ve kabul ediyorum.
      </div>
    </div>

    <div class="rizaItem" id="riza2Item" onclick="toggleRiza(2)">
      <div class="rizaCheckbox" id="riza2Box"></div>
      <div class="rizaText">
        Ki≈üisel Verilerin Korunmasƒ± Kanunu (KVKK) kapsamƒ±nda hazƒ±rlanan <a href="/gizlilik" target="_blank" rel="noopener" onclick="event.stopPropagation()">Gizlilik Politikasƒ±</a>'nƒ± ve Kullanƒ±m Ko≈üullarƒ±'nƒ± okudum ve kabul ediyorum.
      </div>
    </div>

    <div class="rizaNote">
      ƒ∞lanƒ±nƒ±zƒ±n veya ki≈üisel verinizin kaldƒ±rƒ±lmasƒ±nƒ± talep etmek i√ßin <a href="mailto:yuklegit.iletisim@gmail.com">yuklegit.iletisim@gmail.com</a> adresine yazabilir veya WhatsApp destek hattƒ±mƒ±zdan ula≈üabilirsiniz.
    </div>

    <button class="rizaDevamBtn" id="rizaDevamBtn" onclick="rizaOnayla()">Devam Et</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ Y√ºzen WhatsApp Destek Butonu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<a id="waFloat" href="https://wa.me/905015303028?text=Merhaba%2C%20Y√ºkleGit%20hakkƒ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
   style="position:fixed;bottom:20px;right:20px;z-index:9999;display:flex;align-items:center;gap:7px;
          background:#25D366;color:white;border-radius:50px;padding:8px 14px 8px 10px;
          box-shadow:0 3px 12px rgba(37,211,102,.4);text-decoration:none;font-weight:600;
          font-size:12px;font-family:'Outfit',sans-serif;transition:transform .2s,box-shadow .2s"
   onmouseover="this.style.transform='scale(1.05)';this.style.boxShadow='0 5px 18px rgba(37,211,102,.55)'"
   onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 3px 12px rgba(37,211,102,.4)'">
  <svg width="18" height="18" viewBox="0 0 32 32" fill="white" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 2C8.268 2 2 8.268 2 16c0 2.478.675 4.797 1.85 6.787L2 30l7.43-1.826A13.94 13.94 0 0016 30c7.732 0 14-6.268 14-14S23.732 2 16 2zm0 25.5a11.44 11.44 0 01-5.836-1.596l-.418-.248-4.413 1.084 1.13-4.3-.272-.44A11.46 11.46 0 014.5 16C4.5 9.596 9.596 4.5 16 4.5S27.5 9.596 27.5 16 22.404 27.5 16 27.5zm6.29-8.424c-.344-.172-2.036-1.004-2.352-1.118-.316-.115-.547-.172-.777.172-.23.344-.892 1.118-1.093 1.348-.2.23-.402.258-.747.086-.344-.172-1.454-.536-2.77-1.71-1.023-.913-1.714-2.04-1.915-2.385-.2-.344-.021-.53.15-.702.155-.155.344-.402.516-.603.172-.2.23-.344.344-.573.115-.23.058-.43-.029-.603-.086-.172-.777-1.876-1.064-2.566-.28-.672-.564-.58-.777-.59l-.661-.011c-.23 0-.603.086-.918.43s-1.207 1.176-1.207 2.867 1.236 3.326 1.408 3.555c.172.23 2.432 3.71 5.893 5.205.823.355 1.466.567 1.967.726.826.263 1.579.226 2.173.137.663-.1 2.036-.832 2.323-1.634.287-.803.287-1.49.2-1.634-.086-.143-.315-.23-.66-.402z"/>
  </svg>
  Destek
</a>

</body>
</html>
