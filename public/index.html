<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="el9cCEj2qHYnt1dyXvxDxI6Gq6dyKxxOSHSlIbKwrm4" />
<meta name="theme-color" content="#1a5fdb">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="YÃ¼kleGit">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>YÃ¼kleGit â€” Lojistik Ä°lan Takip</title>
  <meta name="description" content="YÃ¼kleGit ile TÃ¼rkiye genelindeki gÃ¼ncel nakliye ve yÃ¼k ilanlarÄ±nÄ± anlÄ±k takip edin. Åehir bazlÄ± arama yapÄ±n, lojistik fÄ±rsatlarÄ± kaÃ§Ä±rmayÄ±n.">
  <meta name="keywords" content="lojistik ilanlarÄ±, nakliye ilanlarÄ±, yÃ¼k ilanlarÄ±, kamyon ilanlarÄ±, TÃ¼rkiye lojistik, taÅŸÄ±macÄ±lÄ±k ilanlarÄ±, yÃ¼klegit">
  <meta name="robots" content="index, follow">
  <meta name="author" content="YÃ¼kleGit">
  <link rel="canonical" href="https://yuklegit.tr">

  <!-- Open Graph (Facebook, WhatsApp paylaÅŸÄ±m) -->
  <meta property="og:title" content="YÃ¼kleGit â€” Lojistik Ä°lan Takip">
  <meta property="og:description" content="TÃ¼rkiye genelindeki gÃ¼ncel nakliye ve yÃ¼k ilanlarÄ±nÄ± anlÄ±k takip edin.">
  <meta property="og:url" content="https://yuklegit.tr">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://yuklegit.tr/icon-512.png">
  <meta property="og:locale" content="tr_TR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="YÃ¼kleGit â€” Lojistik Ä°lan Takip">
  <meta name="twitter:description" content="TÃ¼rkiye genelindeki gÃ¼ncel nakliye ve yÃ¼k ilanlarÄ±nÄ± anlÄ±k takip edin.">
  <meta name="twitter:image" content="https://yuklegit.tr/icon-512.png">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f0f4fb;--surface:#fff;--border:#dde5f4;--text:#0f1d3a;--muted:#6b7fa3;
  --accent:#1a5fdb;--accent-h:#1248b3;--success:#059669;--danger:#dc2626;
  --sidebar:#0f1d3a;--sidebar-t:#7b92c4;
  --radius:10px;--shadow:0 1px 8px rgba(15,29,58,.07);--shadow-md:0 4px 20px rgba(15,29,58,.10);
  --sidebar-w:220px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{height:100%}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* â”€â”€ AUTH â”€â”€ */
.authWrap{min-height:100vh;display:flex;background:linear-gradient(135deg,#0f1d3a 0%,#1a3a6e 50%,#1a5fdb 100%)}
.authLeft{flex:1;display:flex;flex-direction:column;justify-content:center;padding:60px;color:white}
.authBrand{font-family:'Outfit',sans-serif;font-size:36px;font-weight:800;margin-bottom:16px;display:flex;align-items:center;gap:12px}
.logoIcon{background:var(--accent);width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.authTagline{font-size:16px;opacity:.7;line-height:1.7;max-width:360px}
.authFeatures{margin-top:40px;display:flex;flex-direction:column;gap:14px}
.authFeature{display:flex;align-items:center;gap:12px;font-size:14px;opacity:.8}
.authFeature .dot{width:8px;height:8px;background:#0ea5e9;border-radius:50%;flex-shrink:0}
.authRight{width:480px;background:var(--surface);display:flex;flex-direction:column;justify-content:center;padding:60px 48px;overflow-y:auto}
.authTitle{font-family:'Outfit',sans-serif;font-size:26px;font-weight:700;margin-bottom:6px}
.authSubtitle{font-size:14px;color:var(--muted);margin-bottom:28px}
.formGroup{margin-bottom:14px}
.formGroup label{display:block;font-size:11.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:5px}
.formGroup input,.formGroup select{width:100%;padding:11px 14px;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);background:var(--bg);outline:none;transition:border-color .2s,box-shadow .2s}
.formGroup input:focus,.formGroup select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.12)}
.btnPrimary{width:100%;padding:12px;background:var(--accent);color:white;border:none;border-radius:var(--radius);font-family:'Outfit',sans-serif;font-size:15px;font-weight:600;cursor:pointer;margin-top:4px;transition:background .2s;-webkit-appearance:none}
.btnPrimary:hover{background:var(--accent-h)}
.authSwitch{margin-top:16px;text-align:center;font-size:13px;color:var(--muted)}
.authSwitch a{color:var(--accent);font-weight:600;cursor:pointer}
.authError{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px;display:none}
.divider{display:flex;align-items:center;gap:12px;margin:16px 0;color:var(--muted);font-size:12px}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.btnGoogle{width:100%;padding:11px;background:white;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:background .15s,border-color .15s;color:var(--text);-webkit-appearance:none}
.btnGoogle:hover{background:#f8faff;border-color:var(--accent)}
.googleIcon{width:20px;height:20px;flex-shrink:0}

/* â”€â”€ APP LAYOUT â”€â”€ */
#app{display:none;min-height:100vh}

/* Sidebar */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);background:var(--sidebar);display:flex;flex-direction:column;z-index:200;transition:transform .25s ease}
.sidebarLogo{padding:20px 18px 16px;font-family:'Outfit',sans-serif;font-size:19px;font-weight:800;color:white;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.08);margin-bottom:10px}
.navSection{padding:4px 18px;font-size:10px;font-weight:700;color:rgba(255,255,255,.3);text-transform:uppercase;letter-spacing:1px;margin:6px 0 3px}
.navItem{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:1px 8px;border-radius:8px;cursor:pointer;font-size:13.5px;font-weight:500;color:var(--sidebar-t);transition:all .15s;border:none;background:none;width:calc(100% - 16px);text-align:left}
.navItem:hover,.navItem:active{background:rgba(255,255,255,.06);color:white}
.navItem.active{background:var(--accent);color:white}
.navItem .icon{width:18px;text-align:center;font-size:15px;flex-shrink:0}
.sidebarBottom{margin-top:auto;padding:12px;border-top:1px solid rgba(255,255,255,.08)}
.userBadge{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,.06);margin-bottom:8px;cursor:pointer;transition:background .15s}
.userBadge:hover{background:rgba(255,255,255,.10)}
.userAvatar{width:34px;height:34px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-family:'Outfit',sans-serif;font-size:14px;font-weight:700;flex-shrink:0}
.userName{font-size:13px;font-weight:600;color:white;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:120px}
.userRole{font-size:11px;color:var(--sidebar-t)}
.btnLogout{width:100%;padding:8px;background:rgba(255,255,255,.06);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--sidebar-t);cursor:pointer;transition:all .15s}
.btnLogout:hover{background:rgba(220,38,38,.2);color:#fca5a5}

/* Overlay (mobil) */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:150}
.overlay.show{display:block}

/* Hamburger */
.hamburger{display:none;position:fixed;top:14px;left:14px;z-index:300;background:var(--sidebar);border:none;border-radius:8px;padding:8px 10px;cursor:pointer;flex-direction:column;gap:4px}
.hamburger span{display:block;width:20px;height:2px;background:white;border-radius:2px;transition:all .25s}

/* Main */
.main{margin-left:var(--sidebar-w);padding:28px 28px;min-height:100vh;transition:margin-left .25s}
.pageHeader{margin-bottom:22px}
.pageTitle{font-family:'Outfit',sans-serif;font-size:22px;font-weight:700}
.pageSubtitle{color:var(--muted);font-size:13px;margin-top:3px}

/* Stats */
.statsGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.statCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;box-shadow:var(--shadow)}
.statLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:6px}
.statValue{font-family:'Outfit',sans-serif;font-size:28px;font-weight:700}
.statValue.blue{color:var(--accent)}.statValue.green{color:var(--success)}

/* Search */
.searchCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:16px;box-shadow:var(--shadow)}
.searchRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.searchInput{flex:1;min-width:120px;border:1.5px solid var(--border);border-radius:8px;padding:9px 13px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;background:var(--bg);outline:none;transition:border-color .2s,box-shadow .2s;color:var(--text);-webkit-appearance:none}
.searchInput:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.btnSearch{padding:9px 18px;background:var(--accent);color:white;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:background .2s;white-space:nowrap;flex-shrink:0;-webkit-appearance:none}
.btnSearch:hover,.btnSearch:active{background:var(--accent-h)}
.btnReset{padding:9px 12px;background:var(--bg);color:var(--muted);border:1.5px solid var(--border);border-radius:8px;font-size:13px;cursor:pointer;transition:all .15s;white-space:nowrap;flex-shrink:0}
.btnReset:hover{border-color:var(--text);color:var(--text)}
.liveBtn{display:flex;align-items:center;gap:5px;padding:7px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:20px;font-size:12px;font-weight:500;color:var(--muted);cursor:pointer;transition:all .15s;white-space:nowrap;flex-shrink:0}
.liveBtn.active{border-color:var(--success);color:var(--success);background:#f0fdf4}
.liveDot{width:7px;height:7px;border-radius:50%;background:var(--muted);flex-shrink:0}
.liveBtn.active .liveDot{background:var(--success);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* Ä°lanlar */
.ilanlarBar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.ilanCount{font-size:13px;color:var(--muted)}
.ilanCount span{font-weight:600;color:var(--text)}
.ilanList{display:flex;flex-direction:column;gap:10px}
.ilanCard{background:var(--surface);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:var(--radius);padding:16px 18px;box-shadow:var(--shadow);animation:fadeUp .25s ease;transition:box-shadow .2s}
.ilanCard:hover{box-shadow:var(--shadow-md)}
.paylasBtn{display:inline-flex;align-items:center;gap:5px;margin-left:auto;background:none;border:1.5px solid var(--border);border-radius:20px;padding:3px 10px;font-size:11.5px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .15s}
.paylasBtn:hover{border-color:var(--accent);color:var(--accent);background:var(--bg)}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.ilanMeta{display:flex;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.ilanNum{font-family:'Outfit',sans-serif;font-size:11px;font-weight:700;color:white;background:var(--accent);padding:2px 8px;border-radius:4px;flex-shrink:0}
.ilanGrup{font-size:13px;font-weight:600;color:var(--accent);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px}
.ilanTime{font-size:11px;color:var(--muted);background:var(--bg);padding:3px 9px;border-radius:20px;border:1px solid var(--border);white-space:nowrap;flex-shrink:0}
.ilanText{font-size:13.5px;line-height:1.75;color:var(--text);white-space:pre-wrap;word-break:break-word}
.ilanText .hl{background:#dbeafe;color:#1e40af;font-weight:700;padding:0 3px;border-radius:3px}
/* SatÄ±r bazlÄ± render stilleri */
.ilanTextSatir{white-space:pre-wrap;word-break:break-word}
.satirEsles{display:block;color:var(--text);font-size:13.5px;line-height:1.75}
.satirSoluk{display:block;color:var(--muted);font-size:12px;line-height:1.6;opacity:.45}
.satirTers{display:block;color:var(--muted);font-size:13px;line-height:1.75;opacity:.5;text-decoration:line-through;text-decoration-color:rgba(239,68,68,.4)}
.tersIkon{font-size:11px;color:#ef4444;margin-left:4px;text-decoration:none;display:inline}
.ilanSehirler{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px}
.sehirTag{font-size:11px;color:var(--accent);background:#eff6ff;padding:2px 8px;border-radius:20px;border:1px solid #bfdbfe}
.emptyState{text-align:center;padding:50px 20px;color:var(--muted)}
.emptyIcon{font-size:44px;margin-bottom:12px}

/* Card/Table */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin-bottom:18px}
.cardHeader{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.cardTitle{font-family:'Outfit',sans-serif;font-size:15px;font-weight:700}
.tableWrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;min-width:500px}
thead{background:var(--bg)}
th{padding:10px 16px;text-align:left;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--muted);border-bottom:1px solid var(--border);white-space:nowrap}
td{padding:12px 16px;font-size:13.5px;border-bottom:1px solid var(--border)}
tr:last-child td{border-bottom:none}
tr:hover td{background:#f8faff}
.roleBadge{font-size:11px;font-weight:700;padding:3px 10px;border-radius:20px;white-space:nowrap}
.roleBadge.admin{background:#eff6ff;color:var(--accent)}.roleBadge.user{background:#f0fdf4;color:var(--success)}
.btnSm{padding:5px 12px;border-radius:6px;font-size:12px;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap}
.btnDanger{background:none;border:1.5px solid #fecaca;color:var(--danger)}
.btnDanger:hover{background:#fef2f2}

/* Add form */
.addForm{padding:16px 18px;border-bottom:1px solid var(--border);background:#f8faff}
.addForm h4{font-size:12px;font-weight:700;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}
.formRow{display:grid;grid-template-columns:1fr 1fr 1fr 110px auto;gap:8px;align-items:end}
.formRow .formGroup{margin-bottom:0}
.btnAdd{padding:11px 16px;background:var(--success);color:white;border:none;border-radius:var(--radius);font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;white-space:nowrap;-webkit-appearance:none}
.btnAdd:hover{opacity:.88}

/* Kara liste */
.blGrid{display:flex;flex-wrap:wrap;gap:8px;padding:16px 18px;min-height:50px}
.blTag{display:flex;align-items:center;gap:8px;background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:500}
.blTag button{background:none;border:none;color:var(--danger);cursor:pointer;font-size:17px;line-height:1;opacity:.6}
.blTag button:hover{opacity:1}
.blAdd{display:flex;gap:10px;padding:14px 18px;border-top:1px solid var(--border)}

/* Profil */
.profileGrid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.profileCard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.profileHeader{padding:16px 20px;border-bottom:1px solid var(--border);background:#f8faff}
.profileTitle{font-family:'Outfit',sans-serif;font-size:15px;font-weight:700}
.profileBody{padding:20px}
.infoRow{display:flex;flex-direction:column;gap:4px;margin-bottom:14px}
.infoRow:last-child{margin-bottom:0}
.infoLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px}
.infoValue{font-size:14px;font-weight:500}
.profileMsg{font-size:13px;margin-top:10px;padding:8px 12px;border-radius:6px;display:none}
.profileMsg.ok{background:#f0fdf4;color:var(--success);border:1px solid #bbf7d0}
.profileMsg.err{background:#fef2f2;color:var(--danger);border:1px solid #fecaca}

/* Token-input arama */
.tokenInput{display:flex;flex-wrap:wrap;align-items:center;gap:6px;padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;cursor:text;transition:border-color .2s,box-shadow .2s;min-height:44px}
.tokenInput:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.searchTag{display:inline-flex;align-items:center;gap:4px;background:var(--accent);color:white;border-radius:6px;padding:3px 8px 3px 10px;font-size:13px;font-weight:600;animation:fadeUp .15s ease;white-space:nowrap}
.searchTag button{background:rgba(255,255,255,.25);border:none;color:white;border-radius:4px;width:16px;height:16px;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;padding:0;line-height:1;flex-shrink:0}
.searchTag button:hover{background:rgba(255,255,255,.45)}
.tokenRealInput{border:none;outline:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);min-width:180px;flex:1;padding:2px 0}
.sehirOneriBox{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--surface);border:1.5px solid var(--accent);border-radius:10px;box-shadow:var(--shadow-md);z-index:100;max-height:220px;overflow-y:auto}
.sehirOneriItem{padding:10px 14px;cursor:pointer;font-size:14px;transition:background .1s}
.sehirOneriItem:hover,.sehirOneriItem.aktif{background:var(--accent);color:white}
.sehirOneriItem.eklenmis{opacity:.5;cursor:default}
.searchInputWrap{position:relative;flex:1}

/* Ã‡ift Arama Kutusu */
.searchDual{display:flex;flex-direction:column;gap:8px;flex:1}
.searchDualRow{display:flex;align-items:center;gap:8px}
.searchDualLabel{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;width:52px;flex-shrink:0}
.searchDualInput{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;cursor:text;transition:border-color .2s,box-shadow .2s;min-height:42px;flex:1;position:relative}
.searchDualInput:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.searchDualInput.has-tag{border-color:var(--accent);background:rgba(26,95,219,.04)}
.dualRealInput{border:none;outline:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);min-width:120px;flex:1;padding:2px 0}
.dualTag{display:inline-flex;align-items:center;gap:5px;background:var(--accent);color:white;border-radius:6px;padding:3px 9px;font-size:13px;font-weight:600;white-space:nowrap}
.dualTag button{background:none;border:none;color:rgba(255,255,255,.8);cursor:pointer;font-size:13px;padding:0;line-height:1;display:flex;align-items:center}
.dualTag button:hover{color:white}
.searchDivider{display:flex;align-items:center;padding-left:60px}
.searchDividerLine{flex:1;height:1px;background:var(--border);position:relative}
.searchDividerArrow{font-size:14px;color:var(--muted);margin:0 8px;opacity:.6}
.dualOneriBox{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--surface);border:1.5px solid var(--accent);border-radius:10px;box-shadow:var(--shadow-md);z-index:200;max-height:220px;overflow-y:auto}
.dualOneriItem{padding:10px 14px;cursor:pointer;font-size:14px;transition:background .1s}
.dualOneriItem:hover,.dualOneriItem.aktif{background:var(--accent);color:white}
.dualOneriItem.eklenmis{opacity:.5;cursor:default}
.btnAI{padding:9px 16px;background:linear-gradient(135deg,#7c3aed,#4f46e5);color:white;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;flex-shrink:0;display:flex;align-items:center;gap:6px}
.btnAI:hover{background:linear-gradient(135deg,#6d28d9,#4338ca);transform:translateY(-1px);box-shadow:0 4px 12px rgba(124,58,237,.35)}
.btnAI:disabled{opacity:.6;cursor:wait;transform:none}
.aiSpinner{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:spin .7s linear infinite;display:none}
.btnAI.loading .aiSpinner{display:block}
.btnAI.loading .aiIcon{display:none}
@keyframes spin{to{transform:rotate(360deg)}}
.aiSonucBanner{background:linear-gradient(135deg,#f5f3ff,#ede9fe);border:1.5px solid #c4b5fd;border-radius:12px;padding:14px 18px;margin-bottom:14px;display:none}
.aiSonucBaslik{font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;color:#7c3aed;margin-bottom:4px;display:flex;align-items:center;gap:6px}
.aiSonucOzet{font-size:13px;color:#4c1d95;line-height:1.5}
.aiTag{display:inline-flex;align-items:center;gap:4px;background:#7c3aed;color:white;border-radius:5px;padding:2px 8px;font-size:11px;font-weight:700;margin-right:5px}
.ilanCard.ai-oneri{border-left-color:#7c3aed;background:linear-gradient(to right,#faf5ff,var(--surface))}
.ilanCard.ai-oneri .ilanNum{background:#7c3aed}
.ilanAiOzet{margin-top:8px;padding:8px 12px;background:rgba(124,58,237,.07);border-radius:8px;font-size:12.5px;color:#6d28d9;display:flex;flex-wrap:wrap;gap:8px}
.ilanAiOzetItem{display:flex;align-items:center;gap:4px;font-weight:600}
/* PWA Install Banner */
.pwaBanner{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a5fdb,#1048b8);color:white;border-radius:16px;padding:14px 20px;display:flex;align-items:center;gap:14px;box-shadow:0 8px 32px rgba(26,95,219,.35);z-index:9999;max-width:380px;width:calc(100% - 40px);animation:slideUp .4s ease}
@keyframes slideUp{from{transform:translateX(-50%) translateY(100px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
.pwaBanner .pwaIcon{font-size:28px;flex-shrink:0}
.pwaBanner .pwaText{flex:1}
.pwaBanner .pwaTitle{font-weight:700;font-size:14px}
.pwaBanner .pwaSub{font-size:12px;opacity:.85;margin-top:2px}
.pwaBanner .pwaBtn{background:white;color:#1a5fdb;border:none;border-radius:10px;padding:8px 16px;font-weight:700;font-size:13px;cursor:pointer;white-space:nowrap;flex-shrink:0}
.pwaBanner .pwaClose{background:none;border:none;color:white;font-size:18px;cursor:pointer;opacity:.7;padding:0 0 0 8px;flex-shrink:0}

/* Bildirim ayarlarÄ± */
.sehirSecici{display:flex;flex-wrap:wrap;gap:8px;padding:16px 0}
.sehirChip{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:500;border:1.5px solid var(--border);background:var(--bg);color:var(--muted);cursor:pointer;transition:all .15s;user-select:none}
.sehirChip:hover{border-color:var(--accent);color:var(--accent)}
.sehirChip.aktif{background:#eff6ff;border-color:var(--accent);color:var(--accent);font-weight:700}
.sehirChip.aktif::before{content:'âœ“ '}
.bildirimArama{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;background:var(--bg);outline:none;margin-bottom:12px;transition:border-color .2s}
.bildirimArama:focus{border-color:var(--accent)}
.bildirimToggle{display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);margin-bottom:16px}
.toggle{position:relative;width:46px;height:26px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.toggleSlider{position:absolute;cursor:pointer;inset:0;background:#cbd5e1;border-radius:20px;transition:.3s}
.toggleSlider:before{content:'';position:absolute;width:20px;height:20px;left:3px;bottom:3px;background:white;border-radius:50%;transition:.3s}
.toggle input:checked + .toggleSlider{background:var(--accent)}
.toggle input:checked + .toggleSlider:before{transform:translateX(20px)}
.toggleLabel{font-size:14px;font-weight:600}
.toggleSub{font-size:12px;color:var(--muted)}

/* Hareketler tablosu */
.dataTable{width:100%;border-collapse:collapse;font-size:13px}
.dataTable th{background:var(--sidebar);color:var(--muted);font-weight:600;padding:10px 12px;text-align:left;border-bottom:1px solid var(--border);white-space:nowrap}
.dataTable td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.dataTable tr:hover td{background:#f8faff}
.actionBadge{display:inline-block;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:700}
.actionBadge.login{background:#dcfce7;color:#16a34a}
.actionBadge.logout{background:#fee2e2;color:#dc2626}
.actionBadge.search{background:#eff6ff;color:#1a5fdb}

/* Tel linki */
.telLink{color:#16a34a;font-weight:700;text-decoration:none;white-space:nowrap;background:#f0fdf4;padding:1px 6px;border-radius:4px;border:1px solid #bbf7d0}
.telLink:hover{background:#dcfce7;text-decoration:underline}

/* Ä°lan oluÅŸtur */
.ilanForm{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:20px}
.ilanFormTitle{font-family:'Outfit',sans-serif;font-size:16px;font-weight:700;margin-bottom:4px}
.ilanFormSub{font-size:12px;color:var(--muted);margin-bottom:14px}
.ilanTextarea{width:100%;min-height:120px;border:1.5px solid var(--border);border-radius:var(--radius);padding:12px 14px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--text);background:var(--bg);outline:none;resize:vertical;transition:border-color .2s;line-height:1.6}
.ilanTextarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(26,95,219,.10)}
.ilanFormBottom{display:flex;align-items:center;justify-content:space-between;margin-top:10px;flex-wrap:wrap;gap:8px}
.charCount{font-size:12px;color:var(--muted)}
.charCount.warn{color:var(--danger)}
.phoneNote{font-size:12px;color:var(--success);background:#f0fdf4;border:1px solid #bbf7d0;padding:4px 10px;border-radius:6px}

/* Loader */
.loader{display:flex;justify-content:center;padding:40px}
.spinner{width:28px;height:28px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ MOBÄ°L â”€â”€ */
@media(max-width:768px){
  .authLeft{display:none}
  .authRight{width:100%;padding:40px 24px;min-height:100vh;justify-content:flex-start;padding-top:60px}

  .hamburger{display:flex}
  .sidebar{transform:translateX(-100%)}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0;padding:14px 12px;padding-top:60px}

  .statsGrid{grid-template-columns:1fr 1fr;gap:10px}
  .statsGrid .statCard:last-child{grid-column:1/-1}
  .statValue{font-size:24px}

  /* Arama kutusu mobil */
  .searchRow{flex-direction:column;align-items:stretch;gap:8px}
  .searchDual{flex:none;width:100%}
  .searchDualRow{gap:6px}
  .searchDualLabel{width:62px;font-size:10px}
  .dualRealInput{font-size:16px} /* iOS zoom engelle */
  .searchBtnGroup{display:flex;flex-direction:row;flex-wrap:wrap;gap:6px;width:100%}
  .searchBtnGroup .btnSearch,
  .searchBtnGroup .btnAI,
  .searchBtnGroup .btnReset,
  .searchBtnGroup .liveBtn{flex:1;min-width:calc(50% - 3px);justify-content:center}

  .ilanCard{padding:14px}
  .ilanGrup{max-width:140px}

  .profileGrid{grid-template-columns:1fr}
  .formRow{grid-template-columns:1fr;gap:8px}

  .pageTitle{font-size:20px}
}

@media(max-width:480px){
  .statsGrid{grid-template-columns:1fr}
  .statsGrid .statCard:last-child{grid-column:auto}
  .searchDualLabel{display:none} /* Ã§ok dar ekranda label gizle */
  .searchBtnGroup .btnSearch,
  .searchBtnGroup .btnAI{flex:1}
  .searchBtnGroup .btnReset,
  .searchBtnGroup .liveBtn{flex:1}
}
</style>
</head>
<body>

<!-- AUTH -->
<div id="authWrap" class="authWrap">
  <div class="authLeft">
    <div class="authBrand"><div class="logoIcon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13" rx="1"/><path d="M16 8h4l3 5v4h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div> YÃ¼kleGit</div>
    <div class="authTagline">TÃ¼rkiye genelindeki lojistik ilanlarÄ±nÄ± gerÃ§ek zamanlÄ± takip edin, ÅŸehir bazlÄ± arama yapÄ±n.</div>
    <div class="authFeatures">
      <div class="authFeature"><div class="dot"></div> 870+ ÅŸehir ve ilÃ§e desteÄŸi</div>
      <div class="authFeature"><div class="dot"></div> AnlÄ±k ilan takibi</div>
      <div class="authFeature"><div class="dot"></div> GÃ¼zergah bazlÄ± akÄ±llÄ± arama</div>
    </div>
  </div>
  <div class="authRight">
    <div id="loginForm">
      <div class="authTitle">GiriÅŸ Yap</div>
      <div class="authSubtitle">HesabÄ±nÄ±za giriÅŸ yapÄ±n</div>
      <div class="formGroup"><label>KullanÄ±cÄ± AdÄ± veya E-posta</label>
        <input type="text" id="loginUser" placeholder="kullanici veya mail@ornek.com" autocomplete="username"></div>
      <div class="formGroup"><label>Åifre</label>
        <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"></div>
      <button class="btnPrimary" onclick="login()">GiriÅŸ Yap</button>
      <div class="authError" id="loginError"></div>
      <div id="verifyWarn" style="display:none;margin-top:10px;background:#fff7ed;border:1px solid #fed7aa;color:#c2410c;padding:10px 14px;border-radius:8px;font-size:13px">
        E-postanÄ±z doÄŸrulanmamÄ±ÅŸ. <a onclick="resendVerify()" style="color:#c2410c;font-weight:700;cursor:pointer;text-decoration:underline">Tekrar gÃ¶nder</a>
      </div>
      <div style="text-align:right;margin-top:8px"><a onclick="showForgot()" style="font-size:13px;color:var(--accent);cursor:pointer">Åifremi unuttum</a></div>
      <div class="divider">veya</div>
      <button class="btnGoogle" onclick="googleLogin()">
        <svg class="googleIcon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Google ile GiriÅŸ Yap
      </button>
      <div class="authSwitch" style="margin-top:14px">HesabÄ±nÄ±z yok mu? <a onclick="showReg()">KayÄ±t olun</a></div>
    </div>

    <div id="forgotForm" style="display:none">
      <div class="authTitle">Åifremi Unuttum</div>
      <div class="authSubtitle">E-postanÄ±za sÄ±fÄ±rlama linki gÃ¶nderelim</div>
      <div class="formGroup"><label>E-posta</label>
        <input type="email" id="forgotEmail" placeholder="mail@ornek.com"></div>
      <button class="btnPrimary" onclick="forgotPassword()">SÄ±fÄ±rlama Linki GÃ¶nder</button>
      <div class="authError" id="forgotError"></div>
      <div id="forgotSuccess" style="display:none;background:#f0fdf4;border:1px solid #bbf7d0;color:#059669;padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px"></div>
      <div class="authSwitch" style="margin-top:14px"><a onclick="showLogin()">â† GiriÅŸ sayfasÄ±na dÃ¶n</a></div>
    </div>

    <div id="regForm" style="display:none">
      <div class="authTitle">KayÄ±t Ol</div>
      <div class="authSubtitle">Yeni hesap oluÅŸturun</div>
      <div class="formGroup"><label>KullanÄ±cÄ± AdÄ±</label>
        <input type="text" id="regUser" placeholder="kullanici_adi" autocomplete="username"></div>
      <div class="formGroup"><label>E-posta</label>
        <input type="email" id="regEmail" placeholder="mail@ornek.com" autocomplete="email"></div>
      <div class="formGroup"><label>Telefon NumarasÄ±</label>
        <input type="tel" id="regPhone" placeholder="05XX XXX XX XX" autocomplete="tel"></div>
      <div class="formGroup"><label>Åifre</label>
        <input type="password" id="regPass" placeholder="En az 6 karakter" autocomplete="new-password"></div>
      <button class="btnPrimary" onclick="register()">KayÄ±t Ol</button>
      <div class="authError" id="regError"></div>
      <div id="regSuccess" style="display:none;background:#f0fdf4;border:1px solid #bbf7d0;color:#059669;padding:10px 14px;border-radius:8px;font-size:13px;margin-top:10px"></div>
      <div class="divider">veya</div>
      <button class="btnGoogle" onclick="googleLogin()">
        <svg class="googleIcon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Google ile KayÄ±t Ol
      </button>
      <div class="authSwitch" style="margin-top:12px">Zaten hesabÄ±nÄ±z var mÄ±? <a onclick="showLogin()">GiriÅŸ yapÄ±n</a></div>
    </div>
  </div>
</div>

<!-- APP -->
<button class="hamburger" id="hamburger" onclick="toggleSidebar()" style="display:none">
  <span></span><span></span><span></span>
</button>
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<div id="app">
  <div class="sidebar" id="sidebar">
    <div class="sidebarLogo"><img src="/icon-192.png" style="width:32px;height:32px;border-radius:8px;object-fit:cover;flex-shrink:0"> YÃ¼kleGit</div>
    <div class="navSection">MenÃ¼</div>
    <button class="navItem active" onclick="showPage('ilanlar')" id="nav-ilanlar"><span class="icon">ğŸ“‹</span> Ä°lanlar</button>
    <button class="navItem" onclick="showPage('profil')" id="nav-profil"><span class="icon">ğŸ‘¤</span> Profilim</button>
    <button class="navItem" onclick="showPage('ilanver')" id="nav-ilanver"><span class="icon">âœï¸</span> Ä°lan Ver</button>
    <button class="navItem" onclick="showPage('iletisim')" id="nav-iletisim"><span class="icon">ğŸ’¬</span> Ä°letiÅŸim</button>
    <div id="adminNav" style="display:none">
      <div class="navSection">YÃ¶netim</div>
      <button class="navItem" onclick="showPage('kullanicilar')" id="nav-kullanicilar"><span class="icon">ğŸ‘¥</span> KullanÄ±cÄ±lar</button>
      <button class="navItem" onclick="showPage('blacklist')" id="nav-blacklist"><span class="icon">ğŸš«</span> Kara Liste</button>
      <button class="navItem" onclick="showPage('hareketler')" id="nav-hareketler"><span class="icon">ğŸ“Š</span> Hareketler</button>
      <button class="navItem" onclick="showPage('botlar')" id="nav-botlar"><span class="icon">ğŸ¤–</span> Botlar</button>
    </div>
    <div class="sidebarBottom">
      <div class="userBadge" onclick="showPage('profil');closeSidebar()">
        <div class="userAvatar" id="userAvatar">?</div>
        <div style="overflow:hidden">
          <div class="userName" id="userNameDisplay">â€”</div>
          <div class="userRole" id="userRoleDisplay">â€”</div>
        </div>
      </div>
      <button class="btnLogout" onclick="logout()">â¬… Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>

  <div class="main">
    <!-- Ä°lanlar -->
    <div id="page-ilanlar">
      <div class="pageHeader"><div class="pageTitle">Ä°lanlar</div><div class="pageSubtitle">Son 1 saat iÃ§indeki aktif lojistik ilanlarÄ±</div></div>
      <div class="statsGrid">
        <div class="statCard"><div class="statLabel">Toplam Ä°lan</div><div class="statValue blue" id="statTotal">â€”</div></div>
        <div class="statCard" style="cursor:pointer;border:2px dashed var(--primary);background:linear-gradient(135deg,#eff6ff,#dbeafe)" onclick="pwaInstallOrGuide()" id="pwaCard">
          <div class="statLabel">ğŸ“² Mobil Uygulama</div>
          <div class="statValue" style="font-size:15px;color:var(--primary)" id="pwaCardText">Ana Ekrana Ekle</div>
        </div>
        <div class="statCard" style="cursor:pointer" onclick="document.getElementById('bildirimToggle').click()" id="bildirimKart">
          <div class="statLabel">ğŸ”” Bildirimler</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" id="bildirimToggle" onchange="bildirimToggleChange()">
              <span class="toggleSlider"></span>
            </label>
            <span style="font-size:13px;font-weight:600;color:var(--text)" id="bildirimKartText">KapalÄ±</span>
          </div>
        </div>
      </div>
      <div class="searchCard">
        <div class="searchRow" style="align-items:flex-start;gap:10px">
          <div class="searchDual">
            <!-- Nereden (Ã§oklu) -->
            <div class="searchDualRow">
              <span class="searchDualLabel">ğŸ“ Nereden</span>
              <div class="searchDualInput" id="neredenWrap" onclick="focusDualInput('nereden')">
                <div id="neredenTags" style="display:contents"></div>
                <input type="text" class="dualRealInput" id="neredenInput" placeholder="KalkÄ±ÅŸ ÅŸehri ekleyin..." autocomplete="off"
                  oninput="dualOneri('nereden')" onkeydown="dualKeydown(event,'nereden')">
                <div class="dualOneriBox" id="neredenOneriBox" style="display:none"></div>
              </div>
            </div>
            <!-- AyÄ±rÄ±cÄ± -->
            <div class="searchDivider"><div class="searchDividerArrow">â†•</div><div class="searchDividerLine"></div></div>
            <!-- Nereye (Ã§oklu) -->
            <div class="searchDualRow">
              <span class="searchDualLabel">ğŸ Nereye</span>
              <div class="searchDualInput" id="nereyeWrap" onclick="focusDualInput('nereye')">
                <div id="nereyeTags" style="display:contents"></div>
                <input type="text" class="dualRealInput" id="nereyeInput" placeholder="VarÄ±ÅŸ ÅŸehri ekleyin (opsiyonel)..." autocomplete="off"
                  oninput="dualOneri('nereye')" onkeydown="dualKeydown(event,'nereye')">
                <div class="dualOneriBox" id="nereyeOneriBox" style="display:none"></div>
              </div>
            </div>
          </div>
          <div class="searchBtnGroup" style="flex-shrink:0;padding-top:2px;display:flex;flex-direction:column;gap:6px">
            <button class="btnSearch" onclick="araIlanlar()">ğŸ” Ara</button>
            <button class="btnAI" id="btnAI" onclick="aiAra()" title="AI ile akÄ±llÄ± arama">
              <span class="aiIcon">âœ¨ AI Ara</span>
              <div class="aiSpinner"></div>
            </button>
            <button class="btnReset" onclick="resetArama()">Temizle</button>
            <button class="liveBtn" id="liveBtn" onclick="toggleLive()"><div class="liveDot"></div> CanlÄ±</button>
          </div>
        </div>
      </div>
      <div class="aiSonucBanner" id="aiSonucBanner">
        <div class="aiSonucBaslik">âœ¨ AI Analizi <span id="aiSonucSayac" style="font-weight:400;color:#6d28d9;font-size:12px"></span></div>
        <div class="aiSonucOzet" id="aiSonucOzet"></div>
      </div>
      <div class="ilanlarBar"><div class="ilanCount">GÃ¶sterilen: <span id="ilanCountNum">0</span> ilan</div></div>
      <div id="ilanList" class="ilanList"><div class="loader"><div class="spinner"></div></div></div>
    </div>

    <!-- Profil -->
    <div id="page-profil" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Profilim</div><div class="pageSubtitle">Hesap bilgilerinizi yÃ¶netin</div></div>
      <div class="profileGrid">
        <div class="profileCard">
          <div class="profileHeader"><div class="profileTitle">Hesap Bilgileri</div></div>
          <div class="profileBody">
            <div class="infoRow"><div class="infoLabel">KullanÄ±cÄ± AdÄ±</div><div class="infoValue" id="profileUsername">â€”</div></div>
            <div class="infoRow"><div class="infoLabel">E-posta</div><div class="infoValue" id="profileEmail">â€”</div></div>
            <div class="infoRow"><div class="infoLabel">Telefon</div><div class="infoValue" id="profilePhone">â€”</div></div>
            <div class="infoRow"><div class="infoLabel">Rol</div><div class="infoValue" id="profileRole">â€”</div></div>
          </div>
        </div>
        <div class="profileCard">
          <div class="profileHeader"><div class="profileTitle">E-posta GÃ¼ncelle</div></div>
          <div class="profileBody">
            <div class="formGroup"><label>Yeni E-posta</label><input type="email" id="newEmail" placeholder="yeni@mail.com"></div>
            <button class="btnPrimary" onclick="updateEmail()">GÃ¼ncelle</button>
            <div class="profileMsg" id="emailMsg"></div>
          </div>
        </div>
        <div class="profileCard" style="grid-column:1/-1">
          <div class="profileHeader"><div class="profileTitle">ğŸ”” Bildirim AyarlarÄ±</div></div>
          <div class="profileBody">
            <div class="bildirimToggle">
              <label class="toggle">
                <input type="checkbox" id="bildirimToggle" onchange="bildirimToggleChange()">
                <span class="toggleSlider"></span>
              </label>
              <div>
                <div class="toggleLabel">TarayÄ±cÄ± Bildirimleri</div>
                <div class="toggleSub" id="bildirimDurum">Takip ettiÄŸiniz illerde ilan gelince bildirim alÄ±n (il seÃ§ince tÃ¼m ilÃ§eleri kapsar)</div>
              </div>
            </div>
            <div id="bildirimAyarlar" style="display:none">
              <div style="font-size:13px;font-weight:600;margin-bottom:8px;color:var(--muted)">TAKÄ°P EDÄ°LECEK ÅEHÄ°RLER</div>
              <input class="bildirimArama" id="bildirimSehirAra" placeholder="Åehir veya ilÃ§e ara..." oninput="sehirFiltrele()">
              <div class="sehirSecici" id="sehirChipler"></div>
              <div style="font-size:12px;color:var(--muted);margin-top:8px">SeÃ§ili: <strong id="seciliSayisi">0</strong> ÅŸehir/ilÃ§e</div>
            </div>
          </div>
        </div>

      <div class="profileCard" style="grid-column:1/-1">
          <div class="profileHeader"><div class="profileTitle">Åifre DeÄŸiÅŸtir</div></div>
          <div class="profileBody" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;align-items:end">
            <div class="formGroup" style="margin:0"><label>Mevcut Åifre</label><input type="password" id="curPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
            <div class="formGroup" style="margin:0"><label>Yeni Åifre</label><input type="password" id="newPass" placeholder="En az 6 karakter"></div>
            <button class="btnPrimary" onclick="updatePassword()" style="margin:0">Åifreyi DeÄŸiÅŸtir</button>
            <div class="profileMsg" id="passMsg" style="grid-column:1/-1"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ä°lan Ver -->
    <div id="page-ilanver" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Ä°lan Ver</div><div class="pageSubtitle">Lojistik ilanÄ±nÄ±zÄ± yayÄ±nlayÄ±n</div></div>
      <div class="ilanForm">
        <div class="ilanFormTitle">ğŸš› Yeni Ä°lan OluÅŸtur</div>
        <div class="ilanFormSub">Ä°lan metninizi yazÄ±n. Telefon numaranÄ±z otomatik eklenecektir.</div>
        <textarea class="ilanTextarea" id="ilanMetin" placeholder="Ã–rnek:&#10;Ä°STANBUL - ANKARA&#10;YÃ¼k cinsi: Tekstil&#10;Tonaj: 10 ton&#10;Tarih: YarÄ±n sabah" maxlength="1000" oninput="updateCharCount()"></textarea>
        <div class="ilanFormBottom">
          <div>
            <span class="charCount" id="charCount">0 / 1000</span>
            <span class="phoneNote" id="phoneNote" style="margin-left:8px">ğŸ“ NumaranÄ±z otomatik eklenecek</span>
          </div>
          <button class="btnSearch" onclick="ilanGonder()" id="ilanGonderBtn">ğŸ“¢ Ä°lanÄ± YayÄ±nla</button>
        </div>
        <div id="ilanMsg" style="display:none;margin-top:12px;padding:10px 14px;border-radius:8px;font-size:13px"></div>
      </div>
      <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:var(--radius);padding:14px 18px;font-size:13px;color:#92400e">
        âš ï¸ <strong>HatÄ±rlatma:</strong> YanÄ±ltÄ±cÄ± veya sahte ilan paylaÅŸmak hesabÄ±nÄ±zÄ±n askÄ±ya alÄ±nmasÄ±na neden olabilir.
      </div>
    </div>

    <!-- KullanÄ±cÄ±lar -->
    <div id="page-kullanicilar" style="display:none">
      <div class="pageHeader"><div class="pageTitle">KullanÄ±cÄ± YÃ¶netimi</div><div class="pageSubtitle">Sisteme eriÅŸen kullanÄ±cÄ±larÄ± yÃ¶netin</div></div>
      <div class="card">
        <div class="addForm">
          <h4>Yeni KullanÄ±cÄ± Ekle</h4>
          <div class="formRow">
            <div class="formGroup"><label>KullanÄ±cÄ± AdÄ±</label><input type="text" id="newUsername" class="searchInput" placeholder="kullanici"></div>
            <div class="formGroup"><label>E-posta</label><input type="email" id="newUserEmail" class="searchInput" placeholder="mail@ornek.com"></div>
            <div class="formGroup"><label>Åifre</label><input type="password" id="newPassword" class="searchInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
            <div class="formGroup"><label>Rol</label><select id="newRole" class="searchInput"><option value="user">KullanÄ±cÄ±</option><option value="admin">Admin</option></select></div>
            <button class="btnAdd" onclick="addUser()">+ Ekle</button>
          </div>
        </div>
        <div class="tableWrap">
          <table>
            <thead><tr><th>KullanÄ±cÄ±</th><th>E-posta</th><th>Telefon</th><th>Rol</th><th>Tarih</th><th>Ä°ÅŸlem</th></tr></thead>
            <tbody id="userTableBody"><tr><td colspan="6" style="text-align:center;color:var(--muted);padding:28px">YÃ¼kleniyor...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Kara Liste -->
    <div id="page-blacklist" style="display:none">
      <div class="pageHeader"><div class="pageTitle">Kara Liste</div><div class="pageSubtitle">Bu kelimeleri iÃ§eren ilanlar gÃ¶sterilmez</div></div>
      <div class="card">
        <div id="blacklistTags" class="blGrid"><div class="loader"><div class="spinner"></div></div></div>
        <div class="blAdd">
          <input type="text" class="searchInput" id="newBlackword" placeholder="Engellenecek kelime...">
          <button class="btnAdd" onclick="addBlacklist()">+ Ekle</button>
        </div>
      </div>
    </div>

    <div id="page-hareketler" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">ğŸ“Š KullanÄ±cÄ± Hareketleri</div><div class="pageSubtitle">GiriÅŸ, Ã§Ä±kÄ±ÅŸ ve arama geÃ§miÅŸi</div></div>
        <button class="btn" onclick="loadHareketler()">ğŸ”„ Yenile</button>
      </div>
      <div class="card" style="overflow-x:auto">
        <table class="dataTable">
          <thead>
            <tr>
              <th>KullanÄ±cÄ±</th>
              <th>E-posta</th>
              <th>Telefon</th>
              <th>Ä°ÅŸlem</th>
              <th>Detay</th>
              <th>IP</th>
              <th>Zaman</th>
            </tr>
          </thead>
          <tbody id="hareketlerBody">
            <tr><td colspan="7" style="text-align:center;padding:32px;color:var(--muted)">YÃ¼kleniyor...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Botlar -->
    <div id="page-botlar" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">ğŸ¤– WhatsApp BotlarÄ±</div><div class="pageSubtitle">BaÄŸlÄ± botlarÄ± yÃ¶netin, yeni bot ekleyin</div></div>
        <button class="btn" onclick="botEkleModal()">â• Yeni Bot</button>
      </div>
      <div id="botlarGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px"></div>
    </div>

    <!-- Ä°letiÅŸim -->
    <div id="page-iletisim" style="display:none">
      <div class="pageHeader">
        <div><div class="pageTitle">ğŸ’¬ Destek & Ä°letiÅŸim</div><div class="pageSubtitle">SorularÄ±nÄ±z iÃ§in WhatsApp Ã¼zerinden bize ulaÅŸÄ±n</div></div>
      </div>

      <!-- WhatsApp Destek KartÄ± -->
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:20px">
        <div class="card" style="padding:28px;text-align:center;border:2px solid #25D36622">
          <div style="font-size:52px;margin-bottom:12px">ğŸ’¬</div>
          <div style="font-size:18px;font-weight:700;margin-bottom:6px">WhatsApp Destek</div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:20px;line-height:1.6">
            Lojistik ilanlarÄ±, Ã¼yelik ve teknik konularda<br>7/24 destek alÄ±n.
          </div>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20YÃ¼kleGit%20hakkÄ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:8px;background:#25D366;color:white;border-radius:10px;padding:12px 24px;text-decoration:none;font-weight:700;font-size:14px;transition:opacity .2s"
             onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">
            <svg width="20" height="20" viewBox="0 0 32 32" fill="white"><path d="M16 2C8.268 2 2 8.268 2 16c0 2.478.675 4.797 1.85 6.787L2 30l7.43-1.826A13.94 13.94 0 0016 30c7.732 0 14-6.268 14-14S23.732 2 16 2zm6.29 19.076c-.344-.172-2.036-1.004-2.352-1.118-.316-.115-.547-.172-.777.172-.23.344-.892 1.118-1.093 1.348-.2.23-.402.258-.747.086-.344-.172-1.454-.536-2.77-1.71-1.023-.913-1.714-2.04-1.915-2.385-.2-.344-.021-.53.15-.702.155-.155.344-.402.516-.603.172-.2.23-.344.344-.573.115-.23.058-.43-.029-.603-.086-.172-.777-1.876-1.064-2.566-.28-.672-.564-.58-.777-.59l-.661-.011c-.23 0-.603.086-.918.43s-1.207 1.176-1.207 2.867 1.236 3.326 1.408 3.555c.172.23 2.432 3.71 5.893 5.205.823.355 1.466.567 1.967.726.826.263 1.579.226 2.173.137.663-.1 2.036-.832 2.323-1.634.287-.803.287-1.49.2-1.634-.086-.143-.315-.23-.66-.402z"/></svg>
            WhatsApp'tan Yaz
          </a>
          <div style="margin-top:14px;font-size:12px;color:var(--muted)">+90 501 530 30 28</div>
        </div>

        <div class="card" style="padding:28px">
          <div style="font-size:18px;font-weight:700;margin-bottom:16px">ğŸ“‹ SÄ±k Sorulan Sorular</div>
          <div style="display:flex;flex-direction:column;gap:12px">
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                Ä°lanlar ne kadar sÃ¼re gÃ¶rÃ¼nÃ¼r? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">Ä°lanlar yayÄ±nlandÄ±ktan itibaren 1 saat boyunca sistemde gÃ¶rÃ¼nÃ¼r kalÄ±r.</p>
            </details>
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                Hangi gruplardan ilan Ã§ekiliyor? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">Botun eklendiÄŸi WhatsApp lojistik gruplarÄ±ndan otomatik olarak ilanlar Ã§ekilmektedir.</p>
            </details>
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                Ä°lan vermek iÃ§in ne yapmalÄ±yÄ±m? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">"Ä°lan Ver" sayfasÄ±ndan kalkÄ±ÅŸ ve varÄ±ÅŸ noktasÄ±nÄ±, araÃ§ tÃ¼rÃ¼nÃ¼ ve iletiÅŸim bilgilerinizi girerek ilan oluÅŸturabilirsiniz.</p>
            </details>
            <details style="background:var(--bg);border-radius:8px;padding:12px 14px;cursor:pointer">
              <summary style="font-weight:600;font-size:13px;list-style:none;display:flex;justify-content:space-between;align-items:center">
                Ãœyelik Ã¼cretli mi? <span style="color:var(--primary)">+</span>
              </summary>
              <p style="margin:10px 0 0;font-size:13px;color:var(--muted);line-height:1.6">Åu an iÃ§in Ã¼yelik tamamen Ã¼cretsizdir.</p>
            </details>
          </div>
        </div>
      </div>

      <!-- HÄ±zlÄ± Mesaj ÅablonlarÄ± -->
      <div class="card" style="padding:24px">
        <div style="font-size:16px;font-weight:700;margin-bottom:14px">âš¡ HÄ±zlÄ± Mesaj GÃ¶nder</div>
        <div style="display:flex;flex-wrap:wrap;gap:8px">
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20Ã¼yelik%20hakkÄ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            ğŸ‘¤ Ãœyelik bilgisi
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20ilan%20vermek%20istiyorum%2C%20yardÄ±mcÄ±%20olabilir%20misiniz%3F" target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            ğŸ“¦ Ä°lan vermek istiyorum
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20teknik%20bir%20sorun%20yaÅŸÄ±yorum%2C%20yardÄ±mcÄ±%20olabilir%20misiniz%3F" target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            ğŸ”§ Teknik sorun
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20bir%20ÅŸikayet%20iletmek%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            ğŸ“£ Åikayet
          </a>
          <a href="https://wa.me/905015303028?text=Merhaba%2C%20botunuzu%20grubuma%20eklemek%20istiyorum." target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:6px;border:1.5px solid #25D36655;border-radius:20px;padding:8px 14px;font-size:12px;font-weight:600;color:#16a34a;text-decoration:none;transition:all .15s;background:#f0fdf4"
             onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            ğŸ¤– Botu grubuma ekle
          </a>
        </div>
      </div>
    </div>

    <!-- QR Modal -->
    <div id="qrModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center">
      <div style="background:var(--surface);border-radius:16px;padding:32px;max-width:380px;width:90%;text-align:center;position:relative">
        <button onclick="qrModalKapat()" style="position:absolute;top:12px;right:16px;background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)">âœ•</button>
        <div style="font-size:22px;font-weight:700;margin-bottom:6px" id="qrModalBaslik">QR Kod</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:20px" id="qrModalAlt">WhatsApp'ta BaÄŸlÄ± Cihazlar â†’ Cihaz Ekle â†’ QR'Ä± tarat</div>
        <div id="qrModalIcerik" style="min-height:260px;display:flex;align-items:center;justify-content:center">
          <div class="spinner"></div>
        </div>
        <div id="qrModalDurum" style="margin-top:16px;font-size:13px;color:var(--muted)"></div>
      </div>
    </div>

    <!-- Bot Ekle Modal -->
    <div id="botEkleModalEl" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center">
      <div style="background:var(--surface);border-radius:16px;padding:32px;max-width:360px;width:90%">
        <div style="font-size:18px;font-weight:700;margin-bottom:20px">â• Yeni Bot Ekle</div>
        <label style="font-size:13px;font-weight:600;color:var(--muted)">Bot Ä°smi</label>
        <input id="yeniBotIsim" type="text" class="searchInput" style="width:100%;margin-top:6px;margin-bottom:20px;box-sizing:border-box" placeholder="Ã–rn: Ana Bot, Grup Bot 2...">
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btnReset" onclick="document.getElementById('botEkleModalEl').style.display='none'">Ä°ptal</button>
          <button class="btnSearch" onclick="botEkleKaydet()">Ekle ve QR GÃ¶ster</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
let token=localStorage.getItem('yg_token');
let currentUser=JSON.parse(localStorage.getItem('yg_user')||'null');
let liveInterval=null,isLive=false,lastSearch={s1:'',s2:''};

// Google OAuth token yakalama
(function(){
  const p=new URLSearchParams(window.location.search);
  const gt=p.get('google_token'),gu=p.get('user');
  if(gt&&gu){try{token=gt;currentUser=JSON.parse(decodeURIComponent(gu));localStorage.setItem('yg_token',token);localStorage.setItem('yg_user',JSON.stringify(currentUser));}catch(e){}window.history.replaceState({},'','/');}
  if(p.get('error')==='google'){window.history.replaceState({},'','/');setTimeout(()=>{const el=document.getElementById('loginError');if(el){el.textContent='Google ile giriÅŸ baÅŸarÄ±sÄ±z.';el.style.display='block';}},100);}
})();

// Hamburger
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('show');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('overlay').classList.remove('show');}

// Auth sayfalarÄ±
function showReg(){['loginForm','forgotForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('regForm').style.display='block';}
function showLogin(){['regForm','forgotForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('loginForm').style.display='block';}
function showForgot(){['loginForm','regForm'].forEach(id=>document.getElementById(id).style.display='none');document.getElementById('forgotForm').style.display='block';}
function googleLogin(){window.location.href='/auth/google';}

async function login(){
  const username=document.getElementById('loginUser').value.trim();
  const password=document.getElementById('loginPass').value;
  const errEl=document.getElementById('loginError');
  errEl.style.display='none';document.getElementById('verifyWarn').style.display='none';
  try{
    const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
    const data=await res.json();
    if(!res.ok){if(data.needsVerification){document.getElementById('verifyWarn').style.display='block';window._unverifiedEmail=username;}throw new Error(data.error);}
    saveSession(data);initApp();
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

async function register(){
  const username=document.getElementById('regUser').value.trim();
  const email=document.getElementById('regEmail').value.trim();
  const phone=document.getElementById('regPhone').value.trim();
  const password=document.getElementById('regPass').value;
  const errEl=document.getElementById('regError');const okEl=document.getElementById('regSuccess');
  errEl.style.display='none';okEl.style.display='none';
  try{
    const res=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,email,phone,password})});
    const data=await res.json();
    if(!res.ok)throw new Error(data.error);
    if(data.needsVerification){okEl.textContent=data.message;okEl.style.display='block';return;}
    saveSession(data);initApp();
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

async function resendVerify(){
  const email=window._unverifiedEmail||document.getElementById('loginUser').value.trim();
  if(!email)return;
  await fetch('/api/resend-verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
  document.getElementById('verifyWarn').textContent='DoÄŸrulama maili gÃ¶nderildi, gelen kutunuzu kontrol edin.';
}

async function forgotPassword(){
  const email=document.getElementById('forgotEmail').value.trim();
  const errEl=document.getElementById('forgotError');const okEl=document.getElementById('forgotSuccess');
  errEl.style.display='none';okEl.style.display='none';
  try{
    const res=await fetch('/api/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
    const data=await res.json();
    okEl.textContent=data.message;okEl.style.display='block';
  }catch(e){errEl.textContent=e.message;errEl.style.display='block';}
}

function saveSession(data){token=data.token;currentUser={...data.user};localStorage.setItem('yg_token',token);localStorage.setItem('yg_user',JSON.stringify(currentUser));}

function logout(){
  if(token) api('/api/logout',{method:'POST'}).catch(()=>{});localStorage.removeItem('yg_token');localStorage.removeItem('yg_user');token=null;currentUser=null;document.getElementById('app').style.display='none';document.getElementById('authWrap').style.display='flex';document.getElementById('hamburger').style.display='none';showLogin();}

function initApp(){
  document.getElementById('authWrap').style.display='none';
  document.getElementById('app').style.display='block';
  if(window.innerWidth <= 768) document.getElementById('hamburger').style.display='flex';
  document.getElementById('userNameDisplay').textContent=currentUser.username;
  document.getElementById('userRoleDisplay').textContent=currentUser.role==='admin'?'Admin':'KullanÄ±cÄ±';
  document.getElementById('userAvatar').textContent=currentUser.username[0].toUpperCase();
  if(currentUser.role==='admin'){document.getElementById('adminNav').style.display='block';}
  loadStats();loadIlanlar();
  if(bildirimAktif && seciliSehirler.length>0) baslatBildirimKontrol();
  // Bildirim kart durumunu gÃ¼ncelle
  setTimeout(loadProfilBildirim, 300);
  // Åehir Ã¶nerileri iÃ§in listeyi yÃ¼kle
  api('/api/sehirler').then(d=>{ if(d&&d.sehirler) window._tumSehirler=d.sehirler; });
}

function showPage(page){
  ['ilanlar','profil','ilanver','iletisim','kullanicilar','blacklist','hareketler','botlar'].forEach(p=>{
    const el=document.getElementById('page-'+p);if(el)el.style.display=p===page?'block':'none';
    const nav=document.getElementById('nav-'+p);if(nav)nav.classList.toggle('active',p===page);
  });
  closeSidebar();
  if(page==='profil')loadProfil();
  if(page==='kullanicilar')loadUsers();
  if(page==='blacklist')loadBlacklist();
  if(page==='hareketler')loadHareketler();
  if(page==='botlar')loadBotlar();
  if(page==='iletisim'){ /* statik sayfa, yÃ¼kleme gerekmez */ }
}

async function api(url,opts={}){
  const res=await fetch(url,{...opts,headers:{'Content-Type':'application/json','Authorization':'Bearer '+token,...(opts.headers||{})}});
  if(res.status===401){logout();return null;}
  return res.json();
}

async function loadStats(){
  const d=await api('/api/stats');if(!d)return;
  const el=document.getElementById('statTotal');
  if(el) el.textContent=d.total;
}

async function loadIlanlar(s1,s2){
  document.getElementById('ilanList').innerHTML='<div class="loader"><div class="spinner"></div></div>';
  let url='/api/ilanlar';
  if(s1){url+='?sehir1='+encodeURIComponent(s1);if(s2)url+='&sehir2='+encodeURIComponent(s2);}
  const data=await api(url);if(!data)return;
  const ilanlar=data.ilanlar||data;
  if(data.hata){document.getElementById('ilanCountNum').textContent='0';document.getElementById('ilanList').innerHTML='<div class="emptyState"><div class="emptyIcon">ğŸ”</div><p>'+esc(data.hata)+'</p></div>';return;}
  const allTerms = new Set([...(data.matchedTerms||[]),...getSearchTags()].map(t=>t.toLowerCase()).filter(Boolean));
  renderIlanlar(ilanlar,[...allTerms], data.ilceler1||[], data.ilceler2||[]);
  loadStats();
}

// Ã‡oklu nereden Ã— nereye aramasÄ±
async function loadIlanlarCoklu(neredenList, nereyeList){
  document.getElementById('ilanList').innerHTML='<div class="loader"><div class="spinner"></div></div>';

  // SeÃ§im yoksa tÃ¼mÃ¼nÃ¼ gÃ¶ster
  if(!neredenList.length && !nereyeList.length){ loadIlanlar(); return; }

  // KombinasyonlarÄ± oluÅŸtur
  // Sadece nereden varsa: her nereden iÃ§in tekli arama
  // Sadece nereye varsa: her nereye iÃ§in tekli arama (s1 olarak)
  // Ä°kisi de varsa: her nereden Ã— nereye kombinasyonu
  const kombinasyonlar = [];
  if(neredenList.length && nereyeList.length){
    for(const s1 of neredenList)
      for(const s2 of nereyeList)
        kombinasyonlar.push({s1, s2});
  } else if(neredenList.length){
    for(const s1 of neredenList) kombinasyonlar.push({s1, s2:null});
  } else {
    for(const s1 of nereyeList) kombinasyonlar.push({s1, s2:null});
  }

  try {
    // Paralel istekler
    const sonuclar = await Promise.all(kombinasyonlar.map(({s1,s2})=>{
      let url='/api/ilanlar?sehir1='+encodeURIComponent(s1);
      if(s2) url+='&sehir2='+encodeURIComponent(s2);
      return api(url);
    }));

    // BirleÅŸtir â€” hash bazlÄ± duplicate temizle
    const ilanMap = new Map();
    const allMatchedTerms = new Set(getSearchTags().map(t=>t.toLowerCase()));
    let mergedIlceler1 = [], mergedIlceler2 = [];
    for(const data of sonuclar){
      if(!data||data.hata) continue;
      (data.matchedTerms||[]).forEach(t=>allMatchedTerms.add(t.toLowerCase()));
      if(data.ilceler1) mergedIlceler1 = [...new Set([...mergedIlceler1,...data.ilceler1])];
      if(data.ilceler2) mergedIlceler2 = [...new Set([...mergedIlceler2,...data.ilceler2])];
      (data.ilanlar||[]).forEach(ilan=>{
        const key = ilan.hash||String(ilan.id||ilan.timestamp);
        if(!ilanMap.has(key)) ilanMap.set(key, ilan);
      });
    }

    // En yeniden en eskiye sÄ±rala
    const ilanlar = [...ilanMap.values()].sort((a,b)=>b.timestamp-a.timestamp);

    if(!ilanlar.length){
      document.getElementById('ilanCountNum').textContent='0';
      document.getElementById('ilanList').innerHTML='<div class="emptyState"><div class="emptyIcon">ğŸ“­</div><p>AradÄ±ÄŸÄ±nÄ±z kriterlere uygun ilan bulunamadÄ±.</p></div>';
      return;
    }
    renderIlanlar(ilanlar,[...allMatchedTerms], mergedIlceler1, mergedIlceler2);
    loadStats();
  } catch(e){
    console.error('Ã‡oklu arama hata:',e);
    loadIlanlar(neredenList[0],nereyeList[0]);
  }
}

function renderIlanlar(ilanlar, matchedTerms=[], ilceler1=[], ilceler2=[]){
  document.getElementById('ilanCountNum').textContent = ilanlar.length;
  if(!ilanlar.length){
    document.getElementById('ilanList').innerHTML = '<div class="emptyState"><div class="emptyIcon">ğŸ“­</div><p>AradÄ±ÄŸÄ±nÄ±z kriterlere uygun ilan bulunamadÄ±.</p></div>';
    return;
  }

  const aramaVar = dualState.nereden.length > 0 || dualState.nereye.length > 0;

  document.getElementById('ilanList').innerHTML = ilanlar.map((ilan, i) => {
    const text = ilan.text || '';

    let ilanHTML = '';
    if(aramaVar){
      // ilceler1/ilceler2 direkt geÃ§ir â€” satÄ±r bazlÄ± yÃ¶n kontrolÃ¼ iÃ§in
      ilanHTML = renderSatirlar(text, matchedTerms, ilceler1, ilceler2);
    } else {
      ilanHTML = `<div class="ilanText">${hlText(text, matchedTerms)}</div>`;
    }

    // Sadece eÅŸleÅŸen ÅŸehir etiketlerini gÃ¶ster
    const etiketSehirler = (ilan.cities || []).filter(c => {
      if(!aramaVar) return true;
      const nc = normTR(c);
      return matchedTerms.some(t => normTR(t) === nc);
    });

    return `
    <div class="ilanCard">
      <div class="ilanMeta">
        <span class="ilanNum">Ä°lan ${i+1}</span>
        <span class="ilanTime">â± ${timeAgo(ilan.timestamp)}</span>
        <button class="paylasBtn" onclick="ilanPaylas(this)" data-text="${esc(ilan.text||'').replace(/"/g,'&quot;')}" data-chat="${esc(ilan.chatName||'')}">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          PaylaÅŸ
        </button>
      </div>
      ${ilanHTML}
      ${etiketSehirler.length ? `<div class="ilanSehirler">${etiketSehirler.map(c=>`<span class="sehirTag">${esc(formatSehir(c))}</span>`).join('')}</div>` : ''}
    </div>`;
  }).join('');
}

// SatÄ±r bazlÄ± akÄ±llÄ± render:
// - EÅŸleÅŸen satÄ±rlarÄ± tam gÃ¶ster + highlight
// - EÅŸleÅŸmeyen satÄ±rlarÄ± soluklaÅŸtÄ±r
// - Ters yÃ¶n eÅŸleÅŸmesini (s2â†’s1) soluk gÃ¶ster
function renderSatirlar(text, matchedTerms, ilceler1, ilceler2){
  const norm = s => String(s||'')
    .replace(/Ä°/g,'i').replace(/I/g,'i').replace(/Ä±/g,'i')
    .replace(/Ä/g,'g').replace(/ÄŸ/g,'g')
    .replace(/Ãœ/g,'u').replace(/Ã¼/g,'u')
    .replace(/Å/g,'s').replace(/ÅŸ/g,'s')
    .replace(/Ã–/g,'o').replace(/Ã¶/g,'o')
    .replace(/Ã‡/g,'c').replace(/Ã§/g,'c')
    .toLowerCase().replace(/[^a-z0-9]/g,' ').replace(/\s+/g,' ').trim();

  // il+ilÃ§e normalize listeleri
  const nList1 = (ilceler1||[]).map(norm).filter(Boolean);
  const nList2 = (ilceler2||[]).map(norm).filter(Boolean);
  const normTerms = matchedTerms.map(norm).filter(Boolean);

  const telRegex = /(?<!\d)((?:\+90|0)5\d{9})(?!\d)/;
  const aramaIkiYon = nList1.length > 0 && nList2.length > 0;

  const satirlar = text.split(/\n/);

  const parcalar = satirlar.map(satir => {
    const ns = norm(satir);

    // Telefon satÄ±rÄ± â€” HER ZAMAN tam gÃ¶rÃ¼nÃ¼r ve tÄ±klanabilir
    if(telRegex.test(satir)){
      return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
    }

    // SatÄ±rda hiÃ§ eÅŸleÅŸen terim yok â†’ soluklaÅŸtÄ±r
    const satirdeEslesme = normTerms.some(t => t && ns.includes(t));
    if(!satirdeEslesme){
      return `<span class="satirSoluk">${esc(satir)}</span>`;
    }

    // Ä°ki taraflÄ± arama â†’ yÃ¶n kontrolÃ¼ (ilÃ§eler dahil)
    if(aramaIkiYon){
      let p1 = Infinity;
      for(const n of nList1){ const i=ns.indexOf(n); if(i!==-1&&i<p1) p1=i; }
      let p2 = Infinity;
      for(const n of nList2){ const i=ns.indexOf(n); if(i!==-1&&i<p2) p2=i; }

      if(p1!==Infinity && p2!==Infinity){
        if(p1 < p2) return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
        if(p2 < p1) return `<span class="satirTers" title="Ters yÃ¶n">${hlText(satir, matchedTerms)} <span class="tersIkon">â†©</span></span>`;
      }
      // Sadece bir taraf geÃ§iyor â€” eÅŸleÅŸen satÄ±r
      return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
    }

    // Tek ÅŸehir aramasÄ±
    return `<span class="satirEsles">${hlText(satir, matchedTerms)}</span>`;
  });

  return `<div class="ilanText ilanTextSatir">${parcalar.join('\n')}</div>`;
}

function hlText(text, terms){
  // 1. Metni parÃ§alara bÃ¶l: tel numaralarÄ± ayrÄ±, gerisi ayrÄ±
  const TEL_RE = /(?<!\d)((?:\+90|0)5\d{9})(?!\d)/g;
  const parcalar = []; // {type:'text'|'tel', val}
  let son = 0, m;
  TEL_RE.lastIndex = 0;
  while ((m = TEL_RE.exec(text)) !== null) {
    if (m.index > son) parcalar.push({ type: 'text', val: text.slice(son, m.index) });
    parcalar.push({ type: 'tel', val: m[1] });
    son = m.index + m[0].length;
  }
  if (son < text.length) parcalar.push({ type: 'text', val: text.slice(son) });

  // 2. TÃ¼rkÃ§e karakter varyantÄ±
  function trVaryant(s){
    return s.replace(/i/g,'[iÄ°]').replace(/Ä±/g,'[Ä±I]')
            .replace(/g/g,'[gÄŸG]').replace(/u/g,'[uÃ¼U]')
            .replace(/s/g,'[sÅŸS]').replace(/o/g,'[oÃ¶O]')
            .replace(/c/g,'[cÃ§C]');
  }

  // 3. Metin parÃ§alarÄ±na ÅŸehir highlight uygula
  const sorted = (terms||[]).filter(Boolean).sort((a,b)=>b.length-a.length);
  function highlightText(str) {
    let r = esc(str);
    sorted.forEach(term => {
      try {
        const pat = trVaryant(term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));
        const re = new RegExp('(?<![a-zA-ZÄŸÃ¼ÅŸÄ±Ã¶Ã§ÄÃœÅÄ°Ã–Ã‡])('+pat+')(?![a-zA-ZÄŸÃ¼ÅŸÄ±Ã¶Ã§ÄÃœÅÄ°Ã–Ã‡])','gi');
        r = r.replace(re, (_,p1) => '<span class="hl">'+p1+'</span>');
      } catch(e){}
    });
    return r;
  }

  // 4. BirleÅŸtir
  return parcalar.map(p => {
    if (p.type === 'tel') {
      const intl = p.val.startsWith('+') ? p.val : '+9' + p.val;
      return '<a href="tel:'+intl+'" class="telLink">'+esc(p.val)+'</a>';
    }
    return highlightText(p.val);
  }).join('');
}

function updateCharCount(){
  const ta=document.getElementById('ilanMetin');
  const cc=document.getElementById('charCount');
  if(!ta||!cc)return;
  const n=ta.value.length;
  cc.textContent=n+' / 1000';
  cc.className='charCount'+(n>900?' warn':'');
}

async function ilanGonder(){
  const metin=document.getElementById('ilanMetin').value.trim();
  const msgEl=document.getElementById('ilanMsg');
  const btn=document.getElementById('ilanGonderBtn');
  if(!metin){msgEl.textContent='Ä°lan metni boÅŸ olamaz.';msgEl.style.background='#fef2f2';msgEl.style.color='var(--danger)';msgEl.style.border='1px solid #fecaca';msgEl.style.display='block';return;}
  btn.disabled=true;btn.textContent='YayÄ±nlanÄ±yor...';
  try{
    const res=await api('/api/ilan-olustur',{method:'POST',body:JSON.stringify({metin})});
    if(res&&res.ok){
      msgEl.textContent='âœ… '+res.message;msgEl.style.background='#f0fdf4';msgEl.style.color='var(--success)';msgEl.style.border='1px solid #bbf7d0';msgEl.style.display='block';
      document.getElementById('ilanMetin').value='';updateCharCount();
      setTimeout(()=>msgEl.style.display='none',4000);
    }else if(res){
      msgEl.textContent=res.error;msgEl.style.background='#fef2f2';msgEl.style.color='var(--danger)';msgEl.style.border='1px solid #fecaca';msgEl.style.display='block';
    }
  }catch(e){msgEl.textContent='Bir hata oluÅŸtu.';msgEl.style.display='block';}
  btn.disabled=false;btn.textContent='ğŸ“¢ Ä°lanÄ± YayÄ±nla';
}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

async function ilanPaylas(btn) {
  const text = btn.getAttribute('data-text') || '';
  const chat = btn.getAttribute('data-chat') || '';
  const paylasMetin = (chat ? 'ğŸ“¦ ' + chat + '\n' : '') + text + '\n\nğŸŒ yuklegit.tr';

  // Web Share API varsa kullan (mobil)
  if (navigator.share) {
    try {
      await navigator.share({ text: paylasMetin });
      return;
    } catch(e) {
      if (e.name === 'AbortError') return; // kullanÄ±cÄ± iptal etti
    }
  }
  // Yoksa panoya kopyala
  try {
    await navigator.clipboard.writeText(paylasMetin);
    const orig = btn.innerHTML;
    btn.innerHTML = 'âœ… KopyalandÄ±';
    btn.style.borderColor = '#16a34a';
    btn.style.color = '#16a34a';
    setTimeout(() => { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 2000);
  } catch {
    // Eski tarayÄ±cÄ± fallback
    const ta = document.createElement('textarea');
    ta.value = paylasMetin;
    ta.style.position = 'fixed'; ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    const orig = btn.innerHTML;
    btn.innerHTML = 'âœ… KopyalandÄ±';
    setTimeout(() => { btn.innerHTML = orig; }, 2000);
  }
}
function timeAgo(ts){
  const d=Math.floor((Date.now()-ts)/1000);
  if(d<60)return d+' sn Ã¶nce';if(d<3600)return Math.floor(d/60)+' dk Ã¶nce';
  const h=Math.floor(d/3600),m=Math.floor((d%3600)/60);return m>0?h+' sa '+m+' dk Ã¶nce':h+' sa Ã¶nce';
}

// â”€â”€ Ã‡oklu Arama Kutusu (Nereden / Nereye) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Her iki tarafta da birden fazla ÅŸehir seÃ§ilebilir
// "Ä°stanbul veya Ankara'dan â†’ Samsun veya Trabzon'a" gibi
const dualState = { nereden: [], nereye: [] };
const dualOneriIdx = { nereden: -1, nereye: -1 };

function normTR(s){
  return String(s||'')
    .replace(/Ä°/g,'i').replace(/I/g,'i').replace(/Ä±/g,'i')
    .replace(/Ä/g,'g').replace(/ÄŸ/g,'g')
    .replace(/Ãœ/g,'u').replace(/Ã¼/g,'u')
    .replace(/Å/g,'s').replace(/ÅŸ/g,'s')
    .replace(/Ã–/g,'o').replace(/Ã¶/g,'o')
    .replace(/Ã‡/g,'c').replace(/Ã§/g,'c')
    .toLowerCase().trim();
}

// Geriye dÃ¶nÃ¼k uyumluluk â€” aiAra ve hlText iÃ§in
function getSearchTags(){
  return [...dualState.nereden, ...dualState.nereye];
}

function formatSehir(s){
  return String(s||'').split(' ').map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(' ');
}

function focusDualInput(hangi){
  const inp = document.getElementById(hangi+'Input');
  if(inp && inp.style.display !== 'none') inp.focus();
}

function renderDualTags(hangi){
  const tagsEl = document.getElementById(hangi+'Tags');
  const inp    = document.getElementById(hangi+'Input');
  const wrap   = document.getElementById(hangi+'Wrap');
  if(!tagsEl) return;
  const list = dualState[hangi];

  tagsEl.innerHTML = list.map((s,i) => `<span class="dualTag">${esc(formatSehir(s))}<button onmousedown="event.preventDefault();removeDualTag('${hangi}',${i})" title="KaldÄ±r">âœ•</button></span>`).join('');

  // Placeholder gÃ¼ncelle
  if(inp){
    inp.style.display = '';
    if(list.length === 0){
      inp.placeholder = hangi==='nereden' ? 'KalkÄ±ÅŸ ÅŸehri ekleyin...' : 'VarÄ±ÅŸ ÅŸehri ekleyin (opsiyonel)...';
    } else {
      inp.placeholder = '+ ÅŸehir ekle...';
    }
  }
  if(wrap) wrap.classList.toggle('has-tag', list.length > 0);
}

function removeDualTag(hangi, idx){
  dualState[hangi].splice(idx, 1);
  renderDualTags(hangi);
  araIlanlar();
}

function dualEkle(hangi, sehir){
  if(!sehir) return;
  const temiz = sehir.trim();
  if(!temiz) return;
  // AynÄ± ÅŸehir zaten ekliyse atla
  if(dualState[hangi].some(s => normTR(s) === normTR(temiz))) {
    const inp = document.getElementById(hangi+'Input');
    if(inp){ inp.value=''; }
    const box = document.getElementById(hangi+'OneriBox');
    if(box) box.style.display='none';
    return;
  }
  dualState[hangi].push(temiz);
  renderDualTags(hangi);
  const box = document.getElementById(hangi+'OneriBox');
  if(box) box.style.display='none';
  dualOneriIdx[hangi] = -1;
  const inp = document.getElementById(hangi+'Input');
  if(inp){ inp.value=''; inp.focus(); }
  // Nereden'e ilk ÅŸehir eklenince Nereye'ye geÃ§ (sadece nereden listesi henÃ¼z 1'deyse)
  if(hangi==='nereden' && dualState.nereden.length===1 && dualState.nereye.length===0){
    setTimeout(()=>{ const ni=document.getElementById('nereyeInput'); if(ni) ni.focus(); }, 100);
  }
  araIlanlar();
}

function dualOneri(hangi){
  const inp = document.getElementById(hangi+'Input');
  const box = document.getElementById(hangi+'OneriBox');
  if(!inp||!box) return;
  const val = inp.value.trim();
  if(!val||val.length<1){ box.style.display='none'; return; }
  const nval = normTR(val);
  const tumSehirler = window._tumSehirler||[];
  const baslayan = tumSehirler.filter(s=>normTR(s).startsWith(nval));
  const iceren   = tumSehirler.filter(s=>!normTR(s).startsWith(nval)&&normTR(s).includes(nval));
  const eslesme  = [...baslayan,...iceren].slice(0,10);
  if(!eslesme.length){ box.style.display='none'; return; }
  dualOneriIdx[hangi] = -1;
  // Zaten seÃ§ili olanlarÄ± iÅŸaretle
  const seciliSet = new Set([...dualState.nereden,...dualState.nereye].map(normTR));
  box.innerHTML = eslesme.map(s=>{
    const secili = seciliSet.has(normTR(s));
    return `<div class="dualOneriItem${secili?' eklenmis':''}" data-val="${esc(s)}"
      onmousedown="event.preventDefault();dualEkle('${hangi}','${esc(s)}')">${esc(formatSehir(s))}${secili?' <small style=\'opacity:.5\'>(eklendi)</small>':''}</div>`;
  }).join('');
  box.style.display='block';
}

function dualKeydown(e, hangi){
  const box   = document.getElementById(hangi+'OneriBox');
  const items = box ? box.querySelectorAll('.dualOneriItem:not(.eklenmis)') : [];
  const boxAcik = box && box.style.display!=='none' && items.length>0;
  const inp   = document.getElementById(hangi+'Input');

  if(e.key==='ArrowDown'){
    e.preventDefault();
    if(!boxAcik) return;
    dualOneriIdx[hangi] = Math.min(dualOneriIdx[hangi]+1, items.length-1);
    items.forEach((el,i)=>el.classList.toggle('aktif',i===dualOneriIdx[hangi]));
    if(items[dualOneriIdx[hangi]]) items[dualOneriIdx[hangi]].scrollIntoView({block:'nearest'});
  } else if(e.key==='ArrowUp'){
    e.preventDefault();
    if(!boxAcik) return;
    dualOneriIdx[hangi] = Math.max(dualOneriIdx[hangi]-1, 0);
    items.forEach((el,i)=>el.classList.toggle('aktif',i===dualOneriIdx[hangi]));
    if(items[dualOneriIdx[hangi]]) items[dualOneriIdx[hangi]].scrollIntoView({block:'nearest'});
  } else if(e.key==='Enter'){
    e.preventDefault();
    if(boxAcik && dualOneriIdx[hangi]>=0 && items[dualOneriIdx[hangi]]){
      dualEkle(hangi, items[dualOneriIdx[hangi]].dataset.val);
    } else if(inp && inp.value.trim()){
      const match=(window._tumSehirler||[]).find(s=>normTR(s)===normTR(inp.value.trim()));
      dualEkle(hangi, match||inp.value.trim());
    } else {
      araIlanlar();
    }
  } else if(e.key==='Backspace'){
    if(inp && inp.value==='' && dualState[hangi].length>0){
      dualState[hangi].pop();
      renderDualTags(hangi);
      araIlanlar();
    }
  } else if(e.key==='Escape'){
    if(box) box.style.display='none';
    dualOneriIdx[hangi]=-1;
  }
}

// DÄ±ÅŸarÄ± tÄ±klayÄ±nca kapat
document.addEventListener('click', e=>{
  ['nereden','nereye'].forEach(hangi=>{
    const box = document.getElementById(hangi+'OneriBox');
    if(box && !e.target.closest('#'+hangi+'Wrap')){
      box.style.display='none';
      dualOneriIdx[hangi]=-1;
    }
  });
});

function araIlanlar(){
  // Ã‡oklu seÃ§imde: her nereden Ã— nereye kombinasyonunu ara, birleÅŸtir
  const neredenList = dualState.nereden;
  const nereyeList  = dualState.nereye;
  lastSearch = {
    s1: neredenList[0]||'',
    s2: nereyeList[0]||''
  };
  loadIlanlarCoklu(neredenList, nereyeList);
}

function resetArama(){
  dualState.nereden = [];
  dualState.nereye  = [];
  renderDualTags('nereden');
  renderDualTags('nereye');
  lastSearch = {s1:'',s2:''};
  ['nereden','nereye'].forEach(h=>{
    const inp=document.getElementById(h+'Input');
    const box=document.getElementById(h+'OneriBox');
    if(inp){inp.value='';inp.style.display='';}
    if(box) box.style.display='none';
  });
  loadIlanlar();
}

function toggleLive(){
  isLive=!isLive;
  document.getElementById('liveBtn').classList.toggle('active',isLive);
  if(isLive) liveInterval=setInterval(()=>araIlanlar(),15000);
  else clearInterval(liveInterval);
}



window.addEventListener('resize',()=>{
  const hb=document.getElementById('hamburger');
  if(!hb||!token)return;
  hb.style.display=window.innerWidth<=768?'flex':'none';
  if(window.innerWidth>768)closeSidebar();
});

// Profil
function loadProfil(){loadProfilBildirim();
  document.getElementById('profileUsername').textContent=currentUser.username;
  document.getElementById('profileEmail').textContent=currentUser.email||'â€”';
  document.getElementById('profilePhone').textContent=currentUser.phone||'â€”';
  const isA=currentUser.role==='admin';
  document.getElementById('profileRole').innerHTML=`<span style="display:inline-block;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700;background:${isA?'#eff6ff':'#f0fdf4'};color:${isA?'var(--accent)':'var(--success)'}">${isA?'Admin':'KullanÄ±cÄ±'}</span>`;
  document.getElementById('newEmail').value=currentUser.email||'';
}
async function updateEmail(){
  const email=document.getElementById('newEmail').value.trim();
  const data=await api('/api/profile',{method:'PUT',body:JSON.stringify({email})});if(!data)return;
  if(data.ok){currentUser.email=email;localStorage.setItem('yg_user',JSON.stringify(currentUser));showMsg('emailMsg','E-posta gÃ¼ncellendi!','ok');loadProfil();}
  else showMsg('emailMsg',data.error,'err');
}
async function updatePassword(){
  const currentPassword=document.getElementById('curPass').value,newPassword=document.getElementById('newPass').value;
  const data=await api('/api/profile',{method:'PUT',body:JSON.stringify({currentPassword,newPassword})});if(!data)return;
  if(data.ok){document.getElementById('curPass').value='';document.getElementById('newPass').value='';showMsg('passMsg','Åifre baÅŸarÄ±yla deÄŸiÅŸtirildi!','ok');}
  else showMsg('passMsg',data.error,'err');
}
function showMsg(id,msg,type){const el=document.getElementById(id);el.textContent=msg;el.className='profileMsg '+type;el.style.display='block';setTimeout(()=>el.style.display='none',4000);}

// KullanÄ±cÄ±lar
async function loadUsers(){
  const users=await api('/api/users');if(!users)return;
  document.getElementById('userTableBody').innerHTML=users.map(u=>`
    <tr>
      <td><strong>${esc(u.username)}</strong></td>
      <td style="color:var(--muted)">${u.email||'â€”'}</td>
      <td style="color:var(--muted)">${u.phone||'â€”'}</td>
      <td><span class="roleBadge ${u.role}">${u.role==='admin'?'Admin':'KullanÄ±cÄ±'}</span></td>
      <td style="color:var(--muted);font-size:12px">${new Date(u.createdAt).toLocaleDateString('tr-TR')}</td>
      <td>${u.username!==currentUser.username?`<button class="btnSm btnDanger" onclick="deleteUser(${u.id})">Sil</button>`:'<span style="color:var(--muted);font-size:12px">Sen</span>'}</td>
    </tr>`).join('');
}
async function addUser(){
  const username=document.getElementById('newUsername').value.trim(),email=document.getElementById('newUserEmail').value.trim();
  const password=document.getElementById('newPassword').value,role=document.getElementById('newRole').value;
  if(!username||!password)return alert('KullanÄ±cÄ± adÄ± ve ÅŸifre gerekli');
  const res=await api('/api/users',{method:'POST',body:JSON.stringify({username,email,password,role})});
  if(res&&!res.error){document.getElementById('newUsername').value='';document.getElementById('newUserEmail').value='';document.getElementById('newPassword').value='';loadUsers();}
  else if(res)alert(res.error);
}
async function deleteUser(id){if(!confirm('Bu kullanÄ±cÄ±yÄ± silmek istiyor musunuz?'))return;await api('/api/users/'+id,{method:'DELETE'});loadUsers();}

// Kara liste
async function loadBlacklist(){
  const list=await api('/api/blacklist');if(!list)return;
  document.getElementById('blacklistTags').innerHTML=list.length
    ?list.map(k=>`<div class="blTag">ğŸš« ${esc(k)}<button onclick="removeBlacklist('${esc(k)}')">Ã—</button></div>`).join('')
    :'<span style="color:var(--muted);font-size:14px">Kara listede kelime yok</span>';
}
async function addBlacklist(){const k=document.getElementById('newBlackword').value.trim();if(!k)return;await api('/api/blacklist',{method:'POST',body:JSON.stringify({kelime:k})});document.getElementById('newBlackword').value='';loadBlacklist();}
async function removeBlacklist(k){await api('/api/blacklist/'+encodeURIComponent(k),{method:'DELETE'});loadBlacklist();}

// â”€â”€ Bildirim Sistemi â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tumIller = [
  'adana','adÄ±yaman','afyon','aÄŸrÄ±','aksaray','amasya','ankara','antalya',
  'ardahan','artvin','aydÄ±n','balÄ±kesir','bartÄ±n','batman','bayburt','bilecik',
  'bingÃ¶l','bitlis','bolu','burdur','bursa','Ã§anakkale','Ã§ankÄ±rÄ±','Ã§orum',
  'denizli','diyarbakÄ±r','dÃ¼zce','edirne','elazÄ±ÄŸ','erzincan','erzurum',
  'eskiÅŸehir','gaziantep','giresun','gÃ¼mÃ¼ÅŸhane','hakkari','hatay','Ä±sparta',
  'iÄŸdÄ±r','istanbul','izmir','kahramanmaraÅŸ','karabÃ¼k','karaman','kars',
  'kastamonu','kayseri','kilis','kÄ±rÄ±kkale','kÄ±rklareli','kÄ±rÅŸehir','kocaeli',
  'konya','kÃ¼tahya','malatya','manisa','mardin','mersin','muÄŸla','muÅŸ',
  'nevÅŸehir','niÄŸde','ordu','osmaniye','rize','sakarya','samsun','siirt',
  'sinop','sivas','ÅŸanlÄ±urfa','ÅŸÄ±rnak','tekirdaÄŸ','tokat','trabzon','tunceli',
  'uÅŸak','van','yalova','yozgat','zonguldak'
];
let seciliSehirler = JSON.parse(localStorage.getItem('yg_bildirim_sehirler')||'[]');
let bildirimAktif = localStorage.getItem('yg_bildirim_aktif') === 'true';
let sonIlanTimestamp = 0;
let bildirimInterval = null;

function bildirimToggleChange(){
  const chk = document.getElementById('bildirimToggle');
  const kartText = document.getElementById('bildirimKartText');
  if(chk.checked){
    if(!('Notification' in window)){
      alert('TarayÄ±cÄ±nÄ±z bildirimleri desteklemiyor.');
      chk.checked = false; return;
    }
    Notification.requestPermission().then(p => {
      if(p === 'granted'){
        bildirimAktif = true;
        localStorage.setItem('yg_bildirim_aktif','true');
        if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'block';
        if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = 'âœ… Bildirimler aktif';
        if(kartText){ kartText.textContent = 'âœ… AÃ§Ä±k'; kartText.style.color = '#16a34a'; }
        renderSehirChipler();
        baslatBildirimKontrol();
      } else {
        chk.checked = false;
        if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = 'âš ï¸ TarayÄ±cÄ±dan izin vermeniz gerekiyor';
        if(kartText){ kartText.textContent = 'Ä°zin Gerekli'; kartText.style.color = '#f59e0b'; }
      }
    });
  } else {
    bildirimAktif = false;
    localStorage.setItem('yg_bildirim_aktif','false');
    if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'none';
    if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = 'Takip ettiÄŸiniz illerde ilan gelince bildirim alÄ±n (il seÃ§ince tÃ¼m ilÃ§eleri kapsar)';
    if(kartText){ kartText.textContent = 'KapalÄ±'; kartText.style.color = 'var(--text)'; }
    durdurBildirimKontrol();
  }
}

function renderSehirChipler(filtre=''){
  const container = document.getElementById('sehirChipler');
  if(!container) return;
  const normFiltre = filtre.toLowerCase().replace(/ÄŸ/g,'g').replace(/Ã¼/g,'u').replace(/ÅŸ/g,'s').replace(/Ä±/g,'i').replace(/Ã¶/g,'o').replace(/Ã§/g,'c');
  const liste = filtre ? tumIller.filter(s => {
    const ns = s.toLowerCase().replace(/ÄŸ/g,'g').replace(/Ã¼/g,'u').replace(/ÅŸ/g,'s').replace(/Ä±/g,'i').replace(/Ã¶/g,'o').replace(/Ã§/g,'c');
    return ns.includes(normFiltre);
  }) : tumIller;

  container.innerHTML = liste.map(s => {
    const aktif = seciliSehirler.includes(s);
    return `<div class="sehirChip${aktif?' aktif':''}" onclick="sehirToggle('${s}')">${s.charAt(0).toUpperCase()+s.slice(1)}</div>`;
  }).join('');
  document.getElementById('seciliSayisi').textContent = seciliSehirler.length;
}

function sehirToggle(sehir){
  const idx = seciliSehirler.indexOf(sehir);
  if(idx>=0) seciliSehirler.splice(idx,1);
  else seciliSehirler.push(sehir);
  localStorage.setItem('yg_bildirim_sehirler', JSON.stringify(seciliSehirler));
  const filtre = document.getElementById('bildirimSehirAra')?.value || '';
  renderSehirChipler(filtre);
}

function sehirFiltrele(){
  const filtre = document.getElementById('bildirimSehirAra')?.value || '';
  renderSehirChipler(filtre);
}

function baslatBildirimKontrol(){
  if(bildirimInterval) return;
  bildirimInterval = setInterval(async ()=>{
    if(!bildirimAktif || seciliSehirler.length===0) return;
    try{
      const data = await api('/api/ilanlar');
      if(!data) return;
      const ilanlar = data.ilanlar || data;
      // Yeni ilanlarÄ± bul (son kontrolden sonra gelenler)
      const yeniIlanlar = ilanlar.filter(i => i.timestamp > sonIlanTimestamp);
      if(yeniIlanlar.length > 0) sonIlanTimestamp = Math.max(...ilanlar.map(i=>i.timestamp));
      else if(sonIlanTimestamp === 0){ sonIlanTimestamp = Math.max(...ilanlar.map(i=>i.timestamp),0); return; }

      // Ä°l â†’ ilÃ§e haritasÄ± (frontend'de kÃ¼Ã§Ã¼k Ã¶zet)
      const IL_ILCE_OZET = {
        'istanbul':['adalar','arnavutkÃ¶y','ataÅŸehir','avcÄ±lar','baÄŸcÄ±lar','bahÃ§elievler','bakÄ±rkÃ¶y','baÅŸakÅŸehir','bayrampaÅŸa','beÅŸiktaÅŸ','beykoz','beylikdÃ¼zÃ¼','beyoÄŸlu','bÃ¼yÃ¼kÃ§ekmece','Ã§atalca','Ã§ekmekÃ¶y','esenler','esenyurt','eyÃ¼psultan','fatih','gaziosmanpaÅŸa','gÃ¼ngÃ¶ren','kadÄ±kÃ¶y','kaÄŸÄ±thane','kartal','kÃ¼Ã§Ã¼kÃ§ekmece','maltepe','pendik','sancaktepe','sarÄ±yer','silivri','sultanbeyli','sultangazi','ÅŸile','ÅŸiÅŸli','tuzla','Ã¼mraniye','Ã¼skÃ¼dar','zeytinburnu'],
        'ankara':['altÄ±ndaÄŸ','Ã§ankaya','etimesgut','keÃ§iÃ¶ren','mamak','sincan','yenimahalle','pursaklar','gÃ¶lbaÅŸÄ±','polatlÄ±'],
        'izmir':['balÃ§ova','bayÄ±ndÄ±r','bayraklÄ±','bergama','bornova','buca','Ã§eÅŸme','Ã§iÄŸli','dikili','foÃ§a','gaziemir','gÃ¼zelbahÃ§e','karabaÄŸlar','karÅŸÄ±yaka','kemalpaÅŸa','konak','menemen','narlÄ±dere','torbalÄ±','urla'],
        'bursa':['nilÃ¼fer','osmangazi','yÄ±ldÄ±rÄ±m','gemlik','inegÃ¶l','mudanya','orhangazi'],
        'antalya':['kepez','konyaaltÄ±','muratpaÅŸa','alanya','manavgat','serik'],
        'samsun':['atakum','canik','ilkadÄ±m','tekkekÃ¶y','bafra','Ã§arÅŸamba','terme','alaÃ§am','havza','kavak','ondokuzmayÄ±s'],
        'kocaeli':['baÅŸiskele','Ã§ayÄ±rova','darÄ±ca','derince','gebze','gÃ¶lcÃ¼k','izmit','kandÄ±ra','kartepe','kÃ¶rfez'],
        'sakarya':['adapazarÄ±','akyazÄ±','erenler','hendek','sapanca','serdivan'],
      };

      const normIl = s => s.toLowerCase().replace(/ÄŸ/g,'g').replace(/Ã¼/g,'u').replace(/ÅŸ/g,'s').replace(/Ä±/g,'i').replace(/Ã¶/g,'o').replace(/Ã§/g,'c').replace(/Ä°/g,'i');

      for(const ilan of yeniIlanlar){
        const normMetin = ' ' + normIl(ilan.text) + ' ';
        const eslesme = seciliSehirler.find(il => {
          const ns = normIl(il);
          // Ä°lin kendisi geÃ§iyor mu?
          if(normMetin.includes(' '+ns+' ')) return true;
          // Ä°lin ilÃ§elerinden biri geÃ§iyor mu?
          const ilceler = IL_ILCE_OZET[il] || [];
          return ilceler.some(ilce => normMetin.includes(' '+normIl(ilce)+' '));
        });
        if(eslesme){
          new Notification('ğŸš› YÃ¼kleGit â€” Yeni Ä°lan', {
            body: eslesme.charAt(0).toUpperCase()+eslesme.slice(1)+' ilanÄ±: '+ilan.text.slice(0,80)+'...',
            icon: '/favicon.ico',
            tag: 'ilan_'+ilan.timestamp,
          });
        }
      }
    }catch(e){}
  }, 20000); // 20 saniyede bir kontrol
}

function durdurBildirimKontrol(){
  clearInterval(bildirimInterval);
  bildirimInterval = null;
}

function loadProfilBildirim(){
  const chk = document.getElementById('bildirimToggle');
  if(!chk) return;
  const izin = Notification.permission === 'granted';
  chk.checked = bildirimAktif && izin;
  const kartText = document.getElementById('bildirimKartText');
  if(chk.checked){
    if(document.getElementById('bildirimAyarlar')) document.getElementById('bildirimAyarlar').style.display = 'block';
    if(document.getElementById('bildirimDurum')) document.getElementById('bildirimDurum').textContent = 'âœ… Bildirimler aktif';
    if(kartText){ kartText.textContent = 'âœ… AÃ§Ä±k'; kartText.style.color = '#16a34a'; }
    renderSehirChipler();
  } else {
    if(kartText){ kartText.textContent = 'KapalÄ±'; kartText.style.color = 'var(--text)'; }
  }
}

// â”€â”€ Hareketler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHareketler(){
  const data = await api('/api/logs?limit=300');
  if(!data) return;
  const tbody = document.getElementById('hareketlerBody');
  if(!tbody) return;
  if(!data.length){ tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:32px;color:var(--muted)">HenÃ¼z kayÄ±t yok</td></tr>'; return; }
  const actionLabel = a => {
    if(a==='login')  return '<span class="actionBadge login">ğŸ”‘ GiriÅŸ</span>';
    if(a==='logout') return '<span class="actionBadge logout">ğŸšª Ã‡Ä±kÄ±ÅŸ</span>';
    if(a==='search') return '<span class="actionBadge search">ğŸ” Arama</span>';
    return `<span class="actionBadge">${esc(a)}</span>`;
  };
  tbody.innerHTML = data.map(l=>`<tr>
    <td><strong>${esc(l.username||'#'+l.userId)}</strong></td>
    <td>${esc(l.email||'-')}</td>
    <td>${esc(l.phone||'-')}</td>
    <td>${actionLabel(l.action)}</td>
    <td>${esc(l.detail||'-')}</td>
    <td style="font-family:monospace;font-size:12px">${esc(l.ipAddress||'-')}</td>
    <td style="white-space:nowrap;color:var(--muted)">${new Date(l.timestamp).toLocaleString('tr-TR')}</td>
  </tr>`).join('');
}

// â”€â”€ Bot YÃ¶netimi â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _qrEventSource = null;

const durumLabel = {
  'bekliyor':         { cls:'#f59e0b', icon:'â³', text:'Bekliyor' },
  'baslatiliyor':     { cls:'#3b82f6', icon:'ğŸ”„', text:'BaÅŸlatÄ±lÄ±yor' },
  'qr_bekleniyor':    { cls:'#8b5cf6', icon:'ğŸ“±', text:'QR Bekleniyor' },
  'dogrulandi':       { cls:'#3b82f6', icon:'âœ…', text:'DoÄŸrulandÄ±' },
  'hazir':            { cls:'#10b981', icon:'ğŸŸ¢', text:'HazÄ±r' },
  'baglanti_kesildi': { cls:'#ef4444', icon:'ğŸ”´', text:'BaÄŸlantÄ± Kesildi' },
  'hata':             { cls:'#ef4444', icon:'âŒ', text:'Hata' },
};

async function loadBotlar(){
  const data = await api('/api/bots');
  if(!data) return;
  const grid = document.getElementById('botlarGrid');
  if(!grid) return;
  if(!data.length){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:60px 20px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">ğŸ¤–</div>
      <div style="font-size:16px;font-weight:600">HenÃ¼z bot eklenmedi</div>
      <div style="font-size:13px;margin-top:6px">SaÄŸ Ã¼stteki "Yeni Bot" butonuna tÄ±klayÄ±n</div>
    </div>`;
    return;
  }
  grid.innerHTML = data.map(bot => {
    const d = durumLabel[bot.durum] || durumLabel['bekliyor'];
    return `
    <div class="card" style="padding:20px">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px">
        <div>
          <div style="font-size:16px;font-weight:700">${esc(bot.isim)}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px;font-family:monospace">${esc(bot.clientId)}</div>
        </div>
        <span style="font-size:12px;font-weight:600;padding:4px 10px;border-radius:20px;background:${d.cls}20;color:${d.cls}">${d.icon} ${d.text}</span>
      </div>
      ${bot.telefon ? `<div style="font-size:13px;color:var(--muted);margin-bottom:12px">ğŸ“ +${esc(bot.telefon)}</div>` : ''}
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        ${bot.durum !== 'hazir' ? `<button class="btnSearch" style="font-size:12px;padding:7px 12px" onclick="qrGoster('${esc(bot.clientId)}','${esc(bot.isim)}')">ğŸ“± QR GÃ¶ster</button>` : ''}
        <button class="btn" style="font-size:12px;padding:7px 12px" onclick="botRestart('${esc(bot.clientId)}')">ğŸ”„ Yeniden BaÅŸlat</button>
        <button class="btnReset" style="font-size:12px;padding:7px 12px;background:#fee2e2;color:#dc2626;border:none" onclick="botSilOnay('${esc(bot.clientId)}','${esc(bot.isim)}')">ğŸ—‘ï¸ Sil</button>
      </div>
    </div>`;
  }).join('');
}

function botEkleModal(){
  document.getElementById('yeniBotIsim').value = '';
  document.getElementById('botEkleModalEl').style.display = 'flex';
  setTimeout(() => document.getElementById('yeniBotIsim').focus(), 100);
}

async function botEkleKaydet(){
  const isim = document.getElementById('yeniBotIsim').value.trim();
  if(!isim){ alert('Bot ismi girin'); return; }
  document.getElementById('botEkleModalEl').style.display = 'none';
  const data = await api('/api/bots', { method:'POST', body: JSON.stringify({ isim }) });
  if(!data?.ok) return;
  loadBotlar();
  // QR modal'Ä± hemen aÃ§
  setTimeout(() => qrGoster(data.clientId, isim), 500);
}

function qrGoster(clientId, isim){
  document.getElementById('qrModalBaslik').textContent = 'ğŸ¤– ' + isim;
  document.getElementById('qrModalAlt').textContent = 'Bot baÅŸlatÄ±lÄ±yor, QR bekleniyor...';
  document.getElementById('qrModalIcerik').innerHTML = '<div class="spinner"></div>';
  document.getElementById('qrModalDurum').textContent = '';
  document.getElementById('qrModal').style.display = 'flex';

  // Eski SSE kapat
  if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }

  // QR PNG'yi retry ile yÃ¼kle
  async function qrImgYukle(deneme){
    const imgUrl = '/api/bots/' + encodeURIComponent(clientId) + '/qr-image?token=' + encodeURIComponent(token) + '&t=' + Date.now();
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => {
        img.style.cssText = 'width:256px;height:256px;border-radius:10px;display:block;margin:auto';
        document.getElementById('qrModalIcerik').innerHTML = '';
        document.getElementById('qrModalIcerik').appendChild(img);
        document.getElementById('qrModalAlt').textContent = 'WhatsApp â†’ BaÄŸlÄ± Cihazlar â†’ Cihaz Ekle â†’ QR\'Ä± tarat';
        document.getElementById('qrModalDurum').textContent = '';
        resolve(true);
      };
      img.onerror = () => {
        if(deneme < 4){
          // 1.5s sonra tekrar dene
          document.getElementById('qrModalDurum').textContent = 'QR yÃ¼kleniyor... (' + deneme + '/4)';
          setTimeout(() => qrImgYukle(deneme + 1).then(resolve), 1500);
        } else {
          document.getElementById('qrModalIcerik').innerHTML = '<div style="color:#ef4444;font-size:14px;text-align:center;padding:20px">âš ï¸ QR gÃ¶rÃ¼ntÃ¼sÃ¼ yÃ¼klenemedi.<br><br><button class="btn" onclick="qrImgYukle(1)" style="font-size:13px">ğŸ”„ Tekrar Dene</button></div>';
          resolve(false);
        }
      };
      img.src = imgUrl;
    });
  }

  // SSE baÄŸlantÄ±sÄ± aÃ§
  _qrEventSource = new EventSource('/api/bots/' + encodeURIComponent(clientId) + '/qr?token=' + encodeURIComponent(token));

  _qrEventSource.onmessage = async e => {
    try {
      const msg = JSON.parse(e.data);
      if(msg.tip === 'qr_hazir'){
        document.getElementById('qrModalAlt').textContent = 'QR hazÄ±rlanÄ±yor...';
        document.getElementById('qrModalIcerik').innerHTML = '<div class="spinner"></div>';
        await qrImgYukle(1);
      } else if(msg.tip === 'dogrulandi'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">âœ…</div>';
        document.getElementById('qrModalAlt').textContent = 'DoÄŸrulandÄ±!';
        document.getElementById('qrModalDurum').textContent = 'BaÄŸlantÄ± kuruluyor...';
      } else if(msg.tip === 'hazir'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">ğŸŸ¢</div>';
        document.getElementById('qrModalAlt').textContent = 'Bot hazÄ±r!';
        document.getElementById('qrModalDurum').textContent = 'âœ… WhatsApp\'a baÅŸarÄ±yla baÄŸlandÄ±';
        if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }
        setTimeout(() => { qrModalKapat(); loadBotlar(); }, 2500);
      } else if(msg.tip === 'baglanti_kesildi'){
        document.getElementById('qrModalIcerik').innerHTML = '<div style="font-size:64px;text-align:center">ğŸ”´</div>';
        document.getElementById('qrModalAlt').textContent = 'BaÄŸlantÄ± kesildi';
        document.getElementById('qrModalDurum').textContent = 'Bot yeniden baÅŸlatÄ±lÄ±yor...';
      }
    } catch {}
  };

  _qrEventSource.onerror = () => {
    // SSE hata â€” polling ile kontrol et
    document.getElementById('qrModalDurum').textContent = 'âš ï¸ Sunucu baÄŸlantÄ±sÄ± kesildi, yeniden deneniyor...';
  };
}

function qrModalKapat(){
  document.getElementById('qrModal').style.display = 'none';
  if(_qrEventSource){ _qrEventSource.close(); _qrEventSource = null; }
}

async function botRestart(clientId){
  if(!confirm('Bot yeniden baÅŸlatÄ±lsÄ±n mÄ±?')) return;
  await api('/api/bots/' + encodeURIComponent(clientId) + '/restart', { method:'POST' });
  setTimeout(loadBotlar, 2000);
}

async function botSilOnay(clientId, isim){
  if(!confirm('"' + isim + '" botu silinsin mi? WhatsApp oturumu da silinecek.')) return;
  await api('/api/bots/' + encodeURIComponent(clientId), { method:'DELETE' });
  loadBotlar();
}

// BaÅŸlat
if(token&&currentUser){initApp();}
</script>
  <!-- PWA Install Banner -->
  <div id="pwaBanner" style="display:none" class="pwaBanner">
    <div class="pwaIcon">ğŸš›</div>
    <div class="pwaText">
      <div class="pwaTitle">YÃ¼kleGit UygulamasÄ±</div>
      <div class="pwaSub">Ana ekrana ekle, uygulama gibi kullan</div>
    </div>
    <button class="pwaBtn" onclick="pwaInstall()">YÃ¼kle</button>
    <button class="pwaClose" onclick="pwaDismiss()">âœ•</button>
  </div>

  <script>
    // PWA Service Worker
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    }

    // Zaten kuruluysa kartÄ± gÃ¼ncelle
    if(window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone){
      setTimeout(()=>{
        const c = document.getElementById('pwaCard');
        const t = document.getElementById('pwaCardText');
        if(c){c.style.background='linear-gradient(135deg,#dcfce7,#bbf7d0)';c.style.cursor='default';}
        if(t){t.textContent='âœ… Kurulu';t.style.color='#16a34a';}
      }, 500);
    }

    // Install prompt
    let _pwaPrompt = null;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      _pwaPrompt = e;
      if(localStorage.getItem('yg_pwa_dismissed')) return;
      if(localStorage.getItem('yg_token')){
        document.getElementById('pwaBanner').style.display = 'flex';
      } else {
        window._showPwaBanner = true;
      }
    });

    function pwaInstall(){
      if(!_pwaPrompt) return;
      _pwaPrompt.prompt();
      _pwaPrompt.userChoice.then(r => {
        document.getElementById('pwaBanner').style.display = 'none';
        if(r.outcome==='accepted'){
          const t=document.getElementById('pwaCardText');
          if(t){t.textContent='âœ… Kuruldu!';}
        }
        _pwaPrompt = null;
      });
    }

    function pwaInstallOrGuide(){
      const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
      const installed = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
      if(installed) return;
      if(_pwaPrompt){
        pwaInstall();
      } else if(isIOS){
        alert('ğŸ“² iPhone/iPad\'e kurmak iÃ§in:\n\nSafari\'de alttaki "PaylaÅŸ" butonuna (â–¡â†‘) tÄ±klayÄ±n\nâ†’ "Ana Ekrana Ekle" seÃ§in\nâ†’ "Ekle" ye basÄ±n');
      } else {
        alert('ğŸ“² Telefona kurmak iÃ§in:\n\nTarayÄ±cÄ± menÃ¼sÃ¼nden (â‹®)\n"Ana ekrana ekle" veya\n"UygulamayÄ± yÃ¼kle" seÃ§eneÄŸini tÄ±klayÄ±n');
      }
    }

    function pwaDismiss(){
      document.getElementById('pwaBanner').style.display = 'none';
      localStorage.setItem('yg_pwa_dismissed', '1');
    }

    // iOS banner
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isStandalone = window.navigator.standalone;
    if(isIOS && !isStandalone && !localStorage.getItem('yg_pwa_dismissed')){
      setTimeout(() => {
        if(!localStorage.getItem('yg_token')) return;
        const b = document.getElementById('pwaBanner');
        b.querySelector('.pwaSub').textContent = 'Safari\'de "PaylaÅŸ" â†’ "Ana Ekrana Ekle"';
        b.querySelector('.pwaBtn').style.display = 'none';
        b.style.display = 'flex';
      }, 2000);
    }
  </script>

<!-- â”€â”€ YÃ¼zen WhatsApp Destek Butonu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<a id="waFloat" href="https://wa.me/905015303028?text=Merhaba%2C%20YÃ¼kleGit%20hakkÄ±nda%20bilgi%20almak%20istiyorum." target="_blank" rel="noopener"
   style="position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;align-items:center;gap:10px;
          background:#25D366;color:white;border-radius:50px;padding:12px 20px 12px 14px;
          box-shadow:0 4px 20px rgba(37,211,102,.45);text-decoration:none;font-weight:700;
          font-size:14px;font-family:'Outfit',sans-serif;transition:transform .2s,box-shadow .2s"
   onmouseover="this.style.transform='scale(1.06)';this.style.boxShadow='0 6px 28px rgba(37,211,102,.6)'"
   onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 20px rgba(37,211,102,.45)'">
  <svg width="26" height="26" viewBox="0 0 32 32" fill="white" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 2C8.268 2 2 8.268 2 16c0 2.478.675 4.797 1.85 6.787L2 30l7.43-1.826A13.94 13.94 0 0016 30c7.732 0 14-6.268 14-14S23.732 2 16 2zm0 25.5a11.44 11.44 0 01-5.836-1.596l-.418-.248-4.413 1.084 1.13-4.3-.272-.44A11.46 11.46 0 014.5 16C4.5 9.596 9.596 4.5 16 4.5S27.5 9.596 27.5 16 22.404 27.5 16 27.5zm6.29-8.424c-.344-.172-2.036-1.004-2.352-1.118-.316-.115-.547-.172-.777.172-.23.344-.892 1.118-1.093 1.348-.2.23-.402.258-.747.086-.344-.172-1.454-.536-2.77-1.71-1.023-.913-1.714-2.04-1.915-2.385-.2-.344-.021-.53.15-.702.155-.155.344-.402.516-.603.172-.2.23-.344.344-.573.115-.23.058-.43-.029-.603-.086-.172-.777-1.876-1.064-2.566-.28-.672-.564-.58-.777-.59l-.661-.011c-.23 0-.603.086-.918.43s-1.207 1.176-1.207 2.867 1.236 3.326 1.408 3.555c.172.23 2.432 3.71 5.893 5.205.823.355 1.466.567 1.967.726.826.263 1.579.226 2.173.137.663-.1 2.036-.832 2.323-1.634.287-.803.287-1.49.2-1.634-.086-.143-.315-.23-.66-.402z"/>
  </svg>
  WhatsApp Destek
</a>

</body>
</html>
